{"version":3,"file":"debug_tracks.test.js","sourceRoot":"","sources":["../../../src/test/debug_tracks.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {test, Page} from '@playwright/test';\nimport {PerfettoTestHelper} from './perfetto_ui_test_helper';\n\ntest.describe.configure({mode: 'serial'});\n\nlet pth: PerfettoTestHelper;\nlet page: Page;\n\nconst SQL_QUERY = `select id, ts, dur, name, category, track_id from slices\nwhere category is not null  limit 1000`;\n\ntest.beforeAll(async ({browser}, _testInfo) => {\n  page = await browser.newPage();\n  pth = new PerfettoTestHelper(page);\n  await pth.openTraceFile('api34_startup_cold.perfetto-trace');\n});\n\ntest('debug tracks', async () => {\n  const omnibox = page.locator('input[ref=omnibox]');\n  await omnibox.focus();\n  await omnibox.selectText();\n  await omnibox.press(':');\n  await pth.waitForPerfettoIdle();\n  await omnibox.fill(SQL_QUERY);\n  await pth.waitForPerfettoIdle();\n  await omnibox.press('Enter');\n  await pth.waitForPerfettoIdle();\n\n  await page.getByRole('button', {name: 'Show debug track'}).click();\n  await pth.waitForPerfettoIdle();\n  await page.keyboard.type('debug track'); // The track name\n  await page.keyboard.press('Enter');\n  await pth.waitForPerfettoIdle();\n  await pth.waitForIdleAndScreenshot('debug track added.png');\n\n  // Click on a slice on the debug track.\n  await page.mouse.click(590, 180);\n  await pth.waitForPerfettoIdle();\n  await pth.waitForIdleAndScreenshot('debug slice clicked.png');\n\n  // Close the debug track.\n  await pth.locateTrack('debug track').getByText('close').first().click();\n  await pth.waitForPerfettoIdle();\n  await pth.waitForIdleAndScreenshot('debug track removed.png');\n});\n\ntest('debug tracks pivot', async () => {\n  const omnibox = page.locator('input[ref=omnibox]');\n  await omnibox.focus();\n  await omnibox.selectText();\n  await omnibox.press(':');\n  await pth.waitForPerfettoIdle();\n  await omnibox.fill(SQL_QUERY);\n  await pth.waitForPerfettoIdle();\n  await omnibox.press('Enter');\n\n  await page.getByRole('button', {name: 'Show debug track'}).click();\n  await pth.waitForPerfettoIdle();\n  await page.keyboard.type('pivot'); // The track name\n  await page.locator('.pf-popup-portal #pivot').selectOption('category');\n  await page.keyboard.press('Enter');\n  await pth.waitForPerfettoIdle();\n  await pth.waitForIdleAndScreenshot('debug track pivot.png', {\n    clip: {\n      x: (await pth.sidebarSize()).width,\n      y: 180,\n      width: 1920,\n      height: 600,\n    },\n  });\n});\n"]}
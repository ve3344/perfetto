{"version":3,"file":"flamegraph.js","sourceRoot":"","sources":["../../../src/widgets/flamegraph.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {findRef} from '../base/dom_utils';\nimport {assertExists, assertTrue} from '../base/logging';\nimport {Monitor} from '../base/monitor';\nimport {Button, ButtonBar} from './button';\nimport {EmptyState} from './empty_state';\nimport {Popup, PopupPosition} from './popup';\nimport {scheduleFullRedraw} from './raf';\nimport {Select} from './select';\nimport {Spinner} from './spinner';\nimport {TagInput} from './tag_input';\nimport {SegmentedButtons} from './segmented_buttons';\nimport {z} from 'zod';\n\nconst LABEL_FONT_STYLE = '12px Roboto';\nconst NODE_HEIGHT = 20;\nconst MIN_PIXEL_DISPLAYED = 3;\nconst FILTER_COMMON_TEXT = `\n- \"Show Stack: foo\" or \"SS: foo\" or \"foo\" to show only stacks containing \"foo\"\n- \"Hide Stack: foo\" or \"HS: foo\" to hide all stacks containing \"foo\"\n- \"Show From Frame: foo\" or \"SFF: foo\" to show frames containing \"foo\" and all descendants\n- \"Hide Frame: foo\" or \"HF: foo\" to hide all frames containing \"foo\"\n- \"Pivot: foo\" or \"P: foo\" to pivot on frames containing \"foo\".\nNote: Pivot applies after all other filters and only one pivot can be active at a time.\n`;\nconst FILTER_EMPTY_TEXT = `\nAvailable filters:${FILTER_COMMON_TEXT}\n`;\nconst LABEL_PADDING_PX = 5;\nconst LABEL_MIN_WIDTH_FOR_TEXT_PX = 5;\nconst PADDING_NODE_COUNT = 8;\n\ninterface BaseSource {\n  readonly queryXStart: number;\n  readonly queryXEnd: number;\n  readonly type: 'ABOVE_ROOT' | 'BELOW_ROOT' | 'ROOT';\n}\n\ninterface MergedSource extends BaseSource {\n  readonly kind: 'MERGED';\n}\n\ninterface RootSource extends BaseSource {\n  readonly kind: 'ROOT';\n}\n\ninterface NodeSource extends BaseSource {\n  readonly kind: 'NODE';\n  readonly queryIdx: number;\n}\n\ntype Source = MergedSource | NodeSource | RootSource;\n\ninterface RenderNode {\n  readonly x: number;\n  readonly y: number;\n  readonly width: number;\n  readonly source: Source;\n  readonly state: 'NORMAL' | 'PARTIAL' | 'SELECTED';\n}\n\ninterface ZoomRegion {\n  readonly queryXStart: number;\n  readonly queryXEnd: number;\n  readonly type: 'ABOVE_ROOT' | 'BELOW_ROOT' | 'ROOT';\n}\n\nexport interface FlamegraphQueryData {\n  readonly nodes: ReadonlyArray<{\n    readonly id: number;\n    readonly parentId: number;\n    readonly depth: number;\n    readonly name: string;\n    readonly selfValue: number;\n    readonly cumulativeValue: number;\n    readonly parentCumulativeValue?: number;\n    readonly properties: ReadonlyMap<string, string>;\n    readonly xStart: number;\n    readonly xEnd: number;\n  }>;\n  readonly unfilteredCumulativeValue: number;\n  readonly allRootsCumulativeValue: number;\n  readonly minDepth: number;\n  readonly maxDepth: number;\n}\n\nconst FLAMEGRAPH_FILTER_SCHEMA = z\n  .object({\n    kind: z\n      .union([\n        z.literal('SHOW_STACK').readonly(),\n        z.literal('HIDE_STACK').readonly(),\n        z.literal('SHOW_FROM_FRAME').readonly(),\n        z.literal('HIDE_FRAME').readonly(),\n      ])\n      .readonly(),\n    filter: z.string().readonly(),\n  })\n  .readonly();\n\ntype FlamegraphFilter = z.infer<typeof FLAMEGRAPH_FILTER_SCHEMA>;\n\nconst FLAMEGRAPH_VIEW_SCHEMA = z\n  .discriminatedUnion('kind', [\n    z.object({kind: z.literal('TOP_DOWN').readonly()}),\n    z.object({kind: z.literal('BOTTOM_UP').readonly()}),\n    z.object({\n      kind: z.literal('PIVOT').readonly(),\n      pivot: z.string().readonly(),\n    }),\n  ])\n  .readonly();\n\nexport type FlamegraphView = z.infer<typeof FLAMEGRAPH_VIEW_SCHEMA>;\n\nexport const FLAMEGRAPH_STATE_SCHEMA = z\n  .object({\n    selectedMetricName: z.string().readonly(),\n    filters: z.array(FLAMEGRAPH_FILTER_SCHEMA).readonly(),\n    view: FLAMEGRAPH_VIEW_SCHEMA,\n  })\n  .readonly();\n\nexport type FlamegraphState = z.infer<typeof FLAMEGRAPH_STATE_SCHEMA>;\n\ninterface FlamegraphMetric {\n  readonly name: string;\n  readonly unit: string;\n}\n\nexport interface FlamegraphAttrs {\n  readonly metrics: ReadonlyArray<FlamegraphMetric>;\n  readonly state: FlamegraphState;\n  readonly data: FlamegraphQueryData | undefined;\n\n  readonly onStateChange: (filters: FlamegraphState) => void;\n}\n\n/*\n * Widget for visualizing \"tree-like\" data structures using an interactive\n * flamegraph visualization.\n *\n * To use this widget, provide an array of \"metrics\", which correspond to\n * different properties of the tree to switch between (e.g. object size\n * and object count) and the data which should be displayed.\n *\n * Note that it's valid to pass \"undefined\" as the data: this will cause a\n * loading container to be shown.\n *\n * Example:\n *\n * ```\n * const metrics = [...];\n * let state = ...;\n * let data = ...;\n *\n * m(Flamegraph, {\n *   metrics,\n *   state,\n *   data,\n *   onStateChange: (newState) => {\n *     state = newState,\n *     data = undefined;\n *     fetchData();\n *   },\n * });\n * ```\n */\nexport class Flamegraph implements m.ClassComponent<FlamegraphAttrs> {\n  private attrs: FlamegraphAttrs;\n\n  private rawFilterText: string = '';\n  private filterFocus: boolean = false;\n\n  private dataChangeMonitor = new Monitor([() => this.attrs.data]);\n  private zoomRegion?: ZoomRegion;\n\n  private renderNodesMonitor = new Monitor([\n    () => this.attrs.data,\n    () => this.canvasWidth,\n    () => this.zoomRegion,\n  ]);\n  private renderNodes?: ReadonlyArray<RenderNode>;\n\n  private tooltipPos?: {\n    node: RenderNode;\n    x: number;\n    state: 'HOVER' | 'CLICK' | 'DECLICK';\n  };\n  private lastClickedNode?: RenderNode;\n\n  private hoveredX?: number;\n  private hoveredY?: number;\n\n  private canvasWidth = 0;\n  private labelCharWidth = 0;\n\n  constructor({attrs}: m.Vnode<FlamegraphAttrs, {}>) {\n    this.attrs = attrs;\n  }\n\n  view({attrs}: m.Vnode<FlamegraphAttrs, this>): void | m.Children {\n    this.attrs = attrs;\n    if (this.dataChangeMonitor.ifStateChanged()) {\n      this.zoomRegion = undefined;\n      this.lastClickedNode = undefined;\n      this.tooltipPos = undefined;\n    }\n    if (attrs.data === undefined) {\n      return m(\n        '.pf-flamegraph',\n        this.renderFilterBar(attrs),\n        m(\n          '.loading-container',\n          m(\n            EmptyState,\n            {\n              icon: 'bar_chart',\n              title: 'Computing graph ...',\n              className: 'flamegraph-loading',\n            },\n            m(Spinner, {easing: true}),\n          ),\n        ),\n      );\n    }\n    const {minDepth, maxDepth} = attrs.data;\n    const canvasHeight =\n      Math.max(maxDepth - minDepth + PADDING_NODE_COUNT, PADDING_NODE_COUNT) *\n      NODE_HEIGHT;\n    return m(\n      '.pf-flamegraph',\n      this.renderFilterBar(attrs),\n      m(\n        '.canvas-container[ref=canvas-container]',\n        {\n          onscroll: () => scheduleFullRedraw(),\n        },\n        m(\n          Popup,\n          {\n            trigger: m('.popup-anchor', {\n              style: {\n                left: this.tooltipPos?.x + 'px',\n                top: this.tooltipPos?.node.y + 'px',\n              },\n            }),\n            position: PopupPosition.Bottom,\n            isOpen:\n              this.tooltipPos?.state === 'HOVER' ||\n              this.tooltipPos?.state === 'CLICK',\n            className: 'pf-flamegraph-tooltip-popup',\n            offset: NODE_HEIGHT,\n          },\n          this.renderTooltip(),\n        ),\n        m(`canvas[ref=canvas]`, {\n          style: `height:${canvasHeight}px; width:100%`,\n          onmousemove: ({offsetX, offsetY}: MouseEvent) => {\n            scheduleFullRedraw();\n            this.hoveredX = offsetX;\n            this.hoveredY = offsetY;\n            if (this.tooltipPos?.state === 'CLICK') {\n              return;\n            }\n            const renderNode = this.renderNodes?.find((n) =>\n              isIntersecting(offsetX, offsetY, n),\n            );\n            if (renderNode === undefined) {\n              this.tooltipPos = undefined;\n              return;\n            }\n            if (\n              isIntersecting(\n                this.tooltipPos?.x,\n                this.tooltipPos?.node.y,\n                renderNode,\n              )\n            ) {\n              return;\n            }\n            this.tooltipPos = {\n              x: offsetX,\n              node: renderNode,\n              state: 'HOVER',\n            };\n          },\n          onmouseout: () => {\n            this.hoveredX = undefined;\n            this.hoveredY = undefined;\n            document.body.style.cursor = 'default';\n            if (\n              this.tooltipPos?.state === 'HOVER' ||\n              this.tooltipPos?.state === 'DECLICK'\n            ) {\n              this.tooltipPos = undefined;\n            }\n            scheduleFullRedraw();\n          },\n          onclick: ({offsetX, offsetY}: MouseEvent) => {\n            const renderNode = this.renderNodes?.find((n) =>\n              isIntersecting(offsetX, offsetY, n),\n            );\n            this.lastClickedNode = renderNode;\n            if (renderNode === undefined) {\n              this.tooltipPos = undefined;\n            } else if (\n              isIntersecting(\n                this.tooltipPos?.x,\n                this.tooltipPos?.node.y,\n                renderNode,\n              )\n            ) {\n              this.tooltipPos!.state =\n                this.tooltipPos?.state === 'CLICK' ? 'DECLICK' : 'CLICK';\n            } else {\n              this.tooltipPos = {\n                x: offsetX,\n                node: renderNode,\n                state: 'CLICK',\n              };\n            }\n            scheduleFullRedraw();\n          },\n          ondblclick: ({offsetX, offsetY}: MouseEvent) => {\n            const renderNode = this.renderNodes?.find((n) =>\n              isIntersecting(offsetX, offsetY, n),\n            );\n            // TODO(lalitm): ignore merged nodes for now as we haven't quite\n            // figured out the UX for this.\n            if (renderNode?.source.kind === 'MERGED') {\n              return;\n            }\n            this.zoomRegion = renderNode?.source;\n            scheduleFullRedraw();\n          },\n        }),\n      ),\n    );\n  }\n\n  oncreate({dom}: m.VnodeDOM<FlamegraphAttrs, this>) {\n    this.drawCanvas(dom);\n  }\n\n  onupdate({dom}: m.VnodeDOM<FlamegraphAttrs, this>) {\n    this.drawCanvas(dom);\n  }\n\n  static createDefaultState(\n    metrics: ReadonlyArray<FlamegraphMetric>,\n  ): FlamegraphState {\n    return {\n      selectedMetricName: metrics[0].name,\n      filters: [],\n      view: {kind: 'TOP_DOWN'},\n    };\n  }\n\n  private drawCanvas(dom: Element) {\n    // TODO(lalitm): consider migrating to VirtualCanvas to improve performance here.\n    const canvasContainer = findRef(dom, 'canvas-container');\n    if (canvasContainer === null) {\n      return;\n    }\n    const canvas = findRef(dom, 'canvas');\n    if (canvas === null || !(canvas instanceof HTMLCanvasElement)) {\n      return;\n    }\n    const ctx = canvas.getContext('2d');\n    if (ctx === null) {\n      return;\n    }\n    canvas.width = canvas.offsetWidth * devicePixelRatio;\n    canvas.height = canvas.offsetHeight * devicePixelRatio;\n    this.canvasWidth = canvas.offsetWidth;\n\n    if (this.renderNodesMonitor.ifStateChanged()) {\n      if (this.attrs.data === undefined) {\n        this.renderNodes = undefined;\n        this.lastClickedNode = undefined;\n      } else {\n        this.renderNodes = computeRenderNodes(\n          this.attrs.data,\n          this.zoomRegion ?? {\n            queryXStart: 0,\n            queryXEnd: this.attrs.data.allRootsCumulativeValue,\n            type: 'ROOT',\n          },\n          canvas.offsetWidth,\n        );\n        this.lastClickedNode = this.renderNodes?.find((n) =>\n          isIntersecting(this.lastClickedNode?.x, this.lastClickedNode?.y, n),\n        );\n      }\n      this.tooltipPos = undefined;\n    }\n    if (this.attrs.data === undefined || this.renderNodes === undefined) {\n      return;\n    }\n\n    const containerRect = canvasContainer.getBoundingClientRect();\n    const canvasRect = canvas.getBoundingClientRect();\n\n    const yStart = containerRect.top - canvasRect.top;\n    const yEnd = containerRect.bottom - canvasRect.top;\n\n    const {allRootsCumulativeValue, unfilteredCumulativeValue, nodes} =\n      this.attrs.data;\n    const unit = assertExists(this.selectedMetric).unit;\n\n    ctx.clearRect(0, 0, canvas.offsetWidth, canvas.offsetHeight);\n    ctx.save();\n    ctx.scale(devicePixelRatio, devicePixelRatio);\n\n    ctx.font = LABEL_FONT_STYLE;\n    ctx.textBaseline = 'middle';\n\n    ctx.strokeStyle = 'white';\n    ctx.lineWidth = 0.5;\n\n    if (this.labelCharWidth === 0) {\n      this.labelCharWidth = ctx.measureText('_').width;\n    }\n\n    let hoveredNode: RenderNode | undefined = undefined;\n    for (let i = 0; i < this.renderNodes.length; i++) {\n      const node = this.renderNodes[i];\n      const {x, y, width: width, source, state} = node;\n      if (y + NODE_HEIGHT <= yStart || y >= yEnd) {\n        continue;\n      }\n\n      const hover = isIntersecting(this.hoveredX, this.hoveredY, node);\n      if (hover) {\n        hoveredNode = node;\n      }\n      let name: string;\n      if (source.kind === 'ROOT') {\n        const val = displaySize(allRootsCumulativeValue, unit);\n        const percent = displayPercentage(\n          allRootsCumulativeValue,\n          unfilteredCumulativeValue,\n        );\n        name = `root: ${val} (${percent})`;\n        ctx.fillStyle = generateColor('root', state === 'PARTIAL', hover);\n      } else if (source.kind === 'MERGED') {\n        name = '(merged)';\n        ctx.fillStyle = generateColor(name, state === 'PARTIAL', false);\n      } else {\n        name = nodes[source.queryIdx].name;\n        ctx.fillStyle = generateColor(name, state === 'PARTIAL', hover);\n      }\n      ctx.fillRect(x, y, width - 1, NODE_HEIGHT - 1);\n\n      const widthNoPadding = width - LABEL_PADDING_PX * 2;\n      if (widthNoPadding >= LABEL_MIN_WIDTH_FOR_TEXT_PX) {\n        ctx.fillStyle = 'black';\n        ctx.fillText(\n          name.substring(0, widthNoPadding / this.labelCharWidth),\n          x + LABEL_PADDING_PX,\n          y + (NODE_HEIGHT - 1) / 2,\n          widthNoPadding,\n        );\n      }\n      if (this.lastClickedNode?.x === x && this.lastClickedNode?.y === y) {\n        ctx.strokeStyle = 'blue';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(x, y);\n        ctx.lineTo(x + width, y);\n        ctx.lineTo(x + width, y + NODE_HEIGHT - 1);\n        ctx.lineTo(x, y + NODE_HEIGHT - 1);\n        ctx.lineTo(x, y);\n        ctx.stroke();\n        ctx.strokeStyle = 'white';\n        ctx.lineWidth = 0.5;\n      }\n    }\n    if (hoveredNode === undefined) {\n      canvas.style.cursor = 'default';\n    } else {\n      canvas.style.cursor = 'pointer';\n    }\n    ctx.restore();\n  }\n\n  private renderFilterBar(attrs: FlamegraphAttrs) {\n    const self = this;\n    return m(\n      '.filter-bar',\n      m(\n        Select,\n        {\n          value: attrs.state.selectedMetricName,\n          onchange: (e: Event) => {\n            const el = e.target as HTMLSelectElement;\n            attrs.onStateChange({\n              ...self.attrs.state,\n              selectedMetricName: el.value,\n            });\n            scheduleFullRedraw();\n          },\n        },\n        attrs.metrics.map((x) => {\n          return m('option', {value: x.name}, x.name);\n        }),\n      ),\n      m(\n        Popup,\n        {\n          trigger: m(TagInput, {\n            tags: toTags(self.attrs.state),\n            value: this.rawFilterText,\n            onChange: (value: string) => {\n              self.rawFilterText = value;\n              scheduleFullRedraw();\n            },\n            onTagAdd: (tag: string) => {\n              self.rawFilterText = '';\n              self.attrs.onStateChange(updateState(self.attrs.state, tag));\n              scheduleFullRedraw();\n            },\n            onTagRemove(index: number) {\n              if (index === self.attrs.state.filters.length) {\n                self.attrs.onStateChange({\n                  ...self.attrs.state,\n                  view: {kind: 'TOP_DOWN'},\n                });\n              } else {\n                const filters = Array.from(self.attrs.state.filters);\n                filters.splice(index, 1);\n                self.attrs.onStateChange({\n                  ...self.attrs.state,\n                  filters,\n                });\n              }\n              scheduleFullRedraw();\n            },\n            onfocus() {\n              self.filterFocus = true;\n            },\n            onblur() {\n              self.filterFocus = false;\n            },\n            placeholder: 'Add filter...',\n          }),\n          isOpen: self.filterFocus && this.rawFilterText.length === 0,\n          position: PopupPosition.Bottom,\n        },\n        m('.pf-flamegraph-filter-bar-popup-content', FILTER_EMPTY_TEXT.trim()),\n      ),\n      m(SegmentedButtons, {\n        options: [{label: 'Top Down'}, {label: 'Bottom Up'}],\n        selectedOption: this.attrs.state.view.kind === 'TOP_DOWN' ? 0 : 1,\n        onOptionSelected: (num) => {\n          self.attrs.onStateChange({\n            ...this.attrs.state,\n            view: {kind: num === 0 ? 'TOP_DOWN' : 'BOTTOM_UP'},\n          });\n          scheduleFullRedraw();\n        },\n        disabled: this.attrs.state.view.kind === 'PIVOT',\n      }),\n    );\n  }\n\n  private renderTooltip() {\n    if (this.tooltipPos === undefined) {\n      return undefined;\n    }\n    const {node} = this.tooltipPos;\n    if (node.source.kind === 'MERGED') {\n      return m(\n        'div',\n        m('.tooltip-bold-text', '(merged)'),\n        m('.tooltip-text', 'Nodes too small to show, please use filters'),\n      );\n    }\n    const {nodes, allRootsCumulativeValue, unfilteredCumulativeValue} =\n      assertExists(this.attrs.data);\n    const {unit} = assertExists(this.selectedMetric);\n    if (node.source.kind === 'ROOT') {\n      const val = displaySize(allRootsCumulativeValue, unit);\n      const percent = displayPercentage(\n        allRootsCumulativeValue,\n        unfilteredCumulativeValue,\n      );\n      return m(\n        'div',\n        m('.tooltip-bold-text', 'root'),\n        m(\n          '.tooltip-text-line',\n          m('.tooltip-bold-text', 'Cumulative:'),\n          m('.tooltip-text', `${val}, ${percent}`),\n        ),\n      );\n    }\n    const {queryIdx} = node.source;\n    const {\n      name,\n      cumulativeValue,\n      selfValue,\n      parentCumulativeValue,\n      properties,\n    } = nodes[queryIdx];\n    const filterButtonClick = (state: FlamegraphState) => {\n      this.attrs.onStateChange(state);\n      this.tooltipPos = undefined;\n      scheduleFullRedraw();\n    };\n\n    const percent = displayPercentage(\n      cumulativeValue,\n      unfilteredCumulativeValue,\n    );\n    const selfPercent = displayPercentage(selfValue, unfilteredCumulativeValue);\n\n    let percentText = `all: ${percent}`;\n    let selfPercentText = `all: ${selfPercent}`;\n    if (parentCumulativeValue !== undefined) {\n      const parentPercent = displayPercentage(\n        cumulativeValue,\n        parentCumulativeValue,\n      );\n      percentText += `, parent: ${parentPercent}`;\n      const parentSelfPercent = displayPercentage(\n        selfValue,\n        parentCumulativeValue,\n      );\n      selfPercentText += `, parent: ${parentSelfPercent}`;\n    }\n    return m(\n      'div',\n      m('.tooltip-bold-text', name),\n      m(\n        '.tooltip-text-line',\n        m('.tooltip-bold-text', 'Cumulative:'),\n        m(\n          '.tooltip-text',\n          `${displaySize(cumulativeValue, unit)} (${percentText})`,\n        ),\n      ),\n      m(\n        '.tooltip-text-line',\n        m('.tooltip-bold-text', 'Self:'),\n        m(\n          '.tooltip-text',\n          `${displaySize(selfValue, unit)} (${selfPercentText})`,\n        ),\n      ),\n      Array.from(properties, ([key, value]) => {\n        return m(\n          '.tooltip-text-line',\n          m('.tooltip-bold-text', key + ':'),\n          m('.tooltip-text', value),\n        );\n      }),\n      m(\n        ButtonBar,\n        {},\n        m(Button, {\n          label: 'Zoom',\n          onclick: () => {\n            this.zoomRegion = node.source;\n            scheduleFullRedraw();\n          },\n        }),\n        m(Button, {\n          label: 'Show Stack',\n          onclick: () => {\n            filterButtonClick(\n              addFilter(this.attrs.state, {\n                kind: 'SHOW_STACK',\n                filter: `^${name}$`,\n              }),\n            );\n          },\n        }),\n        m(Button, {\n          label: 'Hide Stack',\n          onclick: () => {\n            filterButtonClick(\n              addFilter(this.attrs.state, {\n                kind: 'HIDE_STACK',\n                filter: `^${name}$`,\n              }),\n            );\n          },\n        }),\n        m(Button, {\n          label: 'Hide Frame',\n          onclick: () => {\n            filterButtonClick(\n              addFilter(this.attrs.state, {\n                kind: 'HIDE_FRAME',\n                filter: `^${name}$`,\n              }),\n            );\n          },\n        }),\n        m(Button, {\n          label: 'Show From Frame',\n          onclick: () => {\n            filterButtonClick(\n              addFilter(this.attrs.state, {\n                kind: 'SHOW_FROM_FRAME',\n                filter: `^${name}$`,\n              }),\n            );\n          },\n        }),\n        m(Button, {\n          label: 'Pivot',\n          onclick: () => {\n            filterButtonClick({\n              ...this.attrs.state,\n              view: {kind: 'PIVOT', pivot: name},\n            });\n          },\n        }),\n      ),\n    );\n  }\n\n  private get selectedMetric() {\n    return this.attrs.metrics.find(\n      (x) => x.name === this.attrs.state.selectedMetricName,\n    );\n  }\n}\n\nfunction computeRenderNodes(\n  {nodes, allRootsCumulativeValue, minDepth}: FlamegraphQueryData,\n  zoomRegion: ZoomRegion,\n  canvasWidth: number,\n): ReadonlyArray<RenderNode> {\n  const renderNodes: RenderNode[] = [];\n\n  const mergedKeyToX = new Map<string, number>();\n  const keyToChildMergedIdx = new Map<string, number>();\n  renderNodes.push({\n    x: 0,\n    y: -minDepth * NODE_HEIGHT,\n    width: canvasWidth,\n    source: {\n      kind: 'ROOT',\n      queryXStart: 0,\n      queryXEnd: allRootsCumulativeValue,\n      type: 'ROOT',\n    },\n    state:\n      zoomRegion.queryXStart === 0 &&\n      zoomRegion.queryXEnd === allRootsCumulativeValue\n        ? 'NORMAL'\n        : 'PARTIAL',\n  });\n\n  const zoomQueryWidth = zoomRegion.queryXEnd - zoomRegion.queryXStart;\n  for (let i = 0; i < nodes.length; i++) {\n    const {id, parentId, depth, xStart: qXStart, xEnd: qXEnd} = nodes[i];\n    assertTrue(depth !== 0);\n\n    const depthMatchingZoom = isDepthMatchingZoom(depth, zoomRegion);\n    if (\n      depthMatchingZoom &&\n      (qXEnd <= zoomRegion.queryXStart || qXStart >= zoomRegion.queryXEnd)\n    ) {\n      continue;\n    }\n    const queryXPerPx = depthMatchingZoom\n      ? zoomQueryWidth / canvasWidth\n      : allRootsCumulativeValue / canvasWidth;\n    const relativeXStart = depthMatchingZoom\n      ? qXStart - zoomRegion.queryXStart\n      : qXStart;\n    const relativeXEnd = depthMatchingZoom\n      ? qXEnd - zoomRegion.queryXStart\n      : qXEnd;\n    const relativeWidth = relativeXEnd - relativeXStart;\n\n    const x = Math.max(0, relativeXStart) / queryXPerPx;\n    const y = NODE_HEIGHT * (depth - minDepth);\n    const width = depthMatchingZoom\n      ? Math.min(relativeWidth, zoomQueryWidth) / queryXPerPx\n      : relativeWidth / queryXPerPx;\n    const state = computeState(qXStart, qXEnd, zoomRegion, depthMatchingZoom);\n\n    if (width < MIN_PIXEL_DISPLAYED) {\n      const parentChildMergeKey = `${parentId}_${depth}`;\n      const mergedXKey = `${id}_${depth > 0 ? depth + 1 : depth - 1}`;\n      const childMergedIdx = keyToChildMergedIdx.get(parentChildMergeKey);\n      if (childMergedIdx !== undefined) {\n        const r = renderNodes[childMergedIdx];\n        const mergedWidth = isDepthMatchingZoom(depth, zoomRegion)\n          ? Math.min(qXEnd - r.source.queryXStart, zoomQueryWidth) / queryXPerPx\n          : (qXEnd - r.source.queryXStart) / queryXPerPx;\n        renderNodes[childMergedIdx] = {\n          ...r,\n          width: Math.max(mergedWidth, MIN_PIXEL_DISPLAYED),\n          source: {\n            ...(r.source as MergedSource),\n            queryXEnd: qXEnd,\n          },\n        };\n        mergedKeyToX.set(mergedXKey, r.x);\n        continue;\n      }\n      const mergedX = mergedKeyToX.get(`${parentId}_${depth}`) ?? x;\n      renderNodes.push({\n        x: mergedX,\n        y,\n        width: Math.max(width, MIN_PIXEL_DISPLAYED),\n        source: {\n          kind: 'MERGED',\n          queryXStart: qXStart,\n          queryXEnd: qXEnd,\n          type: depth > 0 ? 'BELOW_ROOT' : 'ABOVE_ROOT',\n        },\n        state,\n      });\n      keyToChildMergedIdx.set(parentChildMergeKey, renderNodes.length - 1);\n      mergedKeyToX.set(mergedXKey, mergedX);\n      continue;\n    }\n    renderNodes.push({\n      x,\n      y,\n      width,\n      source: {\n        kind: 'NODE',\n        queryXStart: qXStart,\n        queryXEnd: qXEnd,\n        queryIdx: i,\n        type: depth > 0 ? 'BELOW_ROOT' : 'ABOVE_ROOT',\n      },\n      state,\n    });\n  }\n  return renderNodes;\n}\n\nfunction isDepthMatchingZoom(depth: number, zoomRegion: ZoomRegion): boolean {\n  assertTrue(\n    depth !== 0,\n    'Handling zooming root not possible in this function',\n  );\n  return (\n    (depth > 0 && zoomRegion.type === 'BELOW_ROOT') ||\n    (depth < 0 && zoomRegion.type === 'ABOVE_ROOT')\n  );\n}\n\nfunction computeState(\n  qXStart: number,\n  qXEnd: number,\n  zoomRegion: ZoomRegion,\n  isDepthMatchingZoom: boolean,\n) {\n  if (!isDepthMatchingZoom) {\n    return 'NORMAL';\n  }\n  if (qXStart === zoomRegion.queryXStart && qXEnd === zoomRegion.queryXEnd) {\n    return 'SELECTED';\n  }\n  if (qXStart < zoomRegion.queryXStart || qXEnd > zoomRegion.queryXEnd) {\n    return 'PARTIAL';\n  }\n  return 'NORMAL';\n}\n\nfunction isIntersecting(\n  needleX: number | undefined,\n  needleY: number | undefined,\n  {x, y, width}: RenderNode,\n) {\n  if (needleX === undefined || needleY === undefined) {\n    return false;\n  }\n  return (\n    needleX >= x &&\n    needleX < x + width &&\n    needleY >= y &&\n    needleY < y + NODE_HEIGHT\n  );\n}\n\nfunction displaySize(totalSize: number, unit: string): string {\n  if (unit === '') return totalSize.toLocaleString();\n  if (totalSize === 0) return `0 ${unit}`;\n  let step: number;\n  let units: string[];\n  switch (unit) {\n    case 'B':\n      step = 1024;\n      units = ['B', 'KiB', 'MiB', 'GiB'];\n      break;\n    case 'ns':\n      step = 1000;\n      units = ['ns', 'us', 'ms', 's'];\n      break;\n    default:\n      step = 1000;\n      units = [unit, `K${unit}`, `M${unit}`, `G${unit}`];\n      break;\n  }\n  const unitsIndex = Math.min(\n    Math.trunc(Math.log(totalSize) / Math.log(step)),\n    units.length - 1,\n  );\n  const pow = Math.pow(step, unitsIndex);\n  const result = totalSize / pow;\n  const resultString =\n    totalSize % pow === 0 ? result.toString() : result.toFixed(2);\n  return `${resultString} ${units[unitsIndex]}`;\n}\n\nfunction displayPercentage(size: number, totalSize: number): string {\n  if (totalSize === 0) {\n    return `[NULL]%`;\n  }\n  return `${((size / totalSize) * 100.0).toFixed(2)}%`;\n}\n\nfunction updateState(state: FlamegraphState, filter: string): FlamegraphState {\n  const lwr = filter.toLowerCase();\n  if (lwr.startsWith('ss: ') || lwr.startsWith('show stack: ')) {\n    return addFilter(state, {\n      kind: 'SHOW_STACK',\n      filter: filter.split(': ', 2)[1],\n    });\n  } else if (lwr.startsWith('hs: ') || lwr.startsWith('hide stack: ')) {\n    return addFilter(state, {\n      kind: 'HIDE_STACK',\n      filter: filter.split(': ', 2)[1],\n    });\n  } else if (lwr.startsWith('sff: ') || lwr.startsWith('show from frame: ')) {\n    return addFilter(state, {\n      kind: 'SHOW_FROM_FRAME',\n      filter: filter.split(': ', 2)[1],\n    });\n  } else if (lwr.startsWith('hf: ') || lwr.startsWith('hide frame: ')) {\n    return addFilter(state, {\n      kind: 'HIDE_FRAME',\n      filter: filter.split(': ', 2)[1],\n    });\n  } else if (lwr.startsWith('p:') || lwr.startsWith('pivot: ')) {\n    return {\n      ...state,\n      view: {kind: 'PIVOT', pivot: filter.split(': ', 2)[1]},\n    };\n  }\n  return addFilter(state, {\n    kind: 'SHOW_STACK',\n    filter: filter,\n  });\n}\n\nfunction toTags(state: FlamegraphState): ReadonlyArray<string> {\n  const toString = (x: FlamegraphFilter) => {\n    switch (x.kind) {\n      case 'HIDE_FRAME':\n        return 'Hide Frame: ' + x.filter;\n      case 'HIDE_STACK':\n        return 'Hide Stack: ' + x.filter;\n      case 'SHOW_FROM_FRAME':\n        return 'Show From Frame: ' + x.filter;\n      case 'SHOW_STACK':\n        return 'Show Stack: ' + x.filter;\n    }\n  };\n  const filters = state.filters.map((x) => toString(x));\n  return filters.concat(\n    state.view.kind === 'PIVOT' ? ['Pivot: ' + state.view.pivot] : [],\n  );\n}\n\nfunction addFilter(\n  state: FlamegraphState,\n  filter: FlamegraphFilter,\n): FlamegraphState {\n  return {\n    ...state,\n    filters: state.filters.concat([filter]),\n  };\n}\n\nfunction generateColor(name: string, greyed: boolean, hovered: boolean) {\n  if (greyed) {\n    return `hsl(0deg, 0%, ${hovered ? 85 : 80}%)`;\n  }\n  if (name === 'unknown' || name === 'root') {\n    return `hsl(0deg, 0%, ${hovered ? 78 : 73}%)`;\n  }\n  let x = 0;\n  for (let i = 0; i < name.length; ++i) {\n    x += name.charCodeAt(i) % 64;\n  }\n  return `hsl(${x % 360}deg, 45%, ${hovered ? 78 : 73}%)`;\n}\n"]}
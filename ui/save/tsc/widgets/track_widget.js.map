{"version":3,"file":"track_widget.js","sourceRoot":"","sources":["../../../src/widgets/track_widget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {classNames} from '../base/classnames';\nimport {DisposableStack} from '../base/disposable_stack';\nimport {currentTargetOffset} from '../base/dom_utils';\nimport {Bounds2D, Point2D, Vector2D} from '../base/geom';\nimport {clamp} from '../base/math_utils';\nimport {Icons} from '../base/semantic_icons';\nimport {ButtonBar} from './button';\nimport {Chip, ChipBar} from './chip';\nimport {Icon} from './icon';\nimport {MiddleEllipsis} from './middle_ellipsis';\n\n/**\n * The TrackWidget defines the look and style of a track.\n *\n * ┌──────────────────────────────────────────────────────────────────┐\n * │pf-track (grid)                                                   │\n * │┌─────────────────────────────────────────┐┌─────────────────────┐│\n * ││pf-track-shell                           ││pf-track-content     ││\n * ││┌───────────────────────────────────────┐││                     ││\n * │││pf-track-menubar (sticky)              │││                     ││\n * │││┌───────────────┐┌────────────────────┐│││                     ││\n * ││││pf-track-title ││pf-track-buttons    ││││                     ││\n * │││└───────────────┘└────────────────────┘│││                     ││\n * ││└───────────────────────────────────────┘││                     ││\n * │└─────────────────────────────────────────┘└─────────────────────┘│\n * └──────────────────────────────────────────────────────────────────┘\n */\n\nexport interface TrackComponentAttrs {\n  // The title of this track.\n  readonly title: string;\n\n  // The full path to this track.\n  readonly path?: string;\n\n  // Show dropdown arrow and make clickable. Defaults to false.\n  readonly collapsible?: boolean;\n\n  // Show an up or down dropdown arrow.\n  readonly collapsed: boolean;\n\n  // Height of the track in pixels. All tracks have a fixed height.\n  readonly heightPx: number;\n\n  // Optional buttons to place on the RHS of the track shell.\n  readonly buttons?: m.Children;\n\n  // Optional list of chips to display after the track title.\n  readonly chips?: ReadonlyArray<string>;\n\n  // Render this track in error colours.\n  readonly error?: boolean;\n\n  // The integer indentation level of this track. If omitted, defaults to 0.\n  readonly indentationLevel?: number;\n\n  // Track titles are sticky. This is the offset in pixels from the top of the\n  // scrolling parent. Defaults to 0.\n  readonly topOffsetPx?: number;\n\n  // Issues a scrollTo() on this DOM element at creation time. Default: false.\n  readonly revealOnCreate?: boolean;\n\n  // Called when arrow clicked.\n  readonly onToggleCollapsed?: () => void;\n\n  // Style the component differently if it has children.\n  readonly isSummary?: boolean;\n\n  // HTML id applied to the root element.\n  readonly id: string;\n\n  // Whether to highlight the track or not.\n  readonly highlight?: boolean;\n\n  // Whether the shell should be draggable and emit drag/drop events.\n  readonly reorderable?: boolean;\n\n  // Mouse events.\n  readonly onTrackContentMouseMove?: (\n    pos: Point2D,\n    contentSize: Bounds2D,\n  ) => void;\n  readonly onTrackContentMouseOut?: () => void;\n  readonly onTrackContentClick?: (\n    pos: Point2D,\n    contentSize: Bounds2D,\n  ) => boolean;\n\n  // If reorderable, these functions will be called when track shells are\n  // dragged and dropped.\n  readonly onMoveBefore?: (nodeId: string) => void;\n  readonly onMoveAfter?: (nodeId: string) => void;\n}\n\nconst TRACK_HEIGHT_MIN_PX = 18;\nconst INDENTATION_LEVEL_MAX = 16;\nexport class TrackWidget implements m.ClassComponent<TrackComponentAttrs> {\n  private readonly trash = new DisposableStack();\n\n  view({attrs}: m.CVnode<TrackComponentAttrs>) {\n    const {\n      indentationLevel = 0,\n      collapsible,\n      collapsed,\n      highlight,\n      heightPx,\n      id,\n      isSummary,\n    } = attrs;\n\n    const trackHeight = Math.max(heightPx, TRACK_HEIGHT_MIN_PX);\n    const expanded = collapsible && !collapsed;\n\n    return m(\n      '.pf-track',\n      {\n        id,\n        className: classNames(\n          expanded && 'pf-expanded',\n          highlight && 'pf-highlight',\n          isSummary && 'pf-is-summary',\n        ),\n        style: {\n          // Note: Sub-pixel track heights can mess with sticky elements.\n          // Round up to the nearest integer number of pixels.\n          '--indent': clamp(indentationLevel, 0, INDENTATION_LEVEL_MAX),\n          'height': `${Math.ceil(trackHeight)}px`,\n        },\n      },\n      this.renderShell(attrs),\n      this.renderContent(attrs),\n    );\n  }\n\n  oncreate(vnode: m.VnodeDOM<TrackComponentAttrs>) {\n    if (vnode.attrs.revealOnCreate) {\n      vnode.dom.scrollIntoView({behavior: 'smooth', block: 'nearest'});\n    }\n\n    const popupTitleElement = vnode.dom.querySelector('.pf-track-title-popup')!;\n    const truncatedTitleElement = vnode.dom.querySelector(\n      '.pf-middle-ellipsis',\n    )!;\n\n    const resizeObserver = new ResizeObserver(() => {\n      // Work out whether to display a title popup on hover, based on whether\n      // the current title is ellipsized.\n      if (popupTitleElement.clientWidth > truncatedTitleElement.clientWidth) {\n        popupTitleElement.classList.add('pf-visible');\n      } else {\n        popupTitleElement.classList.remove('pf-visible');\n      }\n    });\n    resizeObserver.observe(truncatedTitleElement);\n    resizeObserver.observe(popupTitleElement);\n    this.trash.defer(() => resizeObserver.disconnect());\n  }\n\n  onremove() {\n    this.trash.dispose();\n  }\n\n  private renderShell(attrs: TrackComponentAttrs): m.Children {\n    const chips =\n      attrs.chips &&\n      m(\n        ChipBar,\n        attrs.chips.map((chip) =>\n          m(Chip, {label: chip, compact: true, rounded: true}),\n        ),\n      );\n\n    const {\n      id,\n      topOffsetPx = 0,\n      collapsible,\n      collapsed,\n      reorderable = false,\n      onMoveAfter = () => {},\n      onMoveBefore = () => {},\n    } = attrs;\n\n    return m(\n      `.pf-track-shell[data-track-node-id=${id}]`,\n      {\n        className: classNames(collapsible && 'pf-clickable'),\n        onclick: (e: MouseEvent) => {\n          // Block all clicks on the shell from propagating through to the\n          // canvas\n          e.stopPropagation();\n          if (collapsible) {\n            attrs.onToggleCollapsed?.();\n          }\n        },\n        draggable: reorderable,\n        ondragstart: (e: DragEvent) => {\n          e.dataTransfer?.setData('text/plain', id);\n        },\n        ondragover: (e: DragEvent) => {\n          if (!reorderable) {\n            return;\n          }\n          const target = e.currentTarget as HTMLElement;\n          const threshold = target.offsetHeight / 2;\n          if (e.offsetY > threshold) {\n            target.classList.remove('pf-drag-before');\n            target.classList.add('pf-drag-after');\n          } else {\n            target.classList.remove('pf-drag-after');\n            target.classList.add('pf-drag-before');\n          }\n        },\n        ondragleave: (e: DragEvent) => {\n          if (!reorderable) {\n            return;\n          }\n          const target = e.currentTarget as HTMLElement;\n          const related = e.relatedTarget as HTMLElement | null;\n          if (related && !target.contains(related)) {\n            target.classList.remove('pf-drag-after');\n            target.classList.remove('pf-drag-before');\n          }\n        },\n        ondrop: (e: DragEvent) => {\n          if (!reorderable) {\n            return;\n          }\n          const id = e.dataTransfer?.getData('text/plain');\n          const target = e.currentTarget as HTMLElement;\n          const threshold = target.offsetHeight / 2;\n          if (id !== undefined) {\n            if (e.offsetY > threshold) {\n              onMoveAfter(id);\n            } else {\n              onMoveBefore(id);\n            }\n          }\n          target.classList.remove('pf-drag-after');\n          target.classList.remove('pf-drag-before');\n        },\n      },\n      m(\n        '.pf-track-menubar',\n        {\n          style: {\n            position: 'sticky',\n            top: `${topOffsetPx}px`,\n          },\n        },\n        m(\n          'h1.pf-track-title',\n          {\n            ref: attrs.path, // TODO(stevegolton): Replace with aria tags?\n          },\n          collapsible &&\n            m(Icon, {icon: collapsed ? Icons.ExpandDown : Icons.ExpandUp}),\n          m(\n            MiddleEllipsis,\n            {text: attrs.title},\n            m('.pf-track-title-popup', attrs.title),\n          ),\n          chips,\n        ),\n        m(\n          ButtonBar,\n          {\n            className: 'pf-track-buttons',\n            // Block button clicks from hitting the shell's on click event\n            onclick: (e: MouseEvent) => e.stopPropagation(),\n          },\n          attrs.buttons,\n        ),\n      ),\n    );\n  }\n\n  private mouseDownPos?: Vector2D;\n  private selectionOccurred = false;\n\n  private renderContent(attrs: TrackComponentAttrs): m.Children {\n    const {\n      heightPx,\n      onTrackContentMouseMove,\n      onTrackContentMouseOut,\n      onTrackContentClick,\n    } = attrs;\n    const trackHeight = Math.max(heightPx, TRACK_HEIGHT_MIN_PX);\n\n    return m('.pf-track-content', {\n      style: {\n        height: `${trackHeight}px`,\n      },\n      className: classNames(attrs.error && 'pf-track-content-error'),\n      onmousemove: (e: MouseEvent) => {\n        onTrackContentMouseMove?.(\n          currentTargetOffset(e),\n          getTargetContainerSize(e),\n        );\n      },\n      onmouseout: () => {\n        onTrackContentMouseOut?.();\n      },\n      onmousedown: (e: MouseEvent) => {\n        this.mouseDownPos = currentTargetOffset(e);\n      },\n      onmouseup: (e: MouseEvent) => {\n        if (!this.mouseDownPos) return;\n        if (\n          this.mouseDownPos.sub(currentTargetOffset(e)).manhattanDistance > 1\n        ) {\n          this.selectionOccurred = true;\n        }\n        this.mouseDownPos = undefined;\n      },\n      onclick: (e: MouseEvent) => {\n        // This click event occurs after any selection mouse up/drag events\n        // so we have to look if the mouse moved during this click to know\n        // if a selection occurred.\n        if (this.selectionOccurred) {\n          this.selectionOccurred = false;\n          return;\n        }\n\n        // Returns true if something was selected, so stop propagation.\n        if (\n          onTrackContentClick?.(\n            currentTargetOffset(e),\n            getTargetContainerSize(e),\n          )\n        ) {\n          e.stopPropagation();\n        }\n      },\n    });\n  }\n}\n\nfunction getTargetContainerSize(event: MouseEvent): Bounds2D {\n  const target = event.target as HTMLElement;\n  return target.getBoundingClientRect();\n}\n"]}
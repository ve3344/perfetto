{"version":3,"file":"zoned_interaction_handler_unittest.js","sourceRoot":"","sources":["../../../src/base/zoned_interaction_handler_unittest.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {ZonedInteractionHandler} from './zoned_interaction_handler';\n\ndescribe('ZonedInteractionHandler', () => {\n  let zih: ZonedInteractionHandler;\n  let div: HTMLElement;\n\n  beforeEach(() => {\n    // Create a DOM element\n    div = document.createElement('div');\n    div.style.width = '100px';\n    div.style.height = '100px';\n    document.body.appendChild(div);\n    zih = new ZonedInteractionHandler(div);\n  });\n\n  // Utility functions for simulating mouse events\n  function mouseup(x: number, y: number) {\n    simulateMouseEvent('mouseup', x, y);\n  }\n\n  function mousedown(x: number, y: number) {\n    simulateMouseEvent('mousedown', x, y);\n  }\n\n  function mousemove(x: number, y: number) {\n    simulateMouseEvent('mousemove', x, y);\n  }\n\n  function simulateMouseEvent(kind: string, x: number, y: number) {\n    div.dispatchEvent(\n      new MouseEvent(kind, {\n        bubbles: true,\n        clientX: x,\n        clientY: y,\n      }),\n    );\n  }\n\n  test('overlapping zones', () => {\n    zih.update([\n      {\n        id: 'foo',\n        area: {x: 50, y: 50, width: 50, height: 50},\n        cursor: 'grab',\n      },\n      {\n        id: 'bar',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        cursor: 'pointer',\n      },\n    ]);\n\n    mousemove(30, 30); // inside 'bar'\n    expect(div.style.cursor).toBe('pointer');\n\n    mousemove(70, 70); // inside 'foo'\n    expect(div.style.cursor).toBe('grab');\n  });\n\n  test('click', () => {\n    const handleMouseClick = jest.fn(() => {});\n\n    zih.update([\n      {\n        id: 'foo',\n        area: {x: 0, y: 0, width: 60, height: 60},\n        onClick: handleMouseClick,\n      },\n    ]);\n\n    // Simulate a mouse click\n    mousedown(50, 50);\n    mouseup(50, 50);\n\n    expect(handleMouseClick).toHaveBeenCalled();\n\n    handleMouseClick.mockClear();\n\n    // Simulate a mouse down then a mouseup outside the zone\n    mousedown(50, 50);\n    mouseup(80, 80);\n\n    expect(handleMouseClick).not.toHaveBeenCalled();\n  });\n\n  test('drag', () => {\n    const handleDrag = jest.fn(() => {});\n    const handleDragEnd = jest.fn(() => {});\n\n    zih.update([\n      {\n        id: 'foo',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        drag: {\n          cursorWhileDragging: 'grabbing',\n          onDrag: handleDrag,\n          onDragEnd: handleDragEnd,\n        },\n      },\n    ]);\n\n    // Simulate a mouse drag start\n    mousedown(0, 0);\n    expect(div.style.cursor).toBe('grabbing');\n\n    // Simulate a mouse drag move\n    mousemove(50, 0);\n\n    expect(handleDrag).toHaveBeenCalled();\n\n    // Simulate a drag end\n    mouseup(60, 0);\n    expect(handleDragEnd).toHaveBeenCalled();\n  });\n\n  test('drag with minimum distance', () => {\n    const handleDrag = jest.fn();\n    const handleDragEnd = jest.fn();\n\n    zih.update([\n      {\n        id: 'dragZone',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        drag: {\n          minDistance: 20,\n          onDrag: handleDrag,\n          onDragEnd: handleDragEnd,\n        },\n      },\n    ]);\n\n    // Simulate drag start\n    mousedown(10, 10);\n\n    // Move within the minimum distance\n    mousemove(15, 15);\n    expect(handleDrag).not.toHaveBeenCalled();\n\n    // Move beyond the minimum distance\n    mousemove(40, 40);\n    expect(handleDrag).toHaveBeenCalled();\n\n    // End the drag\n    mouseup(50, 50);\n    expect(handleDragEnd).toHaveBeenCalled();\n  });\n\n  test('onWheel', () => {\n    const handleWheel = jest.fn();\n\n    zih.update([\n      {\n        id: 'foo',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        onWheel: handleWheel,\n      },\n    ]);\n\n    // Simulate a wheel event inside the zone\n    div.dispatchEvent(\n      new WheelEvent('wheel', {\n        bubbles: true,\n        clientX: 50,\n        clientY: 50,\n        deltaX: 5,\n        deltaY: 10,\n      }),\n    );\n\n    expect(handleWheel).toHaveBeenCalled();\n    expect(handleWheel.mock.calls[0][0]).toMatchObject({\n      position: {x: 50, y: 50},\n      deltaX: 5,\n      deltaY: 10,\n    });\n  });\n\n  test('key modifiers', () => {\n    const handleMouseClick = jest.fn();\n\n    zih.update([\n      {\n        id: 'modifierZone',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        keyModifier: 'shift',\n        onClick: handleMouseClick,\n      },\n    ]);\n\n    // Attempt click without holding the modifier key\n    mousedown(50, 50);\n    mouseup(50, 50);\n    expect(handleMouseClick).not.toHaveBeenCalled();\n\n    // Simulate holding down the shift key and clicking\n    document.dispatchEvent(new KeyboardEvent('keydown', {shiftKey: true}));\n    mousedown(50, 50);\n    mouseup(50, 50);\n    expect(handleMouseClick).toHaveBeenCalled();\n\n    // Simulate releasing the shift key\n    document.dispatchEvent(new KeyboardEvent('keyup', {shiftKey: false}));\n    mousedown(50, 50);\n    mouseup(50, 50);\n    expect(handleMouseClick).toHaveBeenCalledTimes(1); // No additional call\n  });\n\n  test('move zone during drag', () => {\n    const handleDrag = jest.fn();\n    const handleDragEnd = jest.fn();\n\n    zih.update([\n      {\n        id: 'dragZone',\n        area: {x: 0, y: 0, width: 100, height: 100},\n        drag: {\n          onDrag: handleDrag,\n          onDragEnd: handleDragEnd,\n        },\n      },\n    ]);\n\n    // Start a drag\n    mousedown(10, 10);\n\n    // Update zones while dragging\n    zih.update([\n      {\n        id: 'dragZone',\n        area: {x: 0, y: 0, width: 10, height: 10},\n        drag: {\n          onDrag: handleDrag,\n          onDragEnd: handleDragEnd,\n        },\n      },\n    ]);\n\n    // Continue dragging - drags are sticky, so even if we drag outside of the\n    // zone, the drag persists\n    mousemove(50, 50);\n    expect(handleDrag).toHaveBeenCalled();\n\n    // End drag\n    mouseup(60, 60);\n    expect(handleDragEnd).toHaveBeenCalled();\n  });\n\n  afterEach(() => {\n    document.body.removeChild(div);\n  });\n});\n"]}
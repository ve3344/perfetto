{"version":3,"file":"drag_gesture_handler.js","sourceRoot":"","sources":["../../../src/base/drag_gesture_handler.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2018 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\n\nexport class DragGestureHandler implements Disposable {\n  private readonly boundOnMouseDown = this.onMouseDown.bind(this);\n  private readonly boundOnMouseMove = this.onMouseMove.bind(this);\n  private readonly boundOnMouseUp = this.onMouseUp.bind(this);\n  private clientRect?: DOMRect;\n  private pendingMouseDownEvent?: MouseEvent;\n  private _isDragging = false;\n\n  constructor(\n    private element: HTMLElement,\n    private onDrag: (x: number, y: number) => void,\n    private onDragStarted: (x: number, y: number) => void = () => {},\n    private onDragFinished = () => {},\n  ) {\n    element.addEventListener('mousedown', this.boundOnMouseDown);\n  }\n\n  private onMouseDown(e: MouseEvent) {\n    this._isDragging = true;\n    document.body.addEventListener('mousemove', this.boundOnMouseMove);\n    document.body.addEventListener('mouseup', this.boundOnMouseUp);\n    this.pendingMouseDownEvent = e;\n  }\n\n  // We don't start the drag gesture on mouse down, instead we wait until\n  // the mouse has moved at least 1px. This prevents accidental drags that\n  // were meant to be clicks.\n  private startDragGesture(e: MouseEvent) {\n    this.clientRect = this.element.getBoundingClientRect();\n    this.onDragStarted(\n      e.clientX - this.clientRect.left,\n      e.clientY - this.clientRect.top,\n    );\n    m.redraw();\n  }\n\n  private onMouseMove(e: MouseEvent) {\n    if (e.buttons === 0) {\n      return this.onMouseUp();\n    }\n    if (\n      this.pendingMouseDownEvent &&\n      (Math.abs(e.clientX - this.pendingMouseDownEvent.clientX) > 1 ||\n        Math.abs(e.clientY - this.pendingMouseDownEvent.clientY) > 1)\n    ) {\n      this.startDragGesture(this.pendingMouseDownEvent);\n      this.pendingMouseDownEvent = undefined;\n    }\n    if (!this.pendingMouseDownEvent) {\n      this.onDrag(\n        e.clientX - this.clientRect!.left,\n        e.clientY - this.clientRect!.top,\n      );\n    }\n  }\n\n  private onMouseUp() {\n    this._isDragging = false;\n    document.body.removeEventListener('mousemove', this.boundOnMouseMove);\n    document.body.removeEventListener('mouseup', this.boundOnMouseUp);\n    if (!this.pendingMouseDownEvent) {\n      this.onDragFinished();\n      m.redraw();\n    }\n  }\n\n  get isDragging() {\n    return this._isDragging;\n  }\n\n  [Symbol.dispose]() {\n    if (this._isDragging) {\n      this.onMouseUp();\n    }\n    document.body.removeEventListener('mousedown', this.boundOnMouseDown);\n    document.body.removeEventListener('mousemove', this.boundOnMouseMove);\n    document.body.removeEventListener('mouseup', this.boundOnMouseUp);\n  }\n}\n"]}
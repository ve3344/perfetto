{"version":3,"file":"table.js","sourceRoot":"","sources":["../../../../../../src/components/widgets/sql/table/table.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {LegacyTableManager} from '../legacy_table/column';\nimport {SqlValue} from '../../../../trace_processor/query_result';\nimport {Timestamp} from '../../timestamp';\nimport {Duration, Time} from '../../../../base/time';\nimport {\n  renderStandardCell,\n  getStandardContextMenuItems,\n} from '../legacy_table/render_cell_utils';\nimport {DurationWidget} from '../../duration';\nimport {SliceRef} from '../../slice';\nimport {\n  asSchedSqlId,\n  asSliceSqlId,\n  asThreadStateSqlId,\n  asUpid,\n  asUtid,\n} from '../../../sql_utils/core_types';\nimport {SchedRef} from '../../sched';\nimport {ThreadStateRef} from '../../thread_state';\nimport {PopupMenu2} from '../../../../widgets/menu';\nimport {Anchor} from '../../../../widgets/anchor';\nimport {showThreadDetailsMenuItem} from '../../thread';\nimport {showProcessDetailsMenuItem} from '../../process';\n\nexport interface SimpleColumn {\n  name: string;\n  renderCell: (value: SqlValue, tableManager: LegacyTableManager) => m.Children;\n}\n\nfunction renderNumericCell(\n  name: string,\n  value: SqlValue,\n  tableManager: LegacyTableManager,\n  renderBigint: (value: bigint) => m.Children,\n): m.Children {\n  if (value === null || typeof value !== 'bigint') {\n    return renderStandardCell(value, name, tableManager);\n  }\n  return renderBigint(value);\n}\n\nexport function createStandardColumn(name: string): SimpleColumn {\n  return {\n    name: name,\n    renderCell: (value: SqlValue, tableManager: LegacyTableManager) =>\n      renderStandardCell(value, name, tableManager),\n  };\n}\n\nexport function createTimestampColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (value: bigint) => {\n      return m(Timestamp, {\n        ts: Time.fromRaw(value),\n        extraMenuItems: getStandardContextMenuItems(value, name, tableManager),\n      });\n    });\n  return col;\n}\n\nexport function createDurationColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (value: bigint) => {\n      return m(DurationWidget, {\n        dur: Duration.fromRaw(value),\n        extraMenuItems: getStandardContextMenuItems(value, name, tableManager),\n      });\n    });\n  return col;\n}\n\nexport function createSliceIdColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (value: bigint) => {\n      return m(SliceRef, {\n        id: asSliceSqlId(Number(value)),\n        name: `${value}`,\n        switchToCurrentSelectionTab: false,\n      });\n    });\n  return col;\n}\n\nexport function createThreadIdColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (utid: bigint) => {\n      return m(\n        PopupMenu2,\n        {\n          trigger: m(Anchor, `${utid}`),\n        },\n        showThreadDetailsMenuItem(asUtid(Number(utid))),\n        getStandardContextMenuItems(utid, name, tableManager),\n      );\n    });\n  return col;\n}\n\nexport function createProcessIdColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (upid: bigint) => {\n      return m(\n        PopupMenu2,\n        {\n          trigger: m(Anchor, `${upid}`),\n        },\n        showProcessDetailsMenuItem(asUpid(Number(upid))),\n        getStandardContextMenuItems(upid, name, tableManager),\n      );\n    });\n  return col;\n}\n\nexport function createSchedIdColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (value: bigint) => {\n      return m(SchedRef, {\n        id: asSchedSqlId(Number(value)),\n        name: `${value}`,\n        switchToCurrentSelectionTab: false,\n      });\n    });\n  return col;\n}\n\nexport function createThreadStateIdColumn(name: string): SimpleColumn {\n  const col = createStandardColumn(name);\n  col.renderCell = (value: SqlValue, tableManager: LegacyTableManager) =>\n    renderNumericCell(name, value, tableManager, (value: bigint) => {\n      return m(ThreadStateRef, {\n        id: asThreadStateSqlId(Number(value)),\n        name: `${value}`,\n        switchToCurrentSelectionTab: false,\n      });\n    });\n  return col;\n}\n"]}
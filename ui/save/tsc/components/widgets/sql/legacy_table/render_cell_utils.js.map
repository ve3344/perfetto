{"version":3,"file":"render_cell_utils.js","sourceRoot":"","sources":["../../../../../../src/components/widgets/sql/legacy_table/render_cell_utils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {LegacyTableManager, SqlColumn} from './column';\nimport {MenuItem, PopupMenu2} from '../../../../widgets/menu';\nimport {SqlValue} from '../../../../trace_processor/query_result';\nimport {isString} from '../../../../base/object_utils';\nimport {sqliteString} from '../../../../base/string_utils';\nimport {Icons} from '../../../../base/semantic_icons';\nimport {copyToClipboard} from '../../../../base/clipboard';\nimport {sqlValueToReadableString} from '../../../../trace_processor/sql_utils';\nimport {Anchor} from '../../../../widgets/anchor';\n\ninterface FilterOp {\n  op: string;\n  requiresParam: boolean; // Denotes if the operator acts on an input value\n}\n\nexport enum FilterOption {\n  GLOB = 'glob',\n  EQUALS_TO = 'equals to',\n  NOT_EQUALS_TO = 'not equals to',\n  GREATER_THAN = 'greater than',\n  GREATER_OR_EQUALS_THAN = 'greater or equals than',\n  LESS_THAN = 'less than',\n  LESS_OR_EQUALS_THAN = 'less or equals than',\n  IS_NULL = 'is null',\n  IS_NOT_NULL = 'is not null',\n}\n\nexport const FILTER_OPTION_TO_OP: Record<FilterOption, FilterOp> = {\n  [FilterOption.GLOB]: {op: 'glob', requiresParam: true},\n  [FilterOption.EQUALS_TO]: {op: '=', requiresParam: true},\n  [FilterOption.NOT_EQUALS_TO]: {op: '!=', requiresParam: true},\n  [FilterOption.GREATER_THAN]: {op: '>', requiresParam: true},\n  [FilterOption.GREATER_OR_EQUALS_THAN]: {op: '>=', requiresParam: true},\n  [FilterOption.LESS_THAN]: {op: '<', requiresParam: true},\n  [FilterOption.LESS_OR_EQUALS_THAN]: {op: '<=', requiresParam: true},\n  [FilterOption.IS_NULL]: {op: 'IS NULL', requiresParam: false},\n  [FilterOption.IS_NOT_NULL]: {op: 'IS NOT NULL', requiresParam: false},\n};\n\nexport const NUMERIC_FILTER_OPTIONS = [\n  FilterOption.EQUALS_TO,\n  FilterOption.NOT_EQUALS_TO,\n  FilterOption.GREATER_THAN,\n  FilterOption.GREATER_OR_EQUALS_THAN,\n  FilterOption.LESS_THAN,\n  FilterOption.LESS_OR_EQUALS_THAN,\n];\n\nexport const STRING_FILTER_OPTIONS = [\n  FilterOption.EQUALS_TO,\n  FilterOption.NOT_EQUALS_TO,\n];\n\nexport const NULL_FILTER_OPTIONS = [\n  FilterOption.IS_NULL,\n  FilterOption.IS_NOT_NULL,\n];\n\nfunction filterOptionMenuItem(\n  label: string,\n  column: SqlColumn,\n  filterOp: (cols: string[]) => string,\n  tableManager: LegacyTableManager,\n): m.Child {\n  return m(MenuItem, {\n    label,\n    onclick: () => {\n      tableManager.addFilter({op: filterOp, columns: [column]});\n    },\n  });\n}\n\n// Return a list of \"standard\" menu items, adding corresponding filters to the given cell.\nexport function getStandardFilters(\n  value: SqlValue,\n  c: SqlColumn,\n  tableManager: LegacyTableManager,\n): m.Child[] {\n  if (value === null) {\n    return NULL_FILTER_OPTIONS.map((option) =>\n      filterOptionMenuItem(\n        option,\n        c,\n        (cols) => `${cols[0]} ${FILTER_OPTION_TO_OP[option].op}`,\n        tableManager,\n      ),\n    );\n  }\n  if (isString(value)) {\n    return STRING_FILTER_OPTIONS.map((option) =>\n      filterOptionMenuItem(\n        option,\n        c,\n        (cols) =>\n          `${cols[0]} ${FILTER_OPTION_TO_OP[option].op} ${sqliteString(value)}`,\n        tableManager,\n      ),\n    );\n  }\n  if (typeof value === 'bigint' || typeof value === 'number') {\n    return NUMERIC_FILTER_OPTIONS.map((option) =>\n      filterOptionMenuItem(\n        option,\n        c,\n        (cols) => `${cols[0]} ${FILTER_OPTION_TO_OP[option].op} ${value}`,\n        tableManager,\n      ),\n    );\n  }\n  return [];\n}\n\nfunction copyMenuItem(label: string, value: string): m.Child {\n  return m(MenuItem, {\n    icon: Icons.Copy,\n    label,\n    onclick: () => {\n      copyToClipboard(value);\n    },\n  });\n}\n\n// Return a list of \"standard\" menu items for the given cell.\nexport function getStandardContextMenuItems(\n  value: SqlValue,\n  column: SqlColumn,\n  tableManager: LegacyTableManager,\n): m.Child[] {\n  const result: m.Child[] = [];\n\n  if (isString(value)) {\n    result.push(copyMenuItem('Copy', value));\n  }\n\n  const filters = getStandardFilters(value, column, tableManager);\n  if (filters.length > 0) {\n    result.push(\n      m(MenuItem, {label: 'Add filter', icon: Icons.Filter}, ...filters),\n    );\n  }\n\n  return result;\n}\n\nexport function displayValue(value: SqlValue): m.Child {\n  if (value === null) {\n    return m('i', 'NULL');\n  }\n  return sqlValueToReadableString(value);\n}\n\nexport function renderStandardCell(\n  value: SqlValue,\n  column: SqlColumn,\n  tableManager: LegacyTableManager,\n): m.Children {\n  const contextMenuItems: m.Child[] = getStandardContextMenuItems(\n    value,\n    column,\n    tableManager,\n  );\n  return m(\n    PopupMenu2,\n    {\n      trigger: m(Anchor, displayValue(value)),\n    },\n    ...contextMenuItems,\n  );\n}\n"]}
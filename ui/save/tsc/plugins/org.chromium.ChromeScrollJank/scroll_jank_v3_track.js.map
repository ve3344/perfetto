{"version":3,"file":"scroll_jank_v3_track.js","sourceRoot":"","sources":["../../../../src/plugins/org.chromium.ChromeScrollJank/scroll_jank_v3_track.ts"],"names":[],"mappings":";AAAA,qDAAqD;AACrD,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;;AAIjC,uGAG8D;AAC9D,+CAAyC;AACzC,0DAA4D;AAE5D,iFAAwE;AAExE,MAAM,kBAAkB,GAAG,SAAS,CAAC;AACrC,MAAM,eAAe,GAAG,OAAO,CAAC;AAEhC,MAAa,iBAAkB,SAAQ,uDAAwB;IAC7D,gBAAgB;QACd,OAAO;YACL,OAAO,EAAE;gBACP;;;;kBAIU,kBAAkB,UAAU,eAAe,WAAW;gBAChE,IAAI;gBACJ,IAAI;gBACJ,KAAK;gBACL,kBAAkB;aACnB;YACD,YAAY,EAAE,2CAA2C;SAC1D,CAAC;IACJ,CAAC;IAED,UAAU,CAAC,GAAa;QACtB,MAAM,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAEpC,IAAI,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,CAAC;QAC3E,oEAAoE;QACpE,mBAAmB;QACnB,MAAM,SAAS,GAAG,IAAI,CAAC;QACvB,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC;YACnC,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC,MAAM,CAAC,CAAC;QACvE,CAAC;QAED,IAAI,KAAK,IAAI,kBAAkB,EAAE,CAAC;YAChC,OAAO,EAAC,GAAG,KAAK,EAAE,WAAW,EAAE,wBAAU,EAAC,CAAC;QAC7C,CAAC;aAAM,CAAC;YACN,OAAO,EAAC,GAAG,KAAK,EAAE,WAAW,EAAE,IAAA,4BAAgB,EAAC,KAAK,CAAC,EAAC,CAAC;QAC1D,CAAC;IACH,CAAC;IAEQ,YAAY,CAAC,GAAwB;QAC5C,OAAO,IAAI,uDAAwB,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;IAC/D,CAAC;CACF;AAvCD,8CAuCC","sourcesContent":["// Copyright (C) 2023 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {NamedRow} from '../../components/tracks/named_slice_track';\nimport {Slice} from '../../public/track';\nimport {\n  CustomSqlTableDefConfig,\n  CustomSqlTableSliceTrack,\n} from '../../components/tracks/custom_sql_table_slice_track';\nimport {JANK_COLOR} from './jank_colors';\nimport {getColorForSlice} from '../../components/colorizer';\nimport {TrackEventSelection} from '../../public/selection';\nimport {ScrollJankV3DetailsPanel} from './scroll_jank_v3_details_panel';\n\nconst UNKNOWN_SLICE_NAME = 'Unknown';\nconst JANK_SLICE_NAME = ' Jank';\n\nexport class ScrollJankV3Track extends CustomSqlTableSliceTrack {\n  getSqlDataSource(): CustomSqlTableDefConfig {\n    return {\n      columns: [\n        `IIF(\n          cause_of_jank IS NOT NULL,\n          cause_of_jank || IIF(\n            sub_cause_of_jank IS NOT NULL, \"::\" || sub_cause_of_jank, \"\"\n            ), \"${UNKNOWN_SLICE_NAME}\") || \"${JANK_SLICE_NAME}\" AS name`,\n        'id',\n        'ts',\n        'dur',\n        'event_latency_id',\n      ],\n      sqlTableName: 'chrome_janky_frame_presentation_intervals',\n    };\n  }\n\n  rowToSlice(row: NamedRow): Slice {\n    const slice = super.rowToSlice(row);\n\n    let stage = slice.title.substring(0, slice.title.indexOf(JANK_SLICE_NAME));\n    // Stage may include substage, in which case we use the substage for\n    // color selection.\n    const separator = '::';\n    if (stage.indexOf(separator) != -1) {\n      stage = stage.substring(stage.indexOf(separator) + separator.length);\n    }\n\n    if (stage == UNKNOWN_SLICE_NAME) {\n      return {...slice, colorScheme: JANK_COLOR};\n    } else {\n      return {...slice, colorScheme: getColorForSlice(stage)};\n    }\n  }\n\n  override detailsPanel(sel: TrackEventSelection) {\n    return new ScrollJankV3DetailsPanel(this.trace, sel.eventId);\n  }\n}\n"]}
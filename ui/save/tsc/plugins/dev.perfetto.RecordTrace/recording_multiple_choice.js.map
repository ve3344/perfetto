{"version":3,"file":"recording_multiple_choice.js","sourceRoot":"","sources":["../../../../src/plugins/dev.perfetto.RecordTrace/recording_multiple_choice.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2022 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {\n  RecordingTargetV2,\n  TargetFactory,\n} from './recordingV2/recording_interfaces_v2';\nimport {RecordingPageController} from './recordingV2/recording_page_controller';\nimport {RECORDING_MODAL_DIALOG_KEY} from './recordingV2/recording_utils';\nimport {closeModal} from '../../widgets/modal';\n\ninterface RecordingMultipleChoiceAttrs {\n  targetFactories: TargetFactory[];\n  // Reference to the controller which maintains the state of the recording\n  // page.\n  controller: RecordingPageController;\n}\n\nexport class RecordingMultipleChoice\n  implements m.ClassComponent<RecordingMultipleChoiceAttrs>\n{\n  private selectedIndex: number = -1;\n\n  targetSelection(\n    targets: RecordingTargetV2[],\n    controller: RecordingPageController,\n  ): m.Vnode | undefined {\n    const targetInfo = controller.getTargetInfo();\n    const targetNames = [];\n    this.selectedIndex = -1;\n    for (let i = 0; i < targets.length; i++) {\n      const targetName = targets[i].getInfo().name;\n      targetNames.push(m('option', targetName));\n      if (targetInfo && targetName === targetInfo.name) {\n        this.selectedIndex = i;\n      }\n    }\n\n    const selectedIndex = this.selectedIndex;\n    return m(\n      'label',\n      m(\n        'select',\n        {\n          selectedIndex,\n          onchange: (e: Event) => {\n            controller.onTargetSelection((e.target as HTMLSelectElement).value);\n          },\n          onupdate: (select) => {\n            // Work around mithril bug\n            // (https://github.com/MithrilJS/mithril.js/issues/2107): We\n            // may update the select's options while also changing the\n            // selectedIndex at the same time. The update of selectedIndex\n            // may be applied before the new options are added to the\n            // select element. Because the new selectedIndex may be\n            // outside of the select's options at that time, we have to\n            // reselect the correct index here after any new children were\n            // added.\n            (select.dom as HTMLSelectElement).selectedIndex =\n              this.selectedIndex;\n          },\n          ...{size: targets.length, multiple: 'multiple'},\n        },\n        ...targetNames,\n      ),\n    );\n  }\n\n  view({attrs}: m.CVnode<RecordingMultipleChoiceAttrs>): m.Vnode[] | undefined {\n    const controller = attrs.controller;\n    if (!controller.shouldShowTargetSelection()) {\n      return undefined;\n    }\n    const targets: RecordingTargetV2[] = [];\n    for (const targetFactory of attrs.targetFactories) {\n      for (const target of targetFactory.listTargets()) {\n        targets.push(target);\n      }\n    }\n    if (targets.length === 0) {\n      return undefined;\n    }\n\n    return [\n      m('text', 'Select target:'),\n      m(\n        '.record-modal-command',\n        this.targetSelection(targets, controller),\n        m(\n          'button.record-modal-button-high',\n          {\n            disabled: this.selectedIndex === -1,\n            onclick: () => {\n              closeModal(RECORDING_MODAL_DIALOG_KEY);\n              controller.onStartRecordingPressed();\n            },\n          },\n          'Connect',\n        ),\n      ),\n    ];\n  }\n}\n"]}
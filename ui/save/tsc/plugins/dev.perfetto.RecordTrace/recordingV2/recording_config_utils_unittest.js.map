{"version":3,"file":"recording_config_utils_unittest.js","sourceRoot":"","sources":["../../../../../src/plugins/dev.perfetto.RecordTrace/recordingV2/recording_config_utils_unittest.ts"],"names":[],"mappings":";AAAA,qDAAqD;AACrD,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEjC,gEAA+D;AAC/D,qEAAwD;AAGxD,IAAI,CAAC,gEAAgE,EAAE,GAAG,EAAE;IAC1E,MAAM,MAAM,GAAG,IAAA,6CAAuB,GAAE,CAAC;IACzC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,kBAAkB;IAE1C,MAAM,UAAU,GAAsB;QACpC,IAAI,EAAE,MAAM;QACZ,UAAU,EAAE,SAAS;QACrB,eAAe,EAAE,EAAE,EAAE,mCAAmC;QACxD,WAAW,EAAE,EAAE;KAChB,CAAC;IAEF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;IACtB,MAAM,MAAM,GAAG,IAAA,uCAAc,EAAC,MAAM,EAAE,UAAU,CAAC,CAAC;IAElD,MAAM,QAAQ,GAAG;QACf,OAAO,EAAE;YACP;gBACE,MAAM,EAAE,KAAK;gBACb,UAAU,EAAE,SAAS;aACtB;YACD;gBACE,MAAM,EAAE,IAAI;gBACZ,UAAU,EAAE,SAAS;aACtB;SACF;QACD,WAAW,EAAE;YACX;gBACE,MAAM,EAAE;oBACN,IAAI,EAAE,uBAAuB;oBAC7B,YAAY,EAAE,CAAC;iBAChB;aACF;YACD;gBACE,MAAM,EAAE;oBACN,IAAI,EAAE,mBAAmB;oBACzB,YAAY,EAAE,CAAC;iBAChB;aACF;YACD;gBACE,MAAM,EAAE;oBACN,IAAI,EAAE,qBAAqB;oBAC3B,YAAY,EAAE,CAAC;oBACf,kBAAkB,EAAE;wBAClB,uBAAuB,EAAE,IAAI;qBAC9B;iBACF;aACF;YACD;gBACE,MAAM,EAAE;oBACN,IAAI,EAAE,cAAc;oBACpB,YAAY,EAAE;wBACZ,YAAY,EAAE;4BACZ,oBAAoB;4BACpB,sBAAsB;4BACtB,oBAAoB;4BACpB,wBAAwB;4BACxB,oBAAoB;4BACpB,0BAA0B;4BAC1B,0BAA0B;4BAC1B,mBAAmB;4BACnB,kBAAkB;4BAClB,4BAA4B;yBAC7B;wBACD,YAAY,EAAE;4BACZ,OAAO,EAAE,IAAI;yBACd;wBACD,cAAc,EAAE,IAAI;qBACrB;iBACF;aACF;SACF;QACD,UAAU,EAAE,KAAK;KAClB,CAAC;IAEF,+DAA+D;IAC/D,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;AACnE,CAAC,CAAC,CAAC","sourcesContent":["// Copyright (C) 2023 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {createEmptyRecordConfig} from '../record_config_types';\nimport {genTraceConfig} from './recording_config_utils';\nimport {AndroidTargetInfo} from './recording_interfaces_v2';\n\ntest('genTraceConfig() can run without manipulating the input config', () => {\n  const config = createEmptyRecordConfig();\n  config.cpuSched = true; // Exercise ftrace\n\n  const targetInfo: AndroidTargetInfo = {\n    name: 'test',\n    targetType: 'ANDROID',\n    androidApiLevel: 31, // >= 32 to exercise symbolizeKsyms\n    dataSources: [],\n  };\n\n  Object.freeze(config);\n  const actual = genTraceConfig(config, targetInfo);\n\n  const expected = {\n    buffers: [\n      {\n        sizeKb: 63488,\n        fillPolicy: 'DISCARD',\n      },\n      {\n        sizeKb: 2048,\n        fillPolicy: 'DISCARD',\n      },\n    ],\n    dataSources: [\n      {\n        config: {\n          name: 'android.packages_list',\n          targetBuffer: 1,\n        },\n      },\n      {\n        config: {\n          name: 'linux.system_info',\n          targetBuffer: 1,\n        },\n      },\n      {\n        config: {\n          name: 'linux.process_stats',\n          targetBuffer: 1,\n          processStatsConfig: {\n            scanAllProcessesOnStart: true,\n          },\n        },\n      },\n      {\n        config: {\n          name: 'linux.ftrace',\n          ftraceConfig: {\n            ftraceEvents: [\n              'sched/sched_switch',\n              'power/suspend_resume',\n              'sched/sched_wakeup',\n              'sched/sched_wakeup_new',\n              'sched/sched_waking',\n              'sched/sched_process_exit',\n              'sched/sched_process_free',\n              'task/task_newtask',\n              'task/task_rename',\n              'sched/sched_blocked_reason',\n            ],\n            compactSched: {\n              enabled: true,\n            },\n            symbolizeKsyms: true,\n          },\n        },\n      },\n    ],\n    durationMs: 10000,\n  };\n\n  // Compare stringified versions to void issues with JS objects.\n  expect(JSON.stringify(actual)).toEqual(JSON.stringify(expected));\n});\n"]}
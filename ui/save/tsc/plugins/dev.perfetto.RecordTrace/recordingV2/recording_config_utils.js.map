{"version":3,"file":"recording_config_utils.js","sourceRoot":"","sources":["../../../../../src/plugins/dev.perfetto.RecordTrace/recordingV2/recording_config_utils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2022 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {isString} from '../../../base/object_utils';\nimport {base64Encode} from '../../../base/string_utils';\nimport {exists} from '../../../base/utils';\nimport {RecordConfig} from '../record_config_types';\nimport {\n  AndroidLogConfig,\n  AndroidLogId,\n  AndroidPowerConfig,\n  AtomId,\n  BufferConfig,\n  ChromeConfig,\n  DataSourceConfig,\n  EtwConfig,\n  FtraceConfig,\n  HeapprofdConfig,\n  JavaContinuousDumpConfig,\n  JavaHprofConfig,\n  MeminfoCounters,\n  NativeContinuousDumpConfig,\n  NetworkPacketTraceConfig,\n  PerfEventConfig,\n  PerfEvents,\n  ProcessStatsConfig,\n  StatsdTracingConfig,\n  StatsdPullAtomConfig,\n  SysStatsConfig,\n  TraceConfig,\n  TrackEventConfig,\n  VmstatCounters,\n} from '../protos';\nimport {TargetInfo} from './recording_interfaces_v2';\nimport PerfClock = PerfEvents.PerfClock;\nimport Timebase = PerfEvents.Timebase;\nimport CallstackSampling = PerfEventConfig.CallstackSampling;\nimport Scope = PerfEventConfig.Scope;\n\nexport interface ConfigProtoEncoded {\n  configProtoText?: string;\n  configProtoBase64?: string;\n  hasDataSources: boolean;\n}\n\nexport class RecordingConfigUtils {\n  private lastConfig?: RecordConfig;\n  private lastTargetInfo?: TargetInfo;\n  private configProtoText?: string;\n  private configProtoBase64?: string;\n  private hasDataSources: boolean = false;\n\n  fetchLatestRecordCommand(\n    recordConfig: RecordConfig,\n    targetInfo: TargetInfo,\n  ): ConfigProtoEncoded {\n    if (\n      recordConfig === this.lastConfig &&\n      targetInfo === this.lastTargetInfo\n    ) {\n      return {\n        configProtoText: this.configProtoText,\n        configProtoBase64: this.configProtoBase64,\n        hasDataSources: this.hasDataSources,\n      };\n    }\n    this.lastConfig = recordConfig;\n    this.lastTargetInfo = targetInfo;\n\n    const traceConfig = genTraceConfig(recordConfig, targetInfo);\n    const configProto = TraceConfig.encode(traceConfig).finish();\n    this.configProtoText = toPbtxt(configProto);\n    this.configProtoBase64 = base64Encode(configProto);\n    this.hasDataSources = traceConfig.dataSources.length > 0;\n    return {\n      configProtoText: this.configProtoText,\n      configProtoBase64: this.configProtoBase64,\n      hasDataSources: this.hasDataSources,\n    };\n  }\n}\n\nfunction enableSchedBlockedReason(androidApiLevel?: number): boolean {\n  return androidApiLevel !== undefined && androidApiLevel >= 31;\n}\n\nfunction enableCompactSched(androidApiLevel?: number): boolean {\n  return androidApiLevel !== undefined && androidApiLevel >= 31;\n}\n\nexport function genTraceConfig(\n  uiCfg: RecordConfig,\n  targetInfo: TargetInfo,\n): TraceConfig {\n  const isAndroid = targetInfo.targetType === 'ANDROID';\n  const isLinux = targetInfo.targetType === 'LINUX';\n  const androidApiLevel = isAndroid ? targetInfo.androidApiLevel : undefined;\n  const protoCfg = new TraceConfig();\n  protoCfg.durationMs = uiCfg.durationMs;\n\n  // Auxiliary buffer for slow-rate events.\n  // Set to 1/8th of the main buffer size, with reasonable limits.\n  let slowBufSizeKb = uiCfg.bufferSizeMb * (1024 / 8);\n  slowBufSizeKb = Math.min(slowBufSizeKb, 2 * 1024);\n  slowBufSizeKb = Math.max(slowBufSizeKb, 256);\n\n  // Main buffer for ftrace and other high-freq events.\n  const fastBufSizeKb = uiCfg.bufferSizeMb * 1024 - slowBufSizeKb;\n\n  protoCfg.buffers.push(new BufferConfig());\n  protoCfg.buffers.push(new BufferConfig());\n  protoCfg.buffers[0].sizeKb = fastBufSizeKb;\n  protoCfg.buffers[1].sizeKb = slowBufSizeKb;\n\n  if (uiCfg.mode === 'STOP_WHEN_FULL') {\n    protoCfg.buffers[0].fillPolicy = BufferConfig.FillPolicy.DISCARD;\n    protoCfg.buffers[1].fillPolicy = BufferConfig.FillPolicy.DISCARD;\n  } else {\n    protoCfg.buffers[0].fillPolicy = BufferConfig.FillPolicy.RING_BUFFER;\n    protoCfg.buffers[1].fillPolicy = BufferConfig.FillPolicy.RING_BUFFER;\n    protoCfg.flushPeriodMs = 30000;\n    if (uiCfg.mode === 'LONG_TRACE') {\n      protoCfg.writeIntoFile = true;\n      protoCfg.fileWritePeriodMs = uiCfg.fileWritePeriodMs;\n      protoCfg.maxFileSizeBytes = uiCfg.maxFileSizeMb * 1e6;\n    }\n\n    // Clear incremental state every 5 seconds when tracing into a ring\n    // buffer.\n    const incStateConfig = new TraceConfig.IncrementalStateConfig();\n    incStateConfig.clearPeriodMs = 5000;\n    protoCfg.incrementalStateConfig = incStateConfig;\n  }\n\n  const ftraceEvents = new Set<string>(uiCfg.ftrace ? uiCfg.ftraceEvents : []);\n  const atraceCats = new Set<string>(uiCfg.atrace ? uiCfg.atraceCats : []);\n  const atraceApps = new Set<string>();\n  const chromeCategories = new Set<string>();\n  uiCfg.chromeCategoriesSelected.forEach((it) => chromeCategories.add(it));\n  uiCfg.chromeHighOverheadCategoriesSelected.forEach((it) =>\n    chromeCategories.add(it),\n  );\n\n  let procThreadAssociationPolling = false;\n  let procThreadAssociationFtrace = false;\n  let trackInitialOomScore = false;\n\n  if (isAndroid) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.targetBuffer = 1;\n    ds.config.name = 'android.packages_list';\n    protoCfg.dataSources.push(ds);\n  }\n\n  if (isAndroid || isLinux) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.targetBuffer = 1;\n    ds.config.name = 'linux.system_info';\n    protoCfg.dataSources.push(ds);\n  }\n\n  let ftrace = false;\n  let symbolizeKsyms = false;\n  if (uiCfg.cpuSched) {\n    procThreadAssociationPolling = true;\n    procThreadAssociationFtrace = true;\n    ftrace = true;\n    if (enableSchedBlockedReason(androidApiLevel)) {\n      symbolizeKsyms = true;\n    }\n    ftraceEvents.add('sched/sched_switch');\n    ftraceEvents.add('power/suspend_resume');\n    ftraceEvents.add('sched/sched_wakeup');\n    ftraceEvents.add('sched/sched_wakeup_new');\n    ftraceEvents.add('sched/sched_waking');\n    ftraceEvents.add('power/suspend_resume');\n  }\n\n  let sysStatsCfg: SysStatsConfig | undefined = undefined;\n\n  if (uiCfg.cpuFreq) {\n    ftraceEvents.add('power/cpu_frequency');\n    ftraceEvents.add('power/cpu_idle');\n    ftraceEvents.add('power/suspend_resume');\n\n    sysStatsCfg = new SysStatsConfig();\n    sysStatsCfg.cpufreqPeriodMs = uiCfg.cpuFreqPollMs;\n  }\n\n  if (uiCfg.gpuFreq) {\n    ftraceEvents.add('power/gpu_frequency');\n  }\n\n  if (uiCfg.gpuMemTotal) {\n    ftraceEvents.add('gpu_mem/gpu_mem_total');\n\n    if (targetInfo.targetType !== 'CHROME') {\n      const ds = new TraceConfig.DataSource();\n      ds.config = new DataSourceConfig();\n      ds.config.name = 'android.gpu.memory';\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.gpuWorkPeriod) {\n    ftraceEvents.add('power/gpu_work_period');\n  }\n\n  if (uiCfg.cpuSyscall) {\n    ftraceEvents.add('raw_syscalls/sys_enter');\n    ftraceEvents.add('raw_syscalls/sys_exit');\n  }\n\n  if (uiCfg.batteryDrain) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    if (\n      targetInfo.targetType === 'CHROME_OS' ||\n      targetInfo.targetType === 'LINUX'\n    ) {\n      ds.config.name = 'linux.sysfs_power';\n    } else {\n      ds.config.name = 'android.power';\n      ds.config.androidPowerConfig = new AndroidPowerConfig();\n      ds.config.androidPowerConfig.batteryPollMs = uiCfg.batteryDrainPollMs;\n      ds.config.androidPowerConfig.batteryCounters = [\n        AndroidPowerConfig.BatteryCounters.BATTERY_COUNTER_CAPACITY_PERCENT,\n        AndroidPowerConfig.BatteryCounters.BATTERY_COUNTER_CHARGE,\n        AndroidPowerConfig.BatteryCounters.BATTERY_COUNTER_CURRENT,\n      ];\n      ds.config.androidPowerConfig.collectPowerRails = true;\n    }\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.boardSensors) {\n    ftraceEvents.add('regulator/regulator_set_voltage');\n    ftraceEvents.add('regulator/regulator_set_voltage_complete');\n    ftraceEvents.add('power/clock_enable');\n    ftraceEvents.add('power/clock_disable');\n    ftraceEvents.add('power/clock_set_rate');\n    ftraceEvents.add('power/suspend_resume');\n  }\n\n  if (uiCfg.cpuCoarse) {\n    if (sysStatsCfg === undefined) sysStatsCfg = new SysStatsConfig();\n    sysStatsCfg.statPeriodMs = uiCfg.cpuCoarsePollMs;\n    sysStatsCfg.statCounters = [\n      SysStatsConfig.StatCounters.STAT_CPU_TIMES,\n      SysStatsConfig.StatCounters.STAT_FORK_COUNT,\n    ];\n  }\n\n  if (uiCfg.memHiFreq) {\n    procThreadAssociationPolling = true;\n    procThreadAssociationFtrace = true;\n    ftraceEvents.add('mm_event/mm_event_record');\n    ftraceEvents.add('kmem/rss_stat');\n    ftraceEvents.add('ion/ion_stat');\n    ftraceEvents.add('dmabuf_heap/dma_heap_stat');\n    ftraceEvents.add('kmem/ion_heap_grow');\n    ftraceEvents.add('kmem/ion_heap_shrink');\n  }\n\n  if (procThreadAssociationFtrace) {\n    ftraceEvents.add('sched/sched_process_exit');\n    ftraceEvents.add('sched/sched_process_free');\n    ftraceEvents.add('task/task_newtask');\n    ftraceEvents.add('task/task_rename');\n  }\n\n  if (uiCfg.linuxDeviceRpm) {\n    ftraceEvents.add('rpm/rpm_status');\n  }\n\n  if (uiCfg.meminfo) {\n    if (sysStatsCfg === undefined) sysStatsCfg = new SysStatsConfig();\n    sysStatsCfg.meminfoPeriodMs = uiCfg.meminfoPeriodMs;\n    sysStatsCfg.meminfoCounters = uiCfg.meminfoCounters.map((name) => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return MeminfoCounters[name as any as number] as any as number;\n    });\n  }\n\n  if (uiCfg.vmstat) {\n    if (sysStatsCfg === undefined) sysStatsCfg = new SysStatsConfig();\n    sysStatsCfg.vmstatPeriodMs = uiCfg.vmstatPeriodMs;\n    sysStatsCfg.vmstatCounters = uiCfg.vmstatCounters.map((name) => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return VmstatCounters[name as any as number] as any as number;\n    });\n  }\n\n  if (uiCfg.memLmk) {\n    // For in-kernel LMK (roughly older devices until Go and Pixel 3).\n    ftraceEvents.add('lowmemorykiller/lowmemory_kill');\n\n    // For userspace LMKd (newer devices).\n    // 'lmkd' is not really required because the code in lmkd.c emits events\n    // with ATRACE_TAG_ALWAYS. We need something just to ensure that the final\n    // config will enable atrace userspace events.\n    atraceApps.add('lmkd');\n\n    ftraceEvents.add('oom/oom_score_adj_update');\n    procThreadAssociationPolling = true;\n    trackInitialOomScore = true;\n  }\n\n  let heapprofd: HeapprofdConfig | undefined = undefined;\n  if (uiCfg.heapProfiling) {\n    // TODO(hjd): Check or inform user if buffer size are too small.\n    const cfg = new HeapprofdConfig();\n    cfg.samplingIntervalBytes = uiCfg.hpSamplingIntervalBytes;\n    if (\n      uiCfg.hpSharedMemoryBuffer >= 8192 &&\n      uiCfg.hpSharedMemoryBuffer % 4096 === 0\n    ) {\n      cfg.shmemSizeBytes = uiCfg.hpSharedMemoryBuffer;\n    }\n    for (const value of uiCfg.hpProcesses.split('\\n')) {\n      if (value === '') {\n        // Ignore empty lines\n      } else if (isNaN(+value)) {\n        cfg.processCmdline.push(value);\n      } else {\n        cfg.pid.push(+value);\n      }\n    }\n    if (uiCfg.hpContinuousDumpsInterval > 0) {\n      const cdc = (cfg.continuousDumpConfig = new NativeContinuousDumpConfig());\n      cdc.dumpIntervalMs = uiCfg.hpContinuousDumpsInterval;\n      if (uiCfg.hpContinuousDumpsPhase > 0) {\n        cdc.dumpPhaseMs = uiCfg.hpContinuousDumpsPhase;\n      }\n    }\n    cfg.blockClient = uiCfg.hpBlockClient;\n    if (uiCfg.hpAllHeaps) {\n      cfg.allHeaps = true;\n    }\n    heapprofd = cfg;\n  }\n\n  let javaHprof: JavaHprofConfig | undefined = undefined;\n  if (uiCfg.javaHeapDump) {\n    const cfg = new JavaHprofConfig();\n    for (const value of uiCfg.jpProcesses.split('\\n')) {\n      if (value === '') {\n        // Ignore empty lines\n      } else if (isNaN(+value)) {\n        cfg.processCmdline.push(value);\n      } else {\n        cfg.pid.push(+value);\n      }\n    }\n    if (uiCfg.jpContinuousDumpsInterval > 0) {\n      const cdc = (cfg.continuousDumpConfig = new JavaContinuousDumpConfig());\n      cdc.dumpIntervalMs = uiCfg.jpContinuousDumpsInterval;\n      if (uiCfg.hpContinuousDumpsPhase > 0) {\n        cdc.dumpPhaseMs = uiCfg.jpContinuousDumpsPhase;\n      }\n    }\n    javaHprof = cfg;\n  }\n\n  if (uiCfg.procStats || procThreadAssociationPolling || trackInitialOomScore) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.targetBuffer = 1; // Aux\n    ds.config.name = 'linux.process_stats';\n    ds.config.processStatsConfig = new ProcessStatsConfig();\n    if (uiCfg.procStats) {\n      ds.config.processStatsConfig.procStatsPollMs = uiCfg.procStatsPeriodMs;\n    }\n    if (procThreadAssociationPolling || trackInitialOomScore) {\n      ds.config.processStatsConfig.scanAllProcessesOnStart = true;\n    }\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.androidLogs) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'android.log';\n    ds.config.androidLogConfig = new AndroidLogConfig();\n    ds.config.androidLogConfig.logIds = uiCfg.androidLogBuffers.map((name) => {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      return AndroidLogId[name as any as number] as any as number;\n    });\n\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.androidFrameTimeline) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'android.surfaceflinger.frametimeline';\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.androidGameInterventionList) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'android.game_interventions';\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.androidNetworkTracing) {\n    if (targetInfo.targetType !== 'CHROME') {\n      const net = new TraceConfig.DataSource();\n      net.config = new DataSourceConfig();\n      net.config.name = 'android.network_packets';\n      net.config.networkPacketTraceConfig = new NetworkPacketTraceConfig();\n      net.config.networkPacketTraceConfig.pollMs =\n        uiCfg.androidNetworkTracingPollMs;\n      protoCfg.dataSources.push(net);\n\n      // Record package info so that Perfetto can display the package name for\n      // network packet events based on the event uid.\n      const pkg = new TraceConfig.DataSource();\n      pkg.config = new DataSourceConfig();\n      pkg.config.name = 'android.packages_list';\n      protoCfg.dataSources.push(pkg);\n    }\n  }\n\n  if (uiCfg.androidStatsd) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'android.statsd';\n    ds.config.statsdTracingConfig = new StatsdTracingConfig();\n\n    if (uiCfg.androidStatsdRawPushedAtoms.length > 0) {\n      ds.config.statsdTracingConfig.rawPushAtomId = [];\n      for (const line of uiCfg.androidStatsdRawPushedAtoms.split('\\n')) {\n        if (line.trim().length > 0) {\n          ds.config.statsdTracingConfig.rawPushAtomId.push(parseInt(line));\n        }\n      }\n    }\n\n    if (uiCfg.androidStatsdPushedAtoms.length > 0) {\n      ds.config.statsdTracingConfig.pushAtomId =\n        uiCfg.androidStatsdPushedAtoms.map((atom) => atom as unknown as AtomId);\n    }\n\n    const needPulledAtomConfig =\n      uiCfg.androidStatsdRawPulledAtoms.length > 0 ||\n      uiCfg.androidStatsdPulledAtoms.length > 0;\n\n    if (needPulledAtomConfig) {\n      const pullAtomConfig = new StatsdPullAtomConfig();\n      if (uiCfg.androidStatsdRawPulledAtoms.length > 0) {\n        for (const line of uiCfg.androidStatsdRawPulledAtoms.split('\\n')) {\n          if (line.trim().length > 0) {\n            pullAtomConfig.rawPullAtomId.push(parseInt(line));\n          }\n        }\n      }\n      pullAtomConfig.pullAtomId = uiCfg.androidStatsdPulledAtoms.map(\n        (atom) => atom as unknown as AtomId,\n      );\n      pullAtomConfig.pullFrequencyMs =\n        uiCfg.androidStatsdPulledAtomPullFrequencyMs;\n      if (uiCfg.androidStatsdPulledAtomPackages.length > 0) {\n        for (const line of uiCfg.androidStatsdPulledAtomPackages.split('\\n')) {\n          if (line.trim().length > 0) {\n            pullAtomConfig.packages.push(line);\n          }\n        }\n      }\n      ds.config.statsdTracingConfig.pullConfig = [pullAtomConfig];\n    }\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (uiCfg.chromeLogs) {\n    chromeCategories.add('log');\n  }\n\n  if (uiCfg.taskScheduling) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('toplevel.flow');\n    chromeCategories.add('scheduler');\n    chromeCategories.add('sequence_manager');\n    chromeCategories.add('disabled-by-default-toplevel.flow');\n  }\n\n  if (uiCfg.ipcFlows) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('toplevel.flow');\n    chromeCategories.add('disabled-by-default-ipc.flow');\n    chromeCategories.add('mojom');\n  }\n\n  if (uiCfg.jsExecution) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('v8');\n  }\n\n  if (uiCfg.webContentRendering) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('blink');\n    chromeCategories.add('cc');\n    chromeCategories.add('gpu');\n  }\n\n  if (uiCfg.uiRendering) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('cc');\n    chromeCategories.add('gpu');\n    chromeCategories.add('viz');\n    chromeCategories.add('ui');\n    chromeCategories.add('views');\n  }\n\n  if (uiCfg.inputEvents) {\n    chromeCategories.add('toplevel');\n    chromeCategories.add('benchmark');\n    chromeCategories.add('evdev');\n    chromeCategories.add('input');\n    chromeCategories.add('disabled-by-default-toplevel.flow');\n  }\n\n  if (uiCfg.navigationAndLoading) {\n    chromeCategories.add('loading');\n    chromeCategories.add('net');\n    chromeCategories.add('netlog');\n    chromeCategories.add('navigation');\n    chromeCategories.add('browser');\n  }\n\n  if (uiCfg.audio) {\n    function addCategoryAndDisabledByDefault(category: string) {\n      chromeCategories.add(category);\n      chromeCategories.add('disabled-by-default-' + category);\n    }\n\n    addCategoryAndDisabledByDefault('audio');\n    addCategoryAndDisabledByDefault('webaudio');\n    addCategoryAndDisabledByDefault('webaudio.audionode');\n    addCategoryAndDisabledByDefault('webrtc');\n    addCategoryAndDisabledByDefault('audio-worklet');\n    addCategoryAndDisabledByDefault('mediastream');\n    addCategoryAndDisabledByDefault('v8.gc');\n    addCategoryAndDisabledByDefault('toplevel');\n    addCategoryAndDisabledByDefault('toplevel.flow');\n    addCategoryAndDisabledByDefault('wakeup.flow');\n    addCategoryAndDisabledByDefault('cpu_profiler');\n    addCategoryAndDisabledByDefault('scheduler');\n    addCategoryAndDisabledByDefault('p2p');\n    addCategoryAndDisabledByDefault('net');\n    chromeCategories.add('base');\n  }\n\n  if (uiCfg.video) {\n    chromeCategories.add('base');\n    chromeCategories.add('gpu');\n    chromeCategories.add('gpu.capture');\n    chromeCategories.add('media');\n    chromeCategories.add('toplevel');\n    chromeCategories.add('toplevel.flow');\n    chromeCategories.add('scheduler');\n    chromeCategories.add('wakeup.flow');\n    chromeCategories.add('webrtc');\n    chromeCategories.add('disabled-by-default-video_and_image_capture');\n    chromeCategories.add('disabled-by-default-webrtc');\n  }\n\n  // linux.perf stack sampling\n  if (uiCfg.tracePerf) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'linux.perf';\n\n    const perfEventConfig = new PerfEventConfig();\n    perfEventConfig.timebase = new Timebase();\n    perfEventConfig.timebase.frequency = uiCfg.timebaseFrequency;\n    // TODO: The timestampClock needs to be changed to MONOTONIC once we start\n    // offering a choice of counter to record on through the recording UI, as\n    // not all clocks are compatible with hardware counters).\n    perfEventConfig.timebase.timestampClock = PerfClock.PERF_CLOCK_BOOTTIME;\n\n    const callstackSampling = new CallstackSampling();\n    if (uiCfg.targetCmdLine.length > 0) {\n      const scope = new Scope();\n      for (const cmdLine of uiCfg.targetCmdLine) {\n        if (cmdLine == '') {\n          continue;\n        }\n        scope.targetCmdline?.push(cmdLine.trim());\n      }\n      callstackSampling.scope = scope;\n    }\n\n    perfEventConfig.callstackSampling = callstackSampling;\n\n    ds.config.perfEventConfig = perfEventConfig;\n    protoCfg.dataSources.push(ds);\n  }\n\n  if (chromeCategories.size !== 0) {\n    let chromeRecordMode;\n    if (uiCfg.mode === 'STOP_WHEN_FULL') {\n      chromeRecordMode = 'record-until-full';\n    } else {\n      chromeRecordMode = 'record-continuously';\n    }\n    const configStruct = {\n      record_mode: chromeRecordMode,\n      included_categories: [...chromeCategories.values()],\n      // Only include explicitly selected categories\n      excluded_categories: ['*'],\n      memory_dump_config: {},\n    };\n    if (chromeCategories.has('disabled-by-default-memory-infra')) {\n      configStruct.memory_dump_config = {\n        allowed_dump_modes: ['background', 'light', 'detailed'],\n        triggers: [\n          {\n            min_time_between_dumps_ms: 10000,\n            mode: 'detailed',\n            type: 'periodic_interval',\n          },\n        ],\n      };\n    }\n    const chromeConfig = new ChromeConfig();\n    chromeConfig.clientPriority = ChromeConfig.ClientPriority.USER_INITIATED;\n    chromeConfig.privacyFilteringEnabled = uiCfg.chromePrivacyFiltering;\n    chromeConfig.traceConfig = JSON.stringify(configStruct);\n\n    const traceDs = new TraceConfig.DataSource();\n    traceDs.config = new DataSourceConfig();\n    traceDs.config.name = 'org.chromium.trace_event';\n    traceDs.config.chromeConfig = chromeConfig;\n    protoCfg.dataSources.push(traceDs);\n\n    // Configure \"track_event\" datasource for the Chrome SDK build.\n    const trackEventDs = new TraceConfig.DataSource();\n    trackEventDs.config = new DataSourceConfig();\n    trackEventDs.config.name = 'track_event';\n    trackEventDs.config.chromeConfig = chromeConfig;\n    trackEventDs.config.trackEventConfig = new TrackEventConfig();\n    trackEventDs.config.trackEventConfig.disabledCategories = ['*'];\n    trackEventDs.config.trackEventConfig.enabledCategories = [\n      ...chromeCategories.values(),\n      '__metadata',\n    ];\n    trackEventDs.config.trackEventConfig.enableThreadTimeSampling = true;\n    trackEventDs.config.trackEventConfig.timestampUnitMultiplier = 1000;\n    trackEventDs.config.trackEventConfig.filterDynamicEventNames =\n      uiCfg.chromePrivacyFiltering;\n    trackEventDs.config.trackEventConfig.filterDebugAnnotations =\n      uiCfg.chromePrivacyFiltering;\n    protoCfg.dataSources.push(trackEventDs);\n\n    const metadataDs = new TraceConfig.DataSource();\n    metadataDs.config = new DataSourceConfig();\n    metadataDs.config.name = 'org.chromium.trace_metadata';\n    metadataDs.config.chromeConfig = chromeConfig;\n    protoCfg.dataSources.push(metadataDs);\n\n    if (chromeCategories.has('disabled-by-default-memory-infra')) {\n      const memoryDs = new TraceConfig.DataSource();\n      memoryDs.config = new DataSourceConfig();\n      memoryDs.config.name = 'org.chromium.memory_instrumentation';\n      memoryDs.config.chromeConfig = chromeConfig;\n      protoCfg.dataSources.push(memoryDs);\n\n      const HeapProfDs = new TraceConfig.DataSource();\n      HeapProfDs.config = new DataSourceConfig();\n      HeapProfDs.config.name = 'org.chromium.native_heap_profiler';\n      HeapProfDs.config.chromeConfig = chromeConfig;\n      protoCfg.dataSources.push(HeapProfDs);\n    }\n\n    if (\n      chromeCategories.has('disabled-by-default-cpu_profiler') ||\n      chromeCategories.has('disabled-by-default-cpu_profiler.debug')\n    ) {\n      const dataSource = new TraceConfig.DataSource();\n      dataSource.config = new DataSourceConfig();\n      dataSource.config.name = 'org.chromium.sampler_profiler';\n      dataSource.config.chromeConfig = chromeConfig;\n      protoCfg.dataSources.push(dataSource);\n    }\n    if (chromeCategories.has('disabled-by-default-system_metrics')) {\n      const dataSource = new TraceConfig.DataSource();\n      dataSource.config = new DataSourceConfig();\n      dataSource.config.name = 'org.chromium.system_metrics';\n      dataSource.config.chromeConfig = chromeConfig;\n      protoCfg.dataSources.push(dataSource);\n    }\n  }\n\n  // Keep these last. The stages above can enrich them.\n  if (\n    targetInfo.targetType !== 'WINDOWS' &&\n    targetInfo.targetType !== 'CHROME'\n  ) {\n    if (sysStatsCfg !== undefined) {\n      const ds = new TraceConfig.DataSource();\n      ds.config = new DataSourceConfig();\n      ds.config.name = 'linux.sys_stats';\n      ds.config.sysStatsConfig = sysStatsCfg;\n      protoCfg.dataSources.push(ds);\n    }\n\n    if (heapprofd !== undefined) {\n      const ds = new TraceConfig.DataSource();\n      ds.config = new DataSourceConfig();\n      ds.config.targetBuffer = 0;\n      ds.config.name = 'android.heapprofd';\n      ds.config.heapprofdConfig = heapprofd;\n      protoCfg.dataSources.push(ds);\n    }\n\n    if (javaHprof !== undefined) {\n      const ds = new TraceConfig.DataSource();\n      ds.config = new DataSourceConfig();\n      ds.config.targetBuffer = 0;\n      ds.config.name = 'android.java_hprof';\n      ds.config.javaHprofConfig = javaHprof;\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (\n    uiCfg.ftrace ||\n    ftrace ||\n    uiCfg.atrace ||\n    ftraceEvents.size > 0 ||\n    atraceCats.size > 0 ||\n    atraceApps.size > 0\n  ) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'linux.ftrace';\n    ds.config.ftraceConfig = new FtraceConfig();\n    // Override the advanced ftrace parameters only if the user has ticked the\n    // \"Advanced ftrace config\" tab.\n    if (uiCfg.ftrace || ftrace) {\n      if (uiCfg.ftraceBufferSizeKb) {\n        ds.config.ftraceConfig.bufferSizeKb = uiCfg.ftraceBufferSizeKb;\n      }\n      if (uiCfg.ftraceDrainPeriodMs) {\n        ds.config.ftraceConfig.drainPeriodMs = uiCfg.ftraceDrainPeriodMs;\n      }\n      if (uiCfg.symbolizeKsyms || symbolizeKsyms) {\n        ds.config.ftraceConfig.symbolizeKsyms = true;\n        ftraceEvents.add('sched/sched_blocked_reason');\n      }\n      for (const line of uiCfg.ftraceExtraEvents.split('\\n')) {\n        if (line.trim().length > 0) ftraceEvents.add(line.trim());\n      }\n    }\n\n    if (uiCfg.atrace) {\n      if (uiCfg.allAtraceApps) {\n        atraceApps.clear();\n        atraceApps.add('*');\n      } else {\n        for (const line of uiCfg.atraceApps.split('\\n')) {\n          if (line.trim().length > 0) atraceApps.add(line.trim());\n        }\n      }\n    }\n\n    if (atraceCats.size > 0 || atraceApps.size > 0) {\n      ftraceEvents.add('ftrace/print');\n    }\n\n    let ftraceEventsArray: string[] = [];\n    if (exists(androidApiLevel) && androidApiLevel === 28) {\n      for (const ftraceEvent of ftraceEvents) {\n        // On P, we don't support groups so strip all group names from ftrace\n        // events.\n        const groupAndName = ftraceEvent.split('/');\n        if (groupAndName.length !== 2) {\n          ftraceEventsArray.push(ftraceEvent);\n          continue;\n        }\n        // Filter out any wildcard event groups which was not supported\n        // before Q.\n        if (groupAndName[1] === '*') {\n          continue;\n        }\n        ftraceEventsArray.push(groupAndName[1]);\n      }\n    } else {\n      ftraceEventsArray = Array.from(ftraceEvents);\n    }\n\n    ds.config.ftraceConfig.ftraceEvents = ftraceEventsArray;\n    ds.config.ftraceConfig.atraceCategories = Array.from(atraceCats);\n    ds.config.ftraceConfig.atraceApps = Array.from(atraceApps);\n\n    if (enableCompactSched(androidApiLevel)) {\n      const compact = new FtraceConfig.CompactSchedConfig();\n      compact.enabled = true;\n      ds.config.ftraceConfig.compactSched = compact;\n    }\n\n    if (targetInfo.targetType !== 'CHROME') {\n      protoCfg.dataSources.push(ds);\n    }\n  }\n\n  if (\n    targetInfo.targetType === 'WINDOWS' ||\n    uiCfg.etwCSwitch ||\n    uiCfg.etwThreadState\n  ) {\n    const ds = new TraceConfig.DataSource();\n    ds.config = new DataSourceConfig();\n    ds.config.name = 'org.chromium.etw_system';\n    ds.config.etwConfig = new EtwConfig();\n\n    const kernelFlags: EtwConfig.KernelFlag[] = [];\n\n    if (uiCfg.etwCSwitch) {\n      kernelFlags.push(EtwConfig.KernelFlag.CSWITCH);\n    }\n    if (uiCfg.etwThreadState) {\n      kernelFlags.push(EtwConfig.KernelFlag.DISPATCHER);\n    }\n    ds.config.etwConfig.kernelFlags = kernelFlags;\n    protoCfg.dataSources.push(ds);\n  }\n\n  return protoCfg;\n}\n\nfunction toPbtxt(configBuffer: Uint8Array): string {\n  const msg = TraceConfig.decode(configBuffer);\n  const json = msg.toJSON();\n  function snakeCase(s: string): string {\n    return s.replace(/[A-Z]/g, (c) => '_' + c.toLowerCase());\n  }\n  // With the ahead of time compiled protos we can't seem to tell which\n  // fields are enums.\n  function isEnum(value: string): boolean {\n    return (\n      value.startsWith('MEMINFO_') ||\n      value.startsWith('VMSTAT_') ||\n      value.startsWith('STAT_') ||\n      value.startsWith('LID_') ||\n      value.startsWith('BATTERY_COUNTER_') ||\n      value === 'DISCARD' ||\n      value === 'RING_BUFFER' ||\n      value.startsWith('PERF_CLOCK_')\n    );\n  }\n  // Since javascript doesn't have 64 bit numbers when converting protos to\n  // json the proto library encodes them as strings. This is lossy since\n  // we can't tell which strings that look like numbers are actually strings\n  // and which are actually numbers. Ideally we would reflect on the proto\n  // definition somehow but for now we just hard code keys which have this\n  // problem in the config.\n  function is64BitNumber(key: string): boolean {\n    return [\n      'maxFileSizeBytes',\n      'samplingIntervalBytes',\n      'shmemSizeBytes',\n      'pid',\n      'frequency',\n    ].includes(key);\n  }\n  function* message(msg: {}, indent: number): IterableIterator<string> {\n    for (const [key, value] of Object.entries(msg)) {\n      const isRepeated = Array.isArray(value);\n      const isNested = typeof value === 'object' && !isRepeated;\n      for (const entry of isRepeated ? (value as Array<{}>) : [value]) {\n        yield ' '.repeat(indent) + `${snakeCase(key)}${isNested ? '' : ':'} `;\n        if (isString(entry)) {\n          if (isEnum(entry) || is64BitNumber(key)) {\n            yield entry;\n          } else {\n            yield `\"${entry.replace(new RegExp('\"', 'g'), '\\\\\"')}\"`;\n          }\n        } else if (typeof entry === 'number') {\n          yield entry.toString();\n        } else if (typeof entry === 'boolean') {\n          yield entry.toString();\n        } else if (typeof entry === 'object' && entry !== null) {\n          yield '{\\n';\n          yield* message(entry, indent + 4);\n          yield ' '.repeat(indent) + '}';\n        } else {\n          throw new Error(\n            `Record proto entry \"${entry}\" with unexpected type ${typeof entry}`,\n          );\n        }\n        yield '\\n';\n      }\n    }\n  }\n  return [...message(json, 0)].join('');\n}\n"]}
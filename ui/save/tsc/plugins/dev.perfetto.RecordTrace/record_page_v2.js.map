{"version":3,"file":"record_page_v2.js","sourceRoot":"","sources":["../../../../src/plugins/dev.perfetto.RecordTrace/record_page_v2.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2022 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {Attributes} from 'mithril';\nimport {assertExists} from '../../base/logging';\nimport {RecordingConfigUtils} from './recordingV2/recording_config_utils';\nimport {\n  ChromeTargetInfo,\n  RecordingTargetV2,\n  TargetInfo,\n} from './recordingV2/recording_interfaces_v2';\nimport {\n  RecordingPageController,\n  RecordingState,\n} from './recordingV2/recording_page_controller';\nimport {EXTENSION_NAME, EXTENSION_URL} from './recordingV2/recording_utils';\nimport {targetFactoryRegistry} from './recordingV2/target_factory_registry';\nimport {PageAttrs} from '../../public/page';\nimport {recordConfigStore} from './record_config';\nimport {\n  Configurations,\n  loadRecordConfig,\n  maybeGetActiveCss,\n  RECORDING_SECTIONS,\n  uploadRecordingConfig,\n} from './record_page';\nimport {CodeSnippet} from './record_widgets';\nimport {AdvancedSettings} from './advanced_settings';\nimport {AndroidSettings} from './android_settings';\nimport {ChromeSettings} from './chrome_settings';\nimport {CpuSettings} from './cpu_settings';\nimport {EtwSettings} from './etw_settings';\nimport {GpuSettings} from './gpu_settings';\nimport {LinuxPerfSettings} from './linux_perf_settings';\nimport {MemorySettings} from './memory_settings';\nimport {PowerSettings} from './power_settings';\nimport {RecordingSettings} from './recording_settings';\nimport {FORCE_RESET_MESSAGE} from './recording_ui_utils';\nimport {showAddNewTargetModal} from './reset_target_modal';\nimport {RecordingManager} from './recording_manager';\nimport {RecordConfig} from './record_config_types';\nimport {App} from '../../public/app';\nimport {scheduleFullRedraw} from '../../widgets/raf';\n\nconst START_RECORDING_MESSAGE = 'Start Recording';\n\n// TODO(primiano): this is needs to be rewritten, but then i'm going to rewrite\n// the whole record_page_v2 so not worth cleaning up now.\nlet controller: RecordingPageController;\nlet recordConfigUtils: RecordingConfigUtils;\n\n// Options for displaying a target selection menu.\nexport interface TargetSelectionOptions {\n  // css attributes passed to the mithril components which displays the target\n  // selection menu.\n  attributes: Attributes;\n  // Whether the selection should be preceded by a text label.\n  shouldDisplayLabel: boolean;\n}\n\nfunction isChromeTargetInfo(\n  targetInfo: TargetInfo,\n): targetInfo is ChromeTargetInfo {\n  return ['CHROME', 'CHROME_OS', 'WINDOWS'].includes(targetInfo.targetType);\n}\n\nfunction RecordHeader(recMgr: RecordingManager) {\n  const platformSelection = RecordingPlatformSelection();\n  const statusLabel = RecordingStatusLabel(recMgr);\n  const buttons = RecordingButton(recMgr.state.recordConfig);\n  const notes = RecordingNotes(recMgr.state.recordConfig);\n  if (!platformSelection && !statusLabel && !buttons && !notes) {\n    // The header should not be displayed when it has no content.\n    return undefined;\n  }\n  return m(\n    '.record-header',\n    m(\n      '.top-part',\n      m('.target-and-status', platformSelection, statusLabel),\n      buttons,\n    ),\n    notes,\n  );\n}\n\nfunction RecordingPlatformSelection() {\n  // Don't show the platform selector while we are recording a trace.\n  if (controller.getState() >= RecordingState.RECORDING) return undefined;\n\n  return m(\n    '.target',\n    m(\n      '.chip',\n      {onclick: () => showAddNewTargetModal(controller)},\n      m('button', 'Add new recording target'),\n      m('i.material-icons', 'add'),\n    ),\n    targetSelection(),\n  );\n}\n\nexport function targetSelection(): m.Vnode | undefined {\n  if (!controller.shouldShowTargetSelection()) {\n    return undefined;\n  }\n\n  const targets: RecordingTargetV2[] = targetFactoryRegistry.listTargets();\n  const targetNames = [];\n  const targetInfo = controller.getTargetInfo();\n  if (!targetInfo) {\n    targetNames.push(m('option', 'PLEASE_SELECT_TARGET'));\n  }\n\n  let selectedIndex = 0;\n  for (let i = 0; i < targets.length; i++) {\n    const targetName = targets[i].getInfo().name;\n    targetNames.push(m('option', targetName));\n    if (targetInfo && targetName === targetInfo.name) {\n      selectedIndex = i;\n    }\n  }\n\n  return m(\n    'label',\n    'Target platform:',\n    m(\n      'select',\n      {\n        selectedIndex,\n        onchange: (e: Event) => {\n          controller.onTargetSelection((e.target as HTMLSelectElement).value);\n        },\n        onupdate: (select) => {\n          // Work around mithril bug\n          // (https://github.com/MithrilJS/mithril.js/issues/2107): We may\n          // update the select's options while also changing the\n          // selectedIndex at the same time. The update of selectedIndex\n          // may be applied before the new options are added to the select\n          // element. Because the new selectedIndex may be outside of the\n          // select's options at that time, we have to reselect the\n          // correct index here after any new children were added.\n          (select.dom as HTMLSelectElement).selectedIndex = selectedIndex;\n        },\n      },\n      ...targetNames,\n    ),\n  );\n}\n\n// This will display status messages which are informative, but do not require\n// user action, such as: \"Recording in progress for X seconds\" in the recording\n// page header.\nfunction RecordingStatusLabel(recMgr: RecordingManager) {\n  const recordingStatus = recMgr.state.recordingStatus;\n  if (!recordingStatus) return undefined;\n  return m('label', recordingStatus);\n}\n\nfunction Instructions(recCfg: RecordConfig, cssClass: string) {\n  if (controller.getState() < RecordingState.TARGET_SELECTED) {\n    return undefined;\n  }\n  // We will have a valid target at this step because we checked the state.\n  const targetInfo = assertExists(controller.getTargetInfo());\n\n  return m(\n    `.record-section.instructions${cssClass}`,\n    m('header', 'Recording command'),\n    m(\n      'button.permalinkconfig',\n      {\n        onclick: () => uploadRecordingConfig(recCfg),\n      },\n      'Share recording settings',\n    ),\n    RecordingSnippet(recCfg, targetInfo),\n    BufferUsageProgressBar(),\n    m('.buttons', StopCancelButtons()),\n  );\n}\n\nfunction BufferUsageProgressBar() {\n  // Show the Buffer Usage bar only after we start recording a trace.\n  if (controller.getState() !== RecordingState.RECORDING) {\n    return undefined;\n  }\n\n  controller.fetchBufferUsage();\n\n  const bufferUsage = controller.getBufferUsagePercentage();\n  // Buffer usage is not available yet on Android.\n  if (bufferUsage === 0) return undefined;\n\n  return m(\n    'label',\n    'Buffer usage: ',\n    m('progress', {max: 100, value: bufferUsage * 100}),\n  );\n}\n\nfunction RecordingNotes(recCfg: RecordConfig) {\n  if (controller.getState() !== RecordingState.TARGET_INFO_DISPLAYED) {\n    return undefined;\n  }\n  // We will have a valid target at this step because we checked the state.\n  const targetInfo = assertExists(controller.getTargetInfo());\n\n  const linuxUrl = 'https://perfetto.dev/docs/quickstart/linux-tracing';\n  const cmdlineUrl =\n    'https://perfetto.dev/docs/quickstart/android-tracing#perfetto-cmdline';\n\n  const notes: m.Children = [];\n\n  const msgFeatNotSupported = m(\n    'span',\n    `Some probes are only supported in Perfetto versions running\n      on Android Q+. Therefore, Perfetto will sideload the latest version onto\n      the device.`,\n  );\n\n  const msgPerfettoNotSupported = m(\n    'span',\n    `Perfetto is not supported natively before Android P. Therefore, Perfetto\n       will sideload the latest version onto the device.`,\n  );\n\n  const msgLinux = m(\n    '.note',\n    `Use this `,\n    m('a', {href: linuxUrl, target: '_blank'}, `quickstart guide`),\n    ` to get started with tracing on Linux.`,\n  );\n\n  const msgLongTraces = m(\n    '.note',\n    `Recording in long trace mode through the UI is not supported. Please copy\n    the command and `,\n    m(\n      'a',\n      {href: cmdlineUrl, target: '_blank'},\n      `collect the trace using ADB.`,\n    ),\n  );\n\n  if (\n    !recordConfigUtils.fetchLatestRecordCommand(recCfg, targetInfo)\n      .hasDataSources\n  ) {\n    notes.push(\n      m(\n        '.note',\n        \"It looks like you didn't add any probes. \" +\n          'Please add at least one to get a non-empty trace.',\n      ),\n    );\n  }\n\n  targetFactoryRegistry.listRecordingProblems().map((recordingProblem) => {\n    if (recordingProblem.includes(EXTENSION_URL)) {\n      // Special case for rendering the link to the Chrome extension.\n      const parts = recordingProblem.split(EXTENSION_URL);\n      notes.push(\n        m(\n          '.note',\n          parts[0],\n          m('a', {href: EXTENSION_URL, target: '_blank'}, EXTENSION_NAME),\n          parts[1],\n        ),\n      );\n    }\n  });\n\n  switch (targetInfo.targetType) {\n    case 'LINUX':\n      notes.push(msgLinux);\n      break;\n    case 'ANDROID': {\n      const androidApiLevel = targetInfo.androidApiLevel;\n      if (androidApiLevel === 28) {\n        notes.push(m('.note', msgFeatNotSupported));\n        /* eslint-disable @typescript-eslint/strict-boolean-expressions */\n      } else if (androidApiLevel && androidApiLevel <= 27) {\n        /* eslint-enable */\n        notes.push(m('.note', msgPerfettoNotSupported));\n      }\n      break;\n    }\n    default:\n  }\n\n  if (recCfg.mode === 'LONG_TRACE') {\n    notes.unshift(msgLongTraces);\n  }\n\n  return notes.length > 0 ? m('div', notes) : undefined;\n}\n\nfunction RecordingSnippet(recCfg: RecordConfig, targetInfo: TargetInfo) {\n  // We don't need commands to start tracing on chrome\n  if (isChromeTargetInfo(targetInfo)) {\n    if (controller.getState() > RecordingState.AUTH_P2) {\n      // If the UI has started tracing, don't display a message guiding the user\n      // to start recording.\n      return undefined;\n    }\n    return m(\n      'div',\n      m(\n        'label',\n        `To trace Chrome from the Perfetto UI you just have to press\n         '${START_RECORDING_MESSAGE}'.`,\n      ),\n    );\n  }\n  return m(CodeSnippet, {text: getRecordCommand(recCfg, targetInfo)});\n}\n\nfunction getRecordCommand(\n  recCfg: RecordConfig,\n  targetInfo: TargetInfo,\n): string {\n  const recordCommand = recordConfigUtils.fetchLatestRecordCommand(\n    recCfg,\n    targetInfo,\n  );\n\n  const pbBase64 = recordCommand?.configProtoBase64 ?? '';\n  const pbtx = recordCommand?.configProtoText ?? '';\n  let cmd = '';\n  if (\n    targetInfo.targetType === 'ANDROID' &&\n    targetInfo.androidApiLevel === 28\n  ) {\n    cmd += `echo '${pbBase64}' | \\n`;\n    cmd += 'base64 --decode | \\n';\n    cmd += 'adb shell \"perfetto -c - -o /data/misc/perfetto-traces/trace\"\\n';\n  } else {\n    cmd +=\n      targetInfo.targetType === 'ANDROID'\n        ? 'adb shell perfetto \\\\\\n'\n        : 'perfetto \\\\\\n';\n    cmd += '  -c - --txt \\\\\\n';\n    cmd += '  -o /data/misc/perfetto-traces/trace \\\\\\n';\n    cmd += '<<EOF\\n\\n';\n    cmd += pbtx;\n    cmd += '\\nEOF\\n';\n  }\n  return cmd;\n}\n\nfunction RecordingButton(recCfg: RecordConfig) {\n  if (\n    controller.getState() !== RecordingState.TARGET_INFO_DISPLAYED ||\n    !controller.canCreateTracingSession()\n  ) {\n    return undefined;\n  }\n\n  // We know we have a target because we checked the state.\n  const targetInfo = assertExists(controller.getTargetInfo());\n  const hasDataSources = recordConfigUtils.fetchLatestRecordCommand(\n    recCfg,\n    targetInfo,\n  ).hasDataSources;\n  if (!hasDataSources) {\n    return undefined;\n  }\n\n  return m(\n    '.button',\n    m(\n      'button',\n      {\n        class: 'selected',\n        onclick: () => controller.onStartRecordingPressed(),\n      },\n      START_RECORDING_MESSAGE,\n    ),\n  );\n}\n\nfunction StopCancelButtons() {\n  // Show the Stop/Cancel buttons only while we are recording a trace.\n  if (!controller.shouldShowStopCancelButtons()) {\n    return undefined;\n  }\n\n  const stop = m(\n    `button.selected`,\n    {onclick: () => controller.onStop()},\n    'Stop',\n  );\n\n  const cancel = m(`button`, {onclick: () => controller.onCancel()}, 'Cancel');\n\n  return [stop, cancel];\n}\n\nfunction recordMenu(routePage: string) {\n  const chromeProbe = m(\n    'a[href=\"#!/record/chrome\"]',\n    m(\n      `li${routePage === 'chrome' ? '.active' : ''}`,\n      m('i.material-icons', 'laptop_chromebook'),\n      m('.title', 'Chrome'),\n      m('.sub', 'Chrome traces'),\n    ),\n  );\n  const cpuProbe = m(\n    'a[href=\"#!/record/cpu\"]',\n    m(\n      `li${routePage === 'cpu' ? '.active' : ''}`,\n      m('i.material-icons', 'subtitles'),\n      m('.title', 'CPU'),\n      m('.sub', 'CPU usage, scheduling, wakeups'),\n    ),\n  );\n  const gpuProbe = m(\n    'a[href=\"#!/record/gpu\"]',\n    m(\n      `li${routePage === 'gpu' ? '.active' : ''}`,\n      m('i.material-icons', 'aspect_ratio'),\n      m('.title', 'GPU'),\n      m('.sub', 'GPU frequency, memory'),\n    ),\n  );\n  const powerProbe = m(\n    'a[href=\"#!/record/power\"]',\n    m(\n      `li${routePage === 'power' ? '.active' : ''}`,\n      m('i.material-icons', 'battery_charging_full'),\n      m('.title', 'Power'),\n      m('.sub', 'Battery and other energy counters'),\n    ),\n  );\n  const memoryProbe = m(\n    'a[href=\"#!/record/memory\"]',\n    m(\n      `li${routePage === 'memory' ? '.active' : ''}`,\n      m('i.material-icons', 'memory'),\n      m('.title', 'Memory'),\n      m('.sub', 'Physical mem, VM, LMK'),\n    ),\n  );\n  const androidProbe = m(\n    'a[href=\"#!/record/android\"]',\n    m(\n      `li${routePage === 'android' ? '.active' : ''}`,\n      m('i.material-icons', 'android'),\n      m('.title', 'Android apps & svcs'),\n      m('.sub', 'atrace and logcat'),\n    ),\n  );\n  const advancedProbe = m(\n    'a[href=\"#!/record/advanced\"]',\n    m(\n      `li${routePage === 'advanced' ? '.active' : ''}`,\n      m('i.material-icons', 'settings'),\n      m('.title', 'Advanced settings'),\n      m('.sub', 'Complicated stuff for wizards'),\n    ),\n  );\n  const tracePerfProbe = m(\n    'a[href=\"#!/record/tracePerf\"]',\n    m(\n      `li${routePage === 'tracePerf' ? '.active' : ''}`,\n      m('i.material-icons', 'full_stacked_bar_chart'),\n      m('.title', 'Stack Samples'),\n      m('.sub', 'Lightweight stack polling'),\n    ),\n  );\n  const etwProbe = m(\n    'a[href=\"#!/record/etw\"]',\n    m(\n      `li${routePage === 'etw' ? '.active' : ''}`,\n      m('i.material-icons', 'subtitles'),\n      m('.title', 'ETW Tracing Config'),\n      m('.sub', 'Context switch, Thread state'),\n    ),\n  );\n\n  // We only display the probes when we have a valid target, so it's not\n  // possible for the target to be undefined here.\n  const targetType = assertExists(controller.getTargetInfo()).targetType;\n  const probes = [];\n  if (targetType === 'LINUX') {\n    probes.push(cpuProbe, powerProbe, memoryProbe, chromeProbe, advancedProbe);\n  } else if (targetType === 'WINDOWS') {\n    probes.push(chromeProbe, etwProbe);\n  } else if (targetType === 'CHROME') {\n    probes.push(chromeProbe);\n  } else {\n    probes.push(\n      cpuProbe,\n      gpuProbe,\n      powerProbe,\n      memoryProbe,\n      androidProbe,\n      chromeProbe,\n      tracePerfProbe,\n      advancedProbe,\n    );\n  }\n\n  return m(\n    '.record-menu',\n    {\n      class:\n        controller.getState() > RecordingState.TARGET_INFO_DISPLAYED\n          ? 'disabled'\n          : '',\n      onclick: () => scheduleFullRedraw(),\n    },\n    m('header', 'Trace config'),\n    m(\n      'ul',\n      m(\n        'a[href=\"#!/record/buffers\"]',\n        m(\n          `li${routePage === 'buffers' ? '.active' : ''}`,\n          m('i.material-icons', 'tune'),\n          m('.title', 'Recording settings'),\n          m('.sub', 'Buffer mode, size and duration'),\n        ),\n      ),\n      m(\n        'a[href=\"#!/record/instructions\"]',\n        m(\n          `li${routePage === 'instructions' ? '.active' : ''}`,\n          m('i.material-icons-filled.rec', 'fiber_manual_record'),\n          m('.title', 'Recording command'),\n          m('.sub', 'Manually record trace'),\n        ),\n      ),\n      m(\n        'a[href=\"#!/record/config\"]',\n        {\n          onclick: () => {\n            recordConfigStore.reloadFromLocalStorage();\n          },\n        },\n        m(\n          `li${routePage === 'config' ? '.active' : ''}`,\n          m('i.material-icons', 'save'),\n          m('.title', 'Saved configs'),\n          m('.sub', 'Manage local configs'),\n        ),\n      ),\n    ),\n    m('header', 'Probes'),\n    m('ul', probes),\n  );\n}\n\nfunction getRecordContainer(recMgr: RecordingManager, subpage?: string) {\n  const recCfg = recMgr.state.recordConfig;\n  const components: m.Children[] = [RecordHeader(recMgr)];\n  if (controller.getState() === RecordingState.NO_TARGET) {\n    components.push(m('.full-centered', 'Please connect a valid target.'));\n    return m('.record-container', components);\n  } else if (controller.getState() <= RecordingState.ASK_TO_FORCE_P1) {\n    components.push(\n      m(\n        '.full-centered',\n        'Can not access the device without resetting the ' +\n          `connection. Please refresh the page, then click ` +\n          `'${FORCE_RESET_MESSAGE}.'`,\n      ),\n    );\n    return m('.record-container', components);\n  } else if (controller.getState() === RecordingState.AUTH_P1) {\n    components.push(\n      m('.full-centered', 'Please allow USB debugging on the device.'),\n    );\n    return m('.record-container', components);\n  } else if (\n    controller.getState() === RecordingState.WAITING_FOR_TRACE_DISPLAY\n  ) {\n    components.push(\n      m('.full-centered', 'Waiting for the trace to be collected.'),\n    );\n    return m('.record-container', components);\n  }\n\n  const pages: m.Children = [];\n  // we need to remove the `/` character from the route\n  let routePage = subpage ? subpage.substr(1) : '';\n  if (!RECORDING_SECTIONS.includes(routePage)) {\n    routePage = 'buffers';\n  }\n  pages.push(recordMenu(routePage));\n\n  pages.push(\n    m(RecordingSettings, {\n      dataSources: [],\n      cssClass: maybeGetActiveCss(routePage, 'buffers'),\n      recState: recMgr.state,\n    }),\n  );\n  pages.push(\n    Instructions(recCfg, maybeGetActiveCss(routePage, 'instructions')),\n  );\n  pages.push(Configurations(recMgr, maybeGetActiveCss(routePage, 'config')));\n\n  const settingsSections = new Map([\n    ['cpu', CpuSettings],\n    ['gpu', GpuSettings],\n    ['power', PowerSettings],\n    ['memory', MemorySettings],\n    ['android', AndroidSettings],\n    ['chrome', ChromeSettings],\n    ['tracePerf', LinuxPerfSettings],\n    ['advanced', AdvancedSettings],\n    ['etw', EtwSettings],\n  ]);\n  for (const [section, component] of settingsSections.entries()) {\n    pages.push(\n      m(component, {\n        dataSources: controller.getTargetInfo()?.dataSources || [],\n        cssClass: maybeGetActiveCss(routePage, section),\n        recState: recMgr.state,\n      }),\n    );\n  }\n\n  components.push(m('.record-container-content', pages));\n  return m('.record-container', components);\n}\n\nexport interface RecordPageV2Attrs extends PageAttrs {\n  app: App;\n  recCtl: RecordingPageController;\n  recMgr: RecordingManager;\n}\n\nexport class RecordPageV2 implements m.ClassComponent<RecordPageV2Attrs> {\n  private lastSubpage: string | undefined = undefined;\n\n  constructor({attrs}: m.CVnode<RecordPageV2Attrs>) {\n    controller ??= attrs.recCtl;\n    recordConfigUtils ??= new RecordingConfigUtils();\n  }\n\n  oninit({attrs}: m.CVnode<RecordPageV2Attrs>) {\n    this.lastSubpage = attrs.subpage;\n    if (attrs.subpage !== undefined && attrs.subpage.startsWith('/share/')) {\n      const hash = attrs.subpage.substring(7);\n      loadRecordConfig(attrs.recMgr, hash);\n      attrs.app.navigate('#!/record/instructions');\n    }\n  }\n\n  view({attrs}: m.CVnode<RecordPageV2Attrs>) {\n    if (attrs.subpage !== this.lastSubpage) {\n      this.lastSubpage = attrs.subpage;\n      // TODO(primiano): this is a hack necesasry to retrigger the generation of\n      // the record cmdline. Refactor this code once record v1 vs v2 is gone.\n      attrs.recMgr.setRecordConfig(attrs.recMgr.state.recordConfig);\n    }\n\n    return m(\n      '.record-page',\n      controller.getState() > RecordingState.TARGET_INFO_DISPLAYED\n        ? m('.hider')\n        : [],\n      getRecordContainer(attrs.recMgr, attrs.subpage),\n    );\n  }\n}\n"]}
{"version":3,"file":"reset_target_modal.js","sourceRoot":"","sources":["../../../../src/plugins/dev.perfetto.RecordTrace/reset_target_modal.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2022 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {RecordingPageController} from './recordingV2/recording_page_controller';\nimport {\n  EXTENSION_URL,\n  RECORDING_MODAL_DIALOG_KEY,\n} from './recordingV2/recording_utils';\nimport {\n  CHROME_TARGET_FACTORY,\n  ChromeTargetFactory,\n} from './recordingV2/target_factories/chrome_target_factory';\nimport {targetFactoryRegistry} from './recordingV2/target_factory_registry';\nimport {WebsocketMenuController} from './recordingV2/websocket_menu_controller';\nimport {closeModal, showModal} from '../../widgets/modal';\nimport {CodeSnippet} from './record_widgets';\nimport {RecordingMultipleChoice} from './recording_multiple_choice';\n\nconst RUN_WEBSOCKET_CMD =\n  '# Get tracebox\\n' +\n  'curl -LO https://get.perfetto.dev/tracebox\\n' +\n  'chmod +x ./tracebox\\n' +\n  '# Option A - trace android devices\\n' +\n  'adb start-server\\n' +\n  '# Option B - trace the host OS\\n' +\n  './tracebox traced --background\\n' +\n  './tracebox traced_probes --background\\n' +\n  '# Start the websocket server\\n' +\n  './tracebox websocket_bridge\\n';\n\nexport function showAddNewTargetModal(controller: RecordingPageController) {\n  showModal({\n    title: 'Add new recording target',\n    key: RECORDING_MODAL_DIALOG_KEY,\n    content: () =>\n      m(\n        '.record-modal',\n        m('text', 'Select platform:'),\n        assembleWebusbSection(controller),\n        m('.line'),\n        assembleWebsocketSection(controller),\n        m('.line'),\n        assembleChromeSection(controller),\n      ),\n  });\n}\n\nfunction assembleWebusbSection(\n  recordingPageController: RecordingPageController,\n): m.Vnode {\n  return m(\n    '.record-modal-section',\n    m('.logo-wrapping', m('i.material-icons', 'usb')),\n    m(\n      '.record-modal-description',\n      m('h3', 'Android device over WebUSB'),\n      m(\n        'text',\n        'Android developers: this option cannot co-operate ' +\n          'with the adb host on your machine. Only one entity between ' +\n          'the browser and adb can control the USB endpoint. If adb is ' +\n          'running, you will be prompted to re-assign the device to the ' +\n          'browser. Use the websocket option below to use both ' +\n          'simultaneously.',\n      ),\n      m(\n        '.record-modal-button',\n        {\n          onclick: () => {\n            closeModal(RECORDING_MODAL_DIALOG_KEY);\n            recordingPageController.addAndroidDevice();\n          },\n        },\n        'Connect new WebUSB driver',\n      ),\n    ),\n  );\n}\n\nfunction assembleWebsocketSection(\n  recordingPageController: RecordingPageController,\n): m.Vnode {\n  const websocketComponents = [];\n  websocketComponents.push(\n    m('h3', 'Android / Linux / MacOS device via Websocket'),\n  );\n  websocketComponents.push(\n    m(\n      'text',\n      'This option assumes that the adb server is already ' +\n        'running on your machine.',\n    ),\n    m(\n      '.record-modal-command',\n      m(CodeSnippet, {\n        text: RUN_WEBSOCKET_CMD,\n      }),\n    ),\n  );\n\n  websocketComponents.push(\n    m(\n      '.record-modal-command',\n      m('text', 'Websocket bridge address: '),\n      m('input[type=text]', {\n        value: websocketMenuController.getPath(),\n        oninput() {\n          websocketMenuController.setPath(this.value);\n        },\n      }),\n      m(\n        '.record-modal-logo-button',\n        {\n          onclick: () => websocketMenuController.onPathChange(),\n        },\n        m('i.material-icons', 'refresh'),\n      ),\n    ),\n  );\n\n  websocketComponents.push(\n    m(RecordingMultipleChoice, {\n      controller: recordingPageController,\n      targetFactories: websocketMenuController.getTargetFactories(),\n    }),\n  );\n\n  return m(\n    '.record-modal-section',\n    m('.logo-wrapping', m('i.material-icons', 'settings_ethernet')),\n    m('.record-modal-description', ...websocketComponents),\n  );\n}\n\nfunction assembleChromeSection(\n  recordingPageController: RecordingPageController,\n): m.Vnode | undefined {\n  if (!targetFactoryRegistry.has(CHROME_TARGET_FACTORY)) {\n    return undefined;\n  }\n\n  const chromeComponents = [];\n  chromeComponents.push(m('h3', 'Chrome Browser instance or ChromeOS device'));\n\n  const chromeFactory: ChromeTargetFactory = targetFactoryRegistry.get(\n    CHROME_TARGET_FACTORY,\n  ) as ChromeTargetFactory;\n\n  if (!chromeFactory.isExtensionInstalled) {\n    chromeComponents.push(\n      m(\n        'text',\n        'Install the extension ',\n        m('a', {href: EXTENSION_URL, target: '_blank'}, 'from this link '),\n        'and refresh the page.',\n      ),\n    );\n  } else {\n    chromeComponents.push(\n      m(RecordingMultipleChoice, {\n        controller: recordingPageController,\n        targetFactories: [chromeFactory],\n      }),\n    );\n  }\n\n  return m(\n    '.record-modal-section',\n    m('.logo-wrapping', m('i.material-icons', 'web')),\n    m('.record-modal-description', ...chromeComponents),\n  );\n}\n\nconst websocketMenuController = new WebsocketMenuController();\n"]}
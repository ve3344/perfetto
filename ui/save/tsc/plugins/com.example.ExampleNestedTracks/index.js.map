{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/plugins/com.example.ExampleNestedTracks/index.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {Trace} from '../../public/trace';\nimport {PerfettoPlugin} from '../../public/plugin';\nimport {createQuerySliceTrack} from '../../components/tracks/query_slice_track';\nimport {TrackNode} from '../../public/workspace';\n\nexport default class implements PerfettoPlugin {\n  static readonly id = 'com.example.ExampleNestedTracks';\n  async onTraceLoad(ctx: Trace): Promise<void> {\n    const traceStartTime = ctx.traceInfo.start;\n    const traceDur = ctx.traceInfo.end - ctx.traceInfo.start;\n    await ctx.engine.query(`\n      create table example_events (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT,\n        ts INTEGER,\n        dur INTEGER,\n        arg INTEGER\n      );\n\n      insert into example_events (name, ts, dur, arg)\n      values\n        ('Foo', ${traceStartTime}, ${traceDur}, 'aaa'),\n        ('Bar', ${traceStartTime}, ${traceDur / 2n}, 'bbb'),\n        ('Baz', ${traceStartTime}, ${traceDur / 3n}, 'bbb');\n    `);\n\n    const title = 'Test Track';\n    const uri = `com.example.ExampleNestedTracks#TestTrack`;\n    const track = await createQuerySliceTrack({\n      trace: ctx,\n      uri,\n      data: {\n        sqlSource: 'select * from example_events',\n      },\n    });\n    ctx.tracks.registerTrack({\n      uri,\n      title,\n      track,\n    });\n\n    this.addNestedTracks(ctx, uri);\n  }\n\n  private addNestedTracks(ctx: Trace, uri: string): void {\n    const trackRoot = new TrackNode({uri, title: 'Root'});\n    const track1 = new TrackNode({uri, title: '1'});\n    const track2 = new TrackNode({uri, title: '2'});\n    const track11 = new TrackNode({uri, title: '1.1'});\n    const track12 = new TrackNode({uri, title: '1.2'});\n    const track121 = new TrackNode({uri, title: '1.2.1'});\n    const track21 = new TrackNode({uri, title: '2.1'});\n\n    ctx.workspace.addChildInOrder(trackRoot);\n    trackRoot.addChildLast(track1);\n    trackRoot.addChildLast(track2);\n    track1.addChildLast(track11);\n    track1.addChildLast(track12);\n    track12.addChildLast(track121);\n    track2.addChildLast(track21);\n\n    ctx.commands.registerCommand({\n      id: 'com.example.ExampleNestedTracks#CloneTracksToNewWorkspace',\n      name: 'Clone track to new workspace',\n      callback: () => {\n        const ws = ctx.workspaces.createEmptyWorkspace('New workspace');\n        ws.addChildLast(trackRoot.clone());\n        ctx.workspaces.switchWorkspace(ws);\n      },\n    });\n\n    ctx.commands.registerCommand({\n      id: 'com.example.ExampleNestedTracks#DeepCloneTracksToNewWorkspace',\n      name: 'Clone all tracks to new workspace',\n      callback: () => {\n        const ws = ctx.workspaces.createEmptyWorkspace('Deep workspace');\n        ws.addChildLast(trackRoot.clone(true));\n        ctx.workspaces.switchWorkspace(ws);\n      },\n    });\n  }\n}\n"]}
{"version":3,"file":"sidebar.js","sourceRoot":"","sources":["../../../src/frontend/sidebar.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2018 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {getCurrentChannel} from '../core/channels';\nimport {TRACE_SUFFIX} from '../public/trace';\nimport {\n  disableMetatracingAndGetTrace,\n  enableMetatracing,\n  isMetatracingEnabled,\n} from '../core/metatracing';\nimport {Engine, EngineMode} from '../trace_processor/engine';\nimport {featureFlags} from '../core/feature_flags';\nimport {raf} from '../core/raf_scheduler';\nimport {SCM_REVISION, VERSION} from '../gen/perfetto_version';\nimport {showModal} from '../widgets/modal';\nimport {Animation} from './animation';\nimport {downloadData, downloadUrl} from '../base/download_utils';\nimport {globals} from './globals';\nimport {toggleHelp} from './help_modal';\nimport {shareTrace} from './trace_share_utils';\nimport {\n  convertTraceToJsonAndDownload,\n  convertTraceToSystraceAndDownload,\n} from './trace_converter';\nimport {openInOldUIWithSizeCheck} from './legacy_trace_viewer';\nimport {SIDEBAR_SECTIONS, SidebarSections} from '../public/sidebar';\nimport {AppImpl} from '../core/app_impl';\nimport {Trace} from '../public/trace';\nimport {OptionalTraceImplAttrs, TraceImpl} from '../core/trace_impl';\nimport {Command} from '../public/command';\nimport {SidebarMenuItemInternal} from '../core/sidebar_manager';\nimport {exists, getOrCreate} from '../base/utils';\nimport {copyToClipboard} from '../base/clipboard';\nimport {classNames} from '../base/classnames';\nimport {formatHotkey} from '../base/hotkeys';\nimport {assetSrc} from '../base/assets';\n\nconst GITILES_URL =\n  'https://android.googlesource.com/platform/external/perfetto';\n\nfunction getBugReportUrl(): string {\n  if (globals.isInternalUser) {\n    return 'https://goto.google.com/perfetto-ui-bug';\n  } else {\n    return 'https://github.com/google/perfetto/issues/new';\n  }\n}\n\nconst HIRING_BANNER_FLAG = featureFlags.register({\n  id: 'showHiringBanner',\n  name: 'Show hiring banner',\n  description: 'Show the \"We\\'re hiring\" banner link in the side bar.',\n  defaultValue: false,\n});\n\nfunction shouldShowHiringBanner(): boolean {\n  return globals.isInternalUser && HIRING_BANNER_FLAG.get();\n}\n\nasync function openCurrentTraceWithOldUI(trace: Trace): Promise<void> {\n  AppImpl.instance.analytics.logEvent(\n    'Trace Actions',\n    'Open current trace in legacy UI',\n  );\n  const file = await trace.getTraceFile();\n  await openInOldUIWithSizeCheck(file);\n}\n\nasync function convertTraceToSystrace(trace: Trace): Promise<void> {\n  AppImpl.instance.analytics.logEvent('Trace Actions', 'Convert to .systrace');\n  const file = await trace.getTraceFile();\n  await convertTraceToSystraceAndDownload(file);\n}\n\nasync function convertTraceToJson(trace: Trace): Promise<void> {\n  AppImpl.instance.analytics.logEvent('Trace Actions', 'Convert to .json');\n  const file = await trace.getTraceFile();\n  await convertTraceToJsonAndDownload(file);\n}\n\nfunction downloadTrace(trace: TraceImpl) {\n  if (!trace.traceInfo.downloadable) return;\n  AppImpl.instance.analytics.logEvent('Trace Actions', 'Download trace');\n\n  let url = '';\n  let fileName = `trace${TRACE_SUFFIX}`;\n  const src = trace.traceInfo.source;\n  if (src.type === 'URL') {\n    url = src.url;\n    fileName = url.split('/').slice(-1)[0];\n  } else if (src.type === 'ARRAY_BUFFER') {\n    const blob = new Blob([src.buffer], {type: 'application/octet-stream'});\n    const inputFileName = window.prompt(\n      'Please enter a name for your file or leave blank',\n    );\n    if (inputFileName) {\n      fileName = `${inputFileName}.perfetto_trace.gz`;\n    } else if (src.fileName) {\n      fileName = src.fileName;\n    }\n    url = URL.createObjectURL(blob);\n  } else if (src.type === 'FILE') {\n    const file = src.file;\n    url = URL.createObjectURL(file);\n    fileName = file.name;\n  } else {\n    throw new Error(`Download from ${JSON.stringify(src)} is not supported`);\n  }\n  downloadUrl(fileName, url);\n}\n\nfunction highPrecisionTimersAvailable(): boolean {\n  // High precision timers are available either when the page is cross-origin\n  // isolated or when the trace processor is a standalone binary.\n  return (\n    window.crossOriginIsolated ||\n    AppImpl.instance.trace?.engine.mode === 'HTTP_RPC'\n  );\n}\n\nfunction recordMetatrace(engine: Engine) {\n  AppImpl.instance.analytics.logEvent('Trace Actions', 'Record metatrace');\n\n  if (!highPrecisionTimersAvailable()) {\n    const PROMPT = `High-precision timers are not available to WASM trace processor yet.\n\nModern browsers restrict high-precision timers to cross-origin-isolated pages.\nAs Perfetto UI needs to open traces via postMessage, it can't be cross-origin\nisolated until browsers ship support for\n'Cross-origin-opener-policy: restrict-properties'.\n\nDo you still want to record a metatrace?\nNote that events under timer precision (1ms) will dropped.\nAlternatively, connect to a trace_processor_shell --httpd instance.\n`;\n    showModal({\n      title: `Trace processor doesn't have high-precision timers`,\n      content: m('.modal-pre', PROMPT),\n      buttons: [\n        {\n          text: 'YES, record metatrace',\n          primary: true,\n          action: () => {\n            enableMetatracing();\n            engine.enableMetatrace();\n          },\n        },\n        {\n          text: 'NO, cancel',\n        },\n      ],\n    });\n  } else {\n    engine.enableMetatrace();\n  }\n}\n\nasync function toggleMetatrace(e: Engine) {\n  return isMetatracingEnabled() ? finaliseMetatrace(e) : recordMetatrace(e);\n}\n\nasync function finaliseMetatrace(engine: Engine) {\n  AppImpl.instance.analytics.logEvent('Trace Actions', 'Finalise metatrace');\n\n  const jsEvents = disableMetatracingAndGetTrace();\n\n  const result = await engine.stopAndGetMetatrace();\n  if (result.error.length !== 0) {\n    throw new Error(`Failed to read metatrace: ${result.error}`);\n  }\n\n  downloadData('metatrace', result.metatrace, jsEvents);\n}\n\nclass EngineRPCWidget implements m.ClassComponent<OptionalTraceImplAttrs> {\n  view({attrs}: m.CVnode<OptionalTraceImplAttrs>) {\n    let cssClass = '';\n    let title = 'Number of pending SQL queries';\n    let label: string;\n    let failed = false;\n    let mode: EngineMode | undefined;\n\n    const engine = attrs.trace?.engine;\n    if (engine !== undefined) {\n      mode = engine.mode;\n      if (engine.failed !== undefined) {\n        cssClass += '.red';\n        title = 'Query engine crashed\\n' + engine.failed;\n        failed = true;\n      }\n    }\n\n    // If we don't have an engine yet, guess what will be the mode that will\n    // be used next time we'll create one. Even if we guess it wrong (somehow\n    // trace_controller.ts takes a different decision later, e.g. because the\n    // RPC server is shut down after we load the UI and cached httpRpcState)\n    // this will eventually become  consistent once the engine is created.\n    if (mode === undefined) {\n      if (\n        AppImpl.instance.httpRpc.httpRpcAvailable &&\n        AppImpl.instance.httpRpc.newEngineMode === 'USE_HTTP_RPC_IF_AVAILABLE'\n      ) {\n        mode = 'HTTP_RPC';\n      } else {\n        mode = 'WASM';\n      }\n    }\n\n    if (mode === 'HTTP_RPC') {\n      cssClass += '.green';\n      label = 'RPC';\n      title += '\\n(Query engine: native accelerator over HTTP+RPC)';\n    } else {\n      label = 'WSM';\n      title += '\\n(Query engine: built-in WASM)';\n    }\n\n    const numReqs = attrs.trace?.engine.numRequestsPending ?? 0;\n    return m(\n      `.dbg-info-square${cssClass}`,\n      {title},\n      m('div', label),\n      m('div', `${failed ? 'FAIL' : numReqs}`),\n    );\n  }\n}\n\nconst ServiceWorkerWidget: m.Component = {\n  view() {\n    let cssClass = '';\n    let title = 'Service Worker: ';\n    let label = 'N/A';\n    const ctl = AppImpl.instance.serviceWorkerController;\n    if (!('serviceWorker' in navigator)) {\n      label = 'N/A';\n      title += 'not supported by the browser (requires HTTPS)';\n    } else if (ctl.bypassed) {\n      label = 'OFF';\n      cssClass = '.red';\n      title += 'Bypassed, using live network. Double-click to re-enable';\n    } else if (ctl.installing) {\n      label = 'UPD';\n      cssClass = '.amber';\n      title += 'Installing / updating ...';\n    } else if (!navigator.serviceWorker.controller) {\n      label = 'N/A';\n      title += 'Not available, using network';\n    } else {\n      label = 'ON';\n      cssClass = '.green';\n      title += 'Serving from cache. Ready for offline use';\n    }\n\n    const toggle = async () => {\n      if (ctl.bypassed) {\n        ctl.setBypass(false);\n        return;\n      }\n      showModal({\n        title: 'Disable service worker?',\n        content: m(\n          'div',\n          m(\n            'p',\n            `If you continue the service worker will be disabled until\n                      manually re-enabled.`,\n          ),\n          m(\n            'p',\n            `All future requests will be served from the network and the\n                    UI won't be available offline.`,\n          ),\n          m(\n            'p',\n            `You should do this only if you are debugging the UI\n                    or if you are experiencing caching-related problems.`,\n          ),\n          m(\n            'p',\n            `Disabling will cause a refresh of the UI, the current state\n                    will be lost.`,\n          ),\n        ),\n        buttons: [\n          {\n            text: 'Disable and reload',\n            primary: true,\n            action: () => ctl.setBypass(true).then(() => location.reload()),\n          },\n          {text: 'Cancel'},\n        ],\n      });\n    };\n\n    return m(\n      `.dbg-info-square${cssClass}`,\n      {title, ondblclick: toggle},\n      m('div', 'SW'),\n      m('div', label),\n    );\n  },\n};\n\nclass SidebarFooter implements m.ClassComponent<OptionalTraceImplAttrs> {\n  view({attrs}: m.CVnode<OptionalTraceImplAttrs>) {\n    return m(\n      '.sidebar-footer',\n      m(EngineRPCWidget, attrs),\n      m(ServiceWorkerWidget),\n      m(\n        '.version',\n        m(\n          'a',\n          {\n            href: `${GITILES_URL}/+/${SCM_REVISION}/ui`,\n            title: `Channel: ${getCurrentChannel()}`,\n            target: '_blank',\n          },\n          VERSION,\n        ),\n      ),\n    );\n  }\n}\n\nclass HiringBanner implements m.ClassComponent {\n  view() {\n    return m(\n      '.hiring-banner',\n      m(\n        'a',\n        {\n          href: 'http://go/perfetto-open-roles',\n          target: '_blank',\n        },\n        \"We're hiring!\",\n      ),\n    );\n  }\n}\n\nexport class Sidebar implements m.ClassComponent<OptionalTraceImplAttrs> {\n  private _redrawWhileAnimating = new Animation(() =>\n    raf.scheduleFullRedraw('force'),\n  );\n  private _asyncJobPending = new Set<string>();\n  private _sectionExpanded = new Map<string, boolean>();\n\n  constructor() {\n    registerMenuItems();\n  }\n\n  view({attrs}: m.CVnode<OptionalTraceImplAttrs>) {\n    const sidebar = AppImpl.instance.sidebar;\n    if (!sidebar.enabled) return null;\n    return m(\n      'nav.sidebar',\n      {\n        class: sidebar.visible ? 'show-sidebar' : 'hide-sidebar',\n        // 150 here matches --sidebar-timing in the css.\n        // TODO(hjd): Should link to the CSS variable.\n        ontransitionstart: (e: TransitionEvent) => {\n          if (e.target !== e.currentTarget) return;\n          this._redrawWhileAnimating.start(150);\n        },\n        ontransitionend: (e: TransitionEvent) => {\n          if (e.target !== e.currentTarget) return;\n          this._redrawWhileAnimating.stop();\n        },\n      },\n      shouldShowHiringBanner() ? m(HiringBanner) : null,\n      m(\n        `header.${getCurrentChannel()}`,\n        m(`img[src=${assetSrc('assets/brand.png')}].brand`),\n        m(\n          'button.sidebar-button',\n          {\n            onclick: () => sidebar.toggleVisibility(),\n          },\n          m(\n            'i.material-icons',\n            {\n              title: sidebar.visible ? 'Hide menu' : 'Show menu',\n            },\n            'menu',\n          ),\n        ),\n      ),\n      m(\n        '.sidebar-scroll',\n        m(\n          '.sidebar-scroll-container',\n          ...(Object.keys(SIDEBAR_SECTIONS) as SidebarSections[]).map((s) =>\n            this.renderSection(s),\n          ),\n          m(SidebarFooter, attrs),\n        ),\n      ),\n    );\n  }\n\n  private renderSection(sectionId: SidebarSections) {\n    const section = SIDEBAR_SECTIONS[sectionId];\n    const menuItems = AppImpl.instance.sidebar.menuItems\n      .valuesAsArray()\n      .filter((item) => item.section === sectionId)\n      .sort((a, b) => (a.sortOrder ?? 0) - (b.sortOrder ?? 0))\n      .map((item) => this.renderItem(item));\n\n    // Don't render empty sections.\n    if (menuItems.length === 0) return undefined;\n\n    const expanded = getOrCreate(this._sectionExpanded, sectionId, () => true);\n    return m(\n      `section${expanded ? '.expanded' : ''}`,\n      m(\n        '.section-header',\n        {\n          onclick: () => {\n            this._sectionExpanded.set(sectionId, !expanded);\n            raf.scheduleFullRedraw();\n          },\n        },\n        m('h1', {title: section.title}, section.title),\n        m('h2', section.summary),\n      ),\n      m('.section-content', m('ul', menuItems)),\n    );\n  }\n\n  private renderItem(item: SidebarMenuItemInternal): m.Child {\n    let href = '#';\n    let disabled = false;\n    let target = null;\n    let command: Command | undefined = undefined;\n    let tooltip = valueOrCallback(item.tooltip);\n    let onclick: (() => unknown | Promise<unknown>) | undefined = undefined;\n    const commandId = 'commandId' in item ? item.commandId : undefined;\n    const action = 'action' in item ? item.action : undefined;\n    let text = valueOrCallback(item.text);\n    const disabReason: boolean | string | undefined = valueOrCallback(\n      item.disabled,\n    );\n\n    if (disabReason === true || typeof disabReason === 'string') {\n      disabled = true;\n      onclick = () => typeof disabReason === 'string' && alert(disabReason);\n    } else if (action !== undefined) {\n      onclick = action;\n    } else if (commandId !== undefined) {\n      const cmdMgr = AppImpl.instance.commands;\n      command = cmdMgr.hasCommand(commandId ?? '')\n        ? cmdMgr.getCommand(commandId)\n        : undefined;\n      if (command === undefined) {\n        disabled = true;\n      } else {\n        text = text !== undefined ? text : command.name;\n        if (command.defaultHotkey !== undefined) {\n          tooltip =\n            `${tooltip ?? command.name}` +\n            ` [${formatHotkey(command.defaultHotkey)}]`;\n        }\n        onclick = () => cmdMgr.runCommand(commandId);\n      }\n    }\n\n    // This is not an else if because in some rare cases the user might want\n    // to have both an href and onclick, with different behaviors. The only case\n    // today is the trace name / URL, where we want the URL in the href to\n    // support right-click -> copy URL, but the onclick does copyToClipboard().\n    if ('href' in item && item.href !== undefined) {\n      href = item.href;\n      target = href.startsWith('#') ? null : '_blank';\n    }\n    return m(\n      'li',\n      m(\n        'a',\n        {\n          className: classNames(\n            valueOrCallback(item.cssClass),\n            this._asyncJobPending.has(item.id) && 'pending',\n          ),\n          onclick: onclick && this.wrapClickHandler(item.id, onclick),\n          href,\n          target,\n          disabled,\n          title: tooltip,\n        },\n        exists(item.icon) && m('i.material-icons', valueOrCallback(item.icon)),\n        text,\n      ),\n    );\n  }\n\n  // Creates the onClick handlers for the items which provided a function in the\n  // `action` member. The function can be either sync or async.\n  // What we want to achieve here is the following:\n  // - If the action is async (returns a Promise), we want to render a spinner,\n  //   next to the menu item, until the promise is resolved.\n  // - [Minor] we want to call e.preventDefault() to override the behaviour of\n  //   the <a href='#'> which gets rendered for accessibility reasons.\n  private wrapClickHandler(itemId: string, itemAction: Function) {\n    return (e: Event) => {\n      e.preventDefault(); // Make the <a href=\"#\"> a no-op.\n      const res = itemAction();\n      if (!(res instanceof Promise)) return;\n      if (this._asyncJobPending.has(itemId)) {\n        return; // Don't queue up another action if not yet finished.\n      }\n      this._asyncJobPending.add(itemId);\n      raf.scheduleFullRedraw();\n      res.finally(() => {\n        this._asyncJobPending.delete(itemId);\n        raf.scheduleFullRedraw('force');\n      });\n    };\n  }\n}\n\n// TODO(primiano): The registrations below should be moved to dedicated\n// plugins (most of this really belongs to core_plugins/commads/index.ts).\n// For now i'm keeping everything here as splitting these require moving some\n// functions like share_trace() out of core, splitting out permalink, etc.\n\nlet globalItemsRegistered = false;\nconst traceItemsRegistered = new WeakSet<TraceImpl>();\n\nfunction registerMenuItems() {\n  if (!globalItemsRegistered) {\n    globalItemsRegistered = true;\n    registerGlobalSidebarEntries();\n  }\n  const trace = AppImpl.instance.trace;\n  if (trace !== undefined && !traceItemsRegistered.has(trace)) {\n    traceItemsRegistered.add(trace);\n    registerTraceMenuItems(trace);\n  }\n}\n\nfunction registerGlobalSidebarEntries() {\n  const app = AppImpl.instance;\n  // TODO(primiano): The Open file / Open with legacy entries are registered by\n  // the 'perfetto.CoreCommands' plugins. Make things consistent.\n  app.sidebar.addMenuItem({\n    section: 'support',\n    text: 'Keyboard shortcuts',\n    action: toggleHelp,\n    icon: 'help',\n  });\n  app.sidebar.addMenuItem({\n    section: 'support',\n    text: 'Documentation',\n    href: 'https://perfetto.dev/docs',\n    icon: 'find_in_page',\n  });\n  app.sidebar.addMenuItem({\n    section: 'support',\n    sortOrder: 4,\n    text: 'Report a bug',\n    href: getBugReportUrl(),\n    icon: 'bug_report',\n  });\n}\n\nfunction registerTraceMenuItems(trace: TraceImpl) {\n  const downloadDisabled = trace.traceInfo.downloadable\n    ? false\n    : 'Cannot download external trace';\n\n  const traceTitle = trace?.traceInfo.traceTitle;\n  traceTitle &&\n    trace.sidebar.addMenuItem({\n      section: 'current_trace',\n      text: traceTitle,\n      href: trace.traceInfo.traceUrl,\n      action: () => copyToClipboard(trace.traceInfo.traceUrl),\n      tooltip: 'Click to copy the URL',\n      cssClass: 'trace-file-name',\n    });\n  trace.sidebar.addMenuItem({\n    section: 'current_trace',\n    text: 'Show timeline',\n    href: '#!/viewer',\n    icon: 'line_style',\n  });\n  globals.isInternalUser &&\n    trace.sidebar.addMenuItem({\n      section: 'current_trace',\n      text: 'Share',\n      action: async () => await shareTrace(trace),\n      icon: 'share',\n    });\n  trace.sidebar.addMenuItem({\n    section: 'current_trace',\n    text: 'Download',\n    action: () => downloadTrace(trace),\n    icon: 'file_download',\n    disabled: downloadDisabled,\n  });\n  trace.sidebar.addMenuItem({\n    section: 'convert_trace',\n    text: 'Switch to legacy UI',\n    action: async () => await openCurrentTraceWithOldUI(trace),\n    icon: 'filter_none',\n    disabled: downloadDisabled,\n  });\n  trace.sidebar.addMenuItem({\n    section: 'convert_trace',\n    text: 'Convert to .json',\n    action: async () => await convertTraceToJson(trace),\n    icon: 'file_download',\n    disabled: downloadDisabled,\n  });\n  trace.traceInfo.hasFtrace &&\n    trace.sidebar.addMenuItem({\n      section: 'convert_trace',\n      text: 'Convert to .systrace',\n      action: async () => await convertTraceToSystrace(trace),\n      icon: 'file_download',\n      disabled: downloadDisabled,\n    });\n  trace.sidebar.addMenuItem({\n    section: 'support',\n    sortOrder: 5,\n    text: () =>\n      isMetatracingEnabled() ? 'Finalize metatrace' : 'Record metatrace',\n    action: () => toggleMetatrace(trace.engine),\n    icon: () => (isMetatracingEnabled() ? 'download' : 'fiber_smart_record'),\n  });\n}\n\n// Used to deal with fields like the entry name, which can be either a direct\n// string or a callback that returns the string.\nfunction valueOrCallback<T>(value: T | (() => T)): T;\nfunction valueOrCallback<T>(value: T | (() => T) | undefined): T | undefined;\nfunction valueOrCallback<T>(value: T | (() => T) | undefined): T | undefined {\n  if (value === undefined) return undefined;\n  return value instanceof Function ? value() : value;\n}\n"]}
{"version":3,"file":"flow_events_panel.js","sourceRoot":"","sources":["../../../src/frontend/flow_events_panel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2020 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use size file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {Icons} from '../base/semantic_icons';\nimport {raf} from '../core/raf_scheduler';\nimport {Flow} from '../core/flow_types';\nimport {TraceImpl} from '../core/trace_impl';\n\nexport const ALL_CATEGORIES = '_all_';\n\nexport function getFlowCategories(flow: Flow): string[] {\n  const categories: string[] = [];\n  // v1 flows have their own categories\n  if (flow.category) {\n    categories.push(...flow.category.split(','));\n    return categories;\n  }\n  const beginCats = flow.begin.sliceCategory.split(',');\n  const endCats = flow.end.sliceCategory.split(',');\n  categories.push(...new Set([...beginCats, ...endCats]));\n  return categories;\n}\n\nexport interface FlowEventsAreaSelectedPanelAttrs {\n  trace: TraceImpl;\n}\n\nexport class FlowEventsAreaSelectedPanel\n  implements m.ClassComponent<FlowEventsAreaSelectedPanelAttrs>\n{\n  view({attrs}: m.CVnode<FlowEventsAreaSelectedPanelAttrs>) {\n    const selection = attrs.trace.selection.selection;\n    if (selection.kind !== 'area') {\n      return;\n    }\n\n    const columns = [\n      m('th', 'Flow Category'),\n      m('th', 'Number of flows'),\n      m(\n        'th',\n        'Show',\n        m(\n          'a.warning',\n          m('i.material-icons', 'warning'),\n          m(\n            '.tooltip',\n            'Showing a large number of flows may impact performance.',\n          ),\n        ),\n      ),\n    ];\n\n    const rows = [m('tr', columns)];\n\n    const categoryToFlowsNum = new Map<string, number>();\n\n    const flows = attrs.trace.flows;\n    flows.selectedFlows.forEach((flow) => {\n      const categories = getFlowCategories(flow);\n      categories.forEach((cat) => {\n        if (!categoryToFlowsNum.has(cat)) {\n          categoryToFlowsNum.set(cat, 0);\n        }\n        categoryToFlowsNum.set(cat, categoryToFlowsNum.get(cat)! + 1);\n      });\n    });\n\n    const allWasChecked = flows.visibleCategories.get(ALL_CATEGORIES);\n    rows.push(\n      m('tr.sum', [\n        m('td.sum-data', 'All'),\n        m('td.sum-data', flows.selectedFlows.length),\n        m(\n          'td.sum-data',\n          m(\n            'i.material-icons',\n            {\n              onclick: () => {\n                if (allWasChecked) {\n                  for (const k of flows.visibleCategories.keys()) {\n                    flows.setCategoryVisible(k, false);\n                  }\n                } else {\n                  categoryToFlowsNum.forEach((_, cat) => {\n                    flows.setCategoryVisible(cat, true);\n                  });\n                }\n                flows.setCategoryVisible(ALL_CATEGORIES, !allWasChecked);\n              },\n            },\n            allWasChecked ? Icons.Checkbox : Icons.BlankCheckbox,\n          ),\n        ),\n      ]),\n    );\n\n    categoryToFlowsNum.forEach((num, cat) => {\n      const wasChecked =\n        flows.visibleCategories.get(cat) ||\n        flows.visibleCategories.get(ALL_CATEGORIES);\n      const data = [\n        m('td.flow-info', cat),\n        m('td.flow-info', num),\n        m(\n          'td.flow-info',\n          m(\n            'i.material-icons',\n            {\n              onclick: () => {\n                if (wasChecked) {\n                  flows.setCategoryVisible(ALL_CATEGORIES, false);\n                }\n                flows.setCategoryVisible(cat, !wasChecked);\n                raf.scheduleFullRedraw();\n              },\n            },\n            wasChecked ? Icons.Checkbox : Icons.BlankCheckbox,\n          ),\n        ),\n      ];\n      rows.push(m('tr', data));\n    });\n\n    return m('.details-panel', [\n      m('.details-panel-heading', m('h2', `Selected flow events`)),\n      m('.flow-events-table', m('table', rows)),\n    ]);\n  }\n}\n"]}
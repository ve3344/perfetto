{"version":3,"file":"viewer_page.js","sourceRoot":"","sources":["../../../../src/frontend/viewer_page/viewer_page.ts"],"names":[],"mappings":";AAAA,qDAAqD;AACrD,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;;AAwfjC,sCAuBC;AAED,kEAeC;AAED,8DAeC;AAED,oDAgBC;AAED,kDAsCC;;AAzmBD,iDAAkC;AAClC,8DAAwB;AACxB,wDAAyD;AACzD,0DAA+D;AAC/D,oDAA4D;AAE5D,gDAAgD;AAChD,sDAA4C;AAC5C,0CAA+C;AAC/C,sDAAgD;AAChD,kDAA4C;AAC5C,4DAAsD;AAEtD,4DAA6C;AAG7C,oDAAuE;AACvE,iEAAmD;AACnD,uDAA4E;AAC5E,+CAAyC;AACzC,uEAAgE;AAChE,iEAAyD;AACzD,uDAI2B;AAC3B,2CAAqC;AACrC,qDAA+C;AAC/C,uDAAgD;AAChD,iEAA0D;AAC1D,+CAAyC;AACzC,iEAA8D;AAE9D,MAAM,mBAAmB,GAAG,4BAAY,CAAC,QAAQ,CAAC;IAChD,EAAE,EAAE,iBAAiB;IACrB,IAAI,EAAE,gBAAgB;IACtB,WAAW,EAAE,mDAAmD;IAChE,YAAY,EAAE,IAAI;CACnB,CAAC,CAAC;AAEH,kEAAkE;AAClE,+BAA+B;AAC/B,SAAS,mBAAmB,CAC1B,KAAgB,EAChB,SAAoB,EACpB,QAAgB;IAEhB,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;IAC5C,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;QAC9B,4EAA4E;QAC5E,iDAAiD;QACjD,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,YAAY;YACtC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY;YAC7B,CAAC,CAAC,SAAS,CAAC;QACd,MAAM,KAAK,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7C,MAAM,GAAG,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACzC,MAAM,SAAS,GAAG,QAAQ,GAAG,iCAAiB,CAAC;QAC/C,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,GAAG,SAAS,CAAC,CAAC;QAClD,MAAM,WAAW,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,SAAS,CAAC,CAAC;QAC9C,MAAM,KAAK,GAAG,CAAC,GAAG,MAAM,CAAC,gBAAgB,CAAC;QAC1C,iEAAiE;QACjE,mBAAmB;QACnB,IAAI,aAAa,GAAG,KAAK,IAAI,aAAa,IAAI,WAAW;YAAE,OAAO,OAAO,CAAC;QAC1E,IAAI,WAAW,GAAG,KAAK,IAAI,WAAW,IAAI,aAAa;YAAE,OAAO,KAAK,CAAC;IACxE,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAQD;;;GAGG;AACH,MAAa,UAAU;IACb,WAAW,CAAqB;IACxC,oEAAoE;IAC5D,oBAAoB,GAAG,KAAK,CAAC;IAE7B,qBAAqB,CAAwB;IAC7C,aAAa,CAAgB;IAC7B,kBAAkB,CAAqB;IACvC,UAAU,CAAa;IACvB,aAAa,CAAgB;IAC7B,eAAe,CAAU;IACzB,iBAAiB,CAAqB;IACtC,eAAe,GAAG,KAAK,CAAC;IAEf,oBAAoB,GAAG,sBAAsB,CAAC;IAE/D,YAAY,KAAuC;QACjD,IAAI,CAAC,UAAU,GAAG,IAAI,wBAAU,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACpD,IAAI,CAAC,aAAa,GAAG,IAAI,+BAAa,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC1D,IAAI,CAAC,kBAAkB,GAAG,IAAI,yCAAkB,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACpE,IAAI,CAAC,aAAa,GAAG,IAAI,8BAAa,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC1D,IAAI,CAAC,qBAAqB,GAAG,IAAI,+CAAqB,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC1E,IAAI,CAAC,UAAU,GAAG,IAAI,wBAAU,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QACpD,IAAI,CAAC,kBAAkB,GAAG,IAAI,yCAAkB,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACtE,CAAC;IAED,QAAQ,CAAC,EAAC,GAAG,EAAE,KAAK,EAAsC;QACxD,MAAM,YAAY,GAAG,IAAA,mBAAO,EAAC,GAAG,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAC7D,MAAM,SAAS,GAAG,IAAA,yBAAa,EAAC,IAAA,sBAAY,EAAC,YAAY,CAAC,CAAC,CAAC;QAE5D,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,SAAS,CAAC,qBAAqB,EAAE,CAAC;QACxD,IAAI,CAAC,WAAW,GAAG,IAAI,wCAAiB,CAAC;YACvC,OAAO,EAAE,SAAS;YAClB,QAAQ,EAAE,CAAC,QAAgB,EAAE,EAAE;gBAC7B,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC;gBAEtC,IAAI,IAAI,CAAC,eAAe,KAAK,SAAS;oBAAE,OAAO;gBAE/C,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;gBACjC,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,QAAQ,CAAC,aAAa,EAAE;oBACtD,IAAI,EAAE,CAAC;oBACP,KAAK,EAAE,IAAI,CAAC,eAAe;iBAC5B,CAAC,CAAC;gBACH,MAAM,MAAM,GAAG,SAAS,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC;gBAChD,QAAQ,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;YACpC,CAAC;YACD,QAAQ,EAAE,CAAC,gBAAwB,EAAE,SAAiB,EAAE,EAAE;gBACxD,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC;gBACtC,iDAAiD;gBACjD,+DAA+D;gBAC/D,MAAM,MAAM,GAAG,gBAAgB,GAAG,iCAAiB,CAAC;gBACpD,MAAM,IAAI,GAAG,GAAG,CAAC,qBAAqB,EAAE,CAAC;gBACzC,MAAM,WAAW,GAAG,MAAM,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,iCAAiB,CAAC,CAAC;gBAC9D,QAAQ,CAAC,iBAAiB,CAAC,CAAC,GAAG,SAAS,EAAE,WAAW,CAAC,CAAC;gBACvD,mBAAG,CAAC,oBAAoB,EAAE,CAAC;YAC7B,CAAC;YACD,aAAa,EAAE,CAAC,SAAiB,EAAE,EAAE;gBACnC,IAAI,IAAI,CAAC,eAAe,KAAK,SAAS;oBAAE,OAAO,KAAK,CAAC;gBACrD,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,EAAE;oBAClE,IAAI,EAAE,CAAC;oBACP,KAAK,EAAE,IAAI,CAAC,eAAe;iBAC5B,CAAC,CAAC;gBACH,OAAO,mBAAmB,CAAC,KAAK,CAAC,KAAK,EAAE,SAAS,EAAE,SAAS,CAAC,KAAK,IAAI,CAAC;YACzE,CAAC;YACD,WAAW,EAAE,CACX,UAAkB,EAClB,UAAkB,EAClB,KAAa,EACb,QAAgB,EAChB,QAAgB,EAChB,OAAgB,EAChB,EAAE;gBACF,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;gBACxC,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC;gBAEtC,IAAI,IAAI,CAAC,eAAe,KAAK,SAAS;oBAAE,OAAO;gBAE/C,wEAAwE;gBACxE,QAAQ;gBACR,MAAM,EAAC,aAAa,EAAC,GAAG,QAAQ,CAAC;gBACjC,MAAM,QAAQ,GAAG,aAAa,CAAC,UAAU,EAAE,CAAC;gBAC5C,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;gBAEjC,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,QAAQ,CAAC,aAAa,EAAE;oBACtD,IAAI,EAAE,CAAC;oBACP,KAAK,EAAE,IAAI,CAAC,eAAe;iBAC5B,CAAC,CAAC;gBAEH,IAAI,OAAO,EAAE,CAAC;oBACZ,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;oBAClD,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;wBAC9B,MAAM,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY;4BAC5C,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY;4BACnC,CAAC,CAAC,SAAS,CAAC;wBACd,IAAI,OAAO,GAAG,SAAS;6BACpB,UAAU,CAAC,QAAQ,GAAG,iCAAiB,CAAC;6BACxC,MAAM,EAAE,CAAC;wBACZ,oEAAoE;wBACpE,MAAM,WAAW,GAAG,mBAAmB,CACrC,KAAK,CAAC,KAAK,EACX,SAAS,EACT,KAAK,CACN,CAAC;wBACF,IAAI,WAAW,IAAI,IAAI;4BAAE,OAAO;wBAChC,MAAM,QAAQ,GAAG,WAAW,KAAK,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;wBACjE,kDAAkD;wBAClD,IAAI,OAAO,GAAG,QAAQ,EAAE,CAAC;4BACvB,OAAO,GAAG,WAAI,CAAC,GAAG,CAAC,OAAO,EAAE,QAAQ,CAAC,KAAK,CAAC,CAAC;wBAC9C,CAAC;6BAAM,CAAC;4BACN,OAAO,GAAG,WAAI,CAAC,GAAG,CAAC,OAAO,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC;wBAC5C,CAAC;wBACD,8DAA8D;wBAC9D,+BAA+B;wBAC/B,QAAQ,CAAC,UAAU,CACjB,WAAI,CAAC,GAAG,CAAC,WAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,SAAS,CAAC,KAAK,CAAC,EACtD,WAAI,CAAC,GAAG,CAAC,WAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,SAAS,CAAC,GAAG,CAAC,EACpD,SAAS,CAAC,SAAS,CACpB,CAAC;oBACJ,CAAC;gBACH,CAAC;qBAAM,CAAC;oBACN,IAAI,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,iCAAiB,CAAC;oBACjE,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,iCAAiB,CAAC;oBAC/D,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,GAAG,CAAC;wBAAE,OAAO;oBACrC,OAAO,GAAG,IAAA,kBAAK,EAAC,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;oBAClD,KAAK,GAAG,IAAA,kBAAK,EAAC,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;oBAC9C,QAAQ,CAAC,UAAU,CACjB,SAAS,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,EAC7C,SAAS,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAC3C,CAAC;oBAEF,MAAM,SAAS,GAAG,UAAU,GAAG,MAAM,CAAC;oBACtC,MAAM,WAAW,GAAG,QAAQ,GAAG,MAAM,CAAC;oBACtC,IAAI,IAAI,CAAC,iBAAiB,KAAK,SAAS,EAAE,CAAC;wBACzC,KAAK,MAAM,CAAC,IAAI,GAAG,CAAC,gBAAgB,CAAC,qBAAqB,CAAC,EAAE,CAAC;4BAC5D,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,CAAC,CAAC,qBAAqB,EAAE,CAAC;4BAChD,IAAI,GAAG,IAAI,SAAS,IAAI,WAAW,IAAI,MAAM,EAAE,CAAC;gCAC9C,MAAM,KAAK,GAAG,IAAA,sBAAY,EAAC,CAAC,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;gCAC/D,MAAM,QAAQ,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC,GAAG,CAAC;gCACnD,IAAI,CAAC,iBAAiB,GAAG;oCACvB,cAAc,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,CAC5C,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,oBAAoB,CAClC,CAAC,CAAC,CAAC;oCACJ,aAAa,EAAE,CAAC,QAAQ,GAAG,SAAS;oCACpC,WAAW,EAAE,CAAC,QAAQ,GAAG,WAAW;iCACrC,CAAC;gCACF,MAAM;4BACR,CAAC;wBACH,CAAC;oBACH,CAAC;yBAAM,CAAC;wBACN,MAAM,CAAC,GAAG,IAAA,sBAAY,EACpB,GAAG,CAAC,aAAa,CAAC,IAAI,IAAI,CAAC,iBAAiB,CAAC,cAAc,EAAE,CAAC,CAC/D,CAAC;wBACF,MAAM,EAAC,GAAG,EAAE,MAAM,EAAC,GAAG,CAAC,CAAC,qBAAqB,EAAE,CAAC;wBAChD,MAAM,eAAe,GAAG,IAAI,CAAC,GAAG,CAC9B,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,WAAW,CAAC,EAC1B,MAAM,CACP,CAAC;wBACF,MAAM,KAAK,GAAG,IAAA,sBAAY,EAAC,CAAC,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;wBAC/D,MAAM,QAAQ,GAAG,KAAK,CAAC,qBAAqB,EAAE,CAAC,GAAG,CAAC;wBACnD,IAAI,CAAC,iBAAiB,GAAG;4BACvB,GAAG,IAAI,CAAC,iBAAiB;4BACzB,WAAW,EAAE,CAAC,QAAQ,GAAG,eAAe;yBACzC,CAAC;oBACJ,CAAC;oBACD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;gBAC9B,CAAC;gBACD,mBAAG,CAAC,oBAAoB,EAAE,CAAC;YAC7B,CAAC;YACD,YAAY,EAAE,CAAC,IAAa,EAAE,EAAE;gBAC9B,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;gBACnC,MAAM,IAAI,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC;gBAC/C,qEAAqE;gBACrE,gDAAgD;gBAChD,IAAI,IAAI,EAAE,CAAC;oBACT,MAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;oBAClD,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,IAAI,IAAI,EAAE,CAAC;wBACtC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,EAAC,GAAG,IAAI,EAAC,CAAC,CAAC;oBAC9C,CAAC;gBACH,CAAC;qBAAM,IAAI,IAAI,EAAE,CAAC;oBAChB,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,EAAC,GAAG,IAAI,EAAC,CAAC,CAAC;gBAC9C,CAAC;gBACD,uEAAuE;gBACvE,iEAAiE;gBACjE,YAAY;gBACZ,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;gBACpC,oCAAoC;gBACpC,mBAAG,CAAC,kBAAkB,EAAE,CAAC;YAC3B,CAAC;SACF,CAAC,CAAC;IACL,CAAC;IAED,QAAQ;QACN,IAAI,IAAI,CAAC,WAAW;YAAE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC;IAC3D,CAAC;IAED,IAAI,CAAC,EAAC,KAAK,EAAmC;QAC5C,MAAM,eAAe,GAAG,oBAAoB,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAE1D,MAAM,MAAM,GAAG,IAAA,iBAAC,EACd,mBAAmB,EACnB,IAAA,iBAAC,EACC,oBAAQ,EACR;YACE,KAAK,EAAE,KAAK,CAAC,KAAK;SACnB,EACD,IAAA,iBAAC,EACC,uBAAuB,EACvB;YACE,GAAG,EAAE,IAAI,CAAC,oBAAoB;YAC9B,OAAO,EAAE,GAAG,EAAE;gBACZ,yDAAyD;gBACzD,IAAI,IAAI,CAAC,oBAAoB,EAAE,CAAC;oBAC9B,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;oBAClC,OAAO;gBACT,CAAC;gBACD,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;YAChC,CAAC;SACF,EACD,IAAA,iBAAC,EACC,qBAAqB,EACrB,IAAA,iBAAC,EAAC,gCAAc,EAAE;YAChB,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,SAAS,EAAE,wBAAwB;YACnC,MAAM,EAAE,IAAA,+BAAiB,EAAC;gBACxB,mBAAmB,CAAC,GAAG,EAAE,IAAI,IAAI,CAAC,qBAAqB;gBACvD,IAAI,CAAC,aAAa;gBAClB,IAAI,CAAC,kBAAkB;gBACvB,IAAI,CAAC,UAAU;gBACf,IAAI,CAAC,aAAa;aACnB,CAAC;YACF,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,wBAAwB,CAAC;SACzD,CAAC,EACF,IAAA,iBAAC,EAAC,4BAA4B,CAAC,CAChC,EACD,IAAA,iBAAC,EAAC,gCAAc,EAAE;YAChB,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,SAAS,EAAE,wBAAwB;YACnC,MAAM,EAAE,kBAAO,CAAC,QAAQ,CAAC,cAAc;gBACrC,CAAC,CAAC,EAAE;gBACJ,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;oBACnD,IAAI,SAAS,CAAC,GAAG,EAAE,CAAC;wBAClB,MAAM,EAAE,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAC5C,SAAS,CAAC,GAAG,CACd,CAAC;wBACF,OAAO,IAAI,wBAAU,CAAC;4BACpB,KAAK,EAAE,KAAK,CAAC,KAAK;4BAClB,WAAW,EAAE,IAAI;4BACjB,IAAI,EAAE,SAAS;4BACf,aAAa,EAAE,EAAE;4BACjB,cAAc,EAAE,IAAI;4BACpB,gBAAgB,EAAE,CAAC;4BACnB,WAAW,EAAE,CAAC;yBACf,CAAC,CAAC;oBACL,CAAC;yBAAM,CAAC;wBACN,OAAO,IAAI,wBAAU,CAAC;4BACpB,KAAK,EAAE,KAAK,CAAC,KAAK;4BAClB,IAAI,EAAE,SAAS;4BACf,cAAc,EAAE,IAAI;4BACpB,gBAAgB,EAAE,CAAC;4BACnB,WAAW,EAAE,CAAC;yBACf,CAAC,CAAC;oBACL,CAAC;gBACH,CAAC,CAAC;YACN,cAAc,EAAE,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAC5B,cAAc,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC;YACxC,aAAa,EAAE,CAAC,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,CACnC,aAAa,CACX,KAAK,CAAC,KAAK,EACX,GAAG,EACH,IAAI,EACJ,MAAM,EACN,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,gBAAgB,CACvC;YACH,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,wBAAwB,CAAC;SACzD,CAAC,EACF,IAAA,iBAAC,EAAC,gCAAc,EAAE;YAChB,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,SAAS,EAAE,2BAA2B;YACtC,MAAM,EAAE,kBAAO,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,eAAe;YAC9D,kBAAkB,EAAE,CAAC,KAAK,EAAE,EAAE;gBAC5B,MAAM,aAAa,GAAG,KAAK,GAAG,iCAAiB,CAAC;gBAChD,IAAI,CAAC,eAAe,GAAG,aAAa,CAAC;YACvC,CAAC;YACD,cAAc,EAAE,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAC5B,cAAc,CAAC,KAAK,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC;YACxC,aAAa,EAAE,CAAC,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,CACnC,aAAa,CACX,KAAK,CAAC,KAAK,EACX,GAAG,EACH,IAAI,EACJ,MAAM,EACN,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAC7B;YACH,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,2BAA2B,CAAC;SAC5D,CAAC,CACH,CACF,EAED,IAAI,CAAC,eAAe,IAAI,IAAA,iBAAC,EAAC,uBAAuB,CAAC,CACnD,CAAC;QAEF,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC;QACpC,OAAO,MAAM,CAAC;IAChB,CAAC;IAEO,SAAS,CAAC,GAAW;QAC3B,IAAI,IAAI,CAAC,iBAAiB,EAAE,cAAc,KAAK,GAAG,EAAE,CAAC;YACnD,OAAO,SAAS,CAAC;QACnB,CAAC;QACD,MAAM,EAAC,aAAa,EAAE,WAAW,EAAC,GAAG,IAAI,CAAC,iBAAiB,CAAC;QAC5D,OAAO;YACL,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,WAAW,CAAC;YACzC,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,WAAW,CAAC;SAC7C,CAAC;IACJ,CAAC;CACF;AA3TD,gCA2TC;AAED,SAAS,cAAc,CACrB,KAAgB,EAChB,GAA6B,EAC7B,UAAkB;;;QAElB,MAAM,IAAI,GAAG;YACX,KAAK,EAAE,UAAU,CAAC,KAAK,GAAG,iCAAiB;YAC3C,MAAM,EAAE,UAAU,CAAC,MAAM;SAC1B,CAAC;QAEF,MAAM,CAAC,0CAAG,IAAA,yBAAU,EAAC,GAAG,CAAC,QAAA,CAAC;QAC1B,GAAG,CAAC,SAAS,CAAC,iCAAiB,EAAE,CAAC,CAAC,CAAC;QAEpC,MAAM,UAAU,GAAG,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC;QAChD,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,UAAU,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;QAE1E,wEAAwE;QACxE,aAAa,CAAC,KAAK,EAAE,GAAG,EAAE,UAAU,CAAC,UAAU,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;;;;;;;;;CACrE;AAED,SAAS,aAAa,CACpB,KAAgB,EAChB,GAA6B,EAC7B,UAAkB,EAClB,MAAwC,EACxC,cAAyB;;;QAEzB,MAAM,IAAI,GAAG;YACX,KAAK,EAAE,UAAU,CAAC,KAAK,GAAG,iCAAiB;YAC3C,MAAM,EAAE,UAAU,CAAC,MAAM;SAC1B,CAAC;QAEF,MAAM,CAAC,0CAAG,IAAA,yBAAU,EAAC,GAAG,CAAC,QAAA,CAAC;QAC1B,GAAG,CAAC,SAAS,CAAC,iCAAiB,EAAE,CAAC,CAAC,CAAC;QACpC,IAAA,yBAAU,EAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;QAE/C,qEAAqE;QACrE,IAAA,kCAAW,EAAC,KAAK,EAAE,GAAG,EAAE,IAAI,EAAE,MAAM,EAAE,cAAc,CAAC,CAAC;QAEtD,MAAM,UAAU,GAAG,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC;QAChD,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,UAAU,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,CAAC;QAE1E,yBAAyB,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QACvD,2BAA2B,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QACzD,oBAAoB,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QAClD,mBAAmB,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;;;;;;;;;CAClD;AAED,0DAA0D;AAC1D,SAAS,oBAAoB,CAAC,KAAgB;IAC5C,OAAO,WAAW,CAAC,KAAK,EAAE,KAAK,CAAC,SAAS,CAAC,QAAQ,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;AAC5D,CAAC;AAED,gFAAgF;AAChF,kBAAkB;AAClB,SAAS,WAAW,CAClB,KAAgB,EAChB,KAA+B,EAC/B,MAAc,EACd,WAAmB;IAEnB,OAAO,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,EAAE;QAC5B,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;YAClB,gDAAgD;YAChD,OAAO,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;QAChE,CAAC;aAAM,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACtC,OAAO,gBAAgB,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;QAC5D,CAAC;aAAM,CAAC;YACN,MAAM,WAAW,GAAG,gBAAgB,CAAC,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,WAAW,CAAC,CAAC;YACvE,MAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC;YAChC,MAAM,eAAe,GAAG,QAAQ;gBAC9B,CAAC,CAAC,WAAW,GAAG,WAAW,CAAC,QAAQ;gBACpC,CAAC,CAAC,WAAW,CAAC;YAChB,OAAO;gBACL,IAAI,EAAE,OAAO;gBACb,SAAS,EAAE,IAAI,CAAC,SAAS;gBACzB,MAAM,EAAE,WAAW;gBACnB,MAAM,EAAE,QAAQ,EAAE,sBAAsB;gBACxC,WAAW;gBACX,WAAW,EAAE,IAAI,CAAC,SAAS;oBACzB,CAAC,CAAC,EAAE;oBACJ,CAAC,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,QAAQ,EAAE,MAAM,GAAG,CAAC,EAAE,eAAe,CAAC;aACnE,CAAC;QACJ,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,gBAAgB,CACvB,KAAgB,EAChB,SAAoB,EACpB,MAAc,EACd,WAAmB;IAEnB,IAAI,EAAE,GAAG,SAAS,CAAC;IACnB,IAAI,SAAS,CAAC,GAAG,EAAE,CAAC;QAClB,EAAE,GAAG,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;IACpD,CAAC;IACD,OAAO,IAAI,wBAAU,CAAC;QACpB,KAAK;QACL,IAAI,EAAE,SAAS;QACf,aAAa,EAAE,EAAE;QACjB,gBAAgB,EAAE,MAAM;QACxB,WAAW;KACZ,CAAC,CAAC;AACL,CAAC;AAED,SAAgB,aAAa,CAC3B,KAAgB,EAChB,GAA6B,EAC7B,QAAkB,EAClB,SAAoB,EACpB,IAAY;IAEZ,GAAG,CAAC,WAAW,GAAG,kCAAkB,CAAC;IACrC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC;IAElB,IAAI,IAAI,CAAC,KAAK,GAAG,CAAC,IAAI,QAAQ,CAAC,QAAQ,GAAG,EAAE,EAAE,CAAC;QAC7C,MAAM,aAAa,GAAG,IAAA,kCAAgB,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACnD,MAAM,MAAM,GAAG,KAAK,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC;QAChD,KAAK,MAAM,EAAC,IAAI,EAAE,IAAI,EAAC,IAAI,IAAA,+BAAa,EAAC,QAAQ,EAAE,aAAa,EAAE,MAAM,CAAC,EAAE,CAAC;YAC1E,MAAM,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;YAChD,IAAI,IAAI,KAAK,0BAAQ,CAAC,KAAK,EAAE,CAAC;gBAC5B,GAAG,CAAC,SAAS,EAAE,CAAC;gBAChB,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC;gBACxB,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gBAClC,GAAG,CAAC,MAAM,EAAE,CAAC;YACf,CAAC;QACH,CAAC;IACH,CAAC;AACH,CAAC;AAED,SAAgB,2BAA2B,CACzC,KAAgB,EAChB,GAA6B,EAC7B,SAAoB,EACpB,IAAY;IAEZ,IAAI,KAAK,CAAC,QAAQ,CAAC,oBAAoB,KAAK,SAAS,EAAE,CAAC;QACtD,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,KAAK,CAAC,QAAQ,CAAC,oBAAoB,EACnC,IAAI,CAAC,MAAM,EACX,SAAS,CACV,CAAC;IACJ,CAAC;AACH,CAAC;AAED,SAAgB,yBAAyB,CACvC,KAAgB,EAChB,GAA6B,EAC7B,SAAoB,EACpB,IAAY;IAEZ,IAAI,KAAK,CAAC,QAAQ,CAAC,oBAAoB,KAAK,SAAS,EAAE,CAAC;QACtD,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,KAAK,CAAC,QAAQ,CAAC,oBAAoB,EACnC,IAAI,CAAC,MAAM,EACX,MAAM,CACP,CAAC;IACJ,CAAC;AACH,CAAC;AAED,SAAgB,oBAAoB,CAClC,KAAgB,EAChB,GAA6B,EAC7B,SAAoB,EACpB,IAAY;IAEZ,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;IAC5C,IAAI,SAAS,CAAC,IAAI,KAAK,aAAa,IAAI,SAAS,CAAC,QAAQ,EAAE,CAAC;QAC3D,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,SAAS,CAAC,QAAQ,EAClB,IAAI,CAAC,MAAM,EACX,OAAO,CACR,CAAC;IACJ,CAAC;AACH,CAAC;AAED,SAAgB,mBAAmB,CACjC,KAAgB,EAChB,GAA6B,EAC7B,SAAoB,EACpB,IAAY;IAEZ,+DAA+D;IAC/D,6BAA6B;IAC7B,KAAK,MAAM,IAAI,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC;QAC9C,IAAI,IAAI,CAAC,QAAQ,KAAK,MAAM,EAAE,CAAC;YAC7B,MAAM,oBAAoB,GACxB,OAAO,GAAG,mBAAG,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,GAAG,SAAS,CAAC;YACjE,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,MAAM,EACX,oBAAoB,EACpB,CAAC,CACF,CAAC;YACF,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,IAAI,CAAC,GAAG,EACR,IAAI,CAAC,MAAM,EACX,oBAAoB,EACpB,CAAC,CACF,CAAC;QACJ,CAAC;aAAM,IAAI,IAAI,CAAC,QAAQ,KAAK,SAAS,EAAE,CAAC;YACvC,IAAA,6CAAsB,EACpB,GAAG,EACH,SAAS,EACT,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,IAAI,CAAC,KAAK,CACX,CAAC;QACJ,CAAC;IACH,CAAC;AACH,CAAC;AAED,MAAM,uBAAuB;IACV,gBAAgB,GAAG,sBAAsB,CAAC;IACnD,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,MAAM,CAAC;IAE3E,IAAI;QACF,2EAA2E;QAC3E,0EAA0E;QAC1E,6CAA6C;QAC7C,IAAI,kBAAO,CAAC,QAAQ,CAAC,YAAY,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACpD,OAAO;QACT,CAAC;QACD,OAAO,IAAA,iBAAC,EACN,eAAe,EACf,IAAA,iBAAC,EACC,YAAY,EACZ,kEAAkE;YAChE,oCAAoC,CACvC,EACD,IAAA,iBAAC,EACC,4BAA4B,EAC5B;YACE,OAAO,EAAE,GAAG,EAAE;gBACZ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;gBACtB,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC;gBACpD,mBAAG,CAAC,kBAAkB,EAAE,CAAC;YAC3B,CAAC;SACF,EACD,SAAS,CACV,CACF,CAAC;IACJ,CAAC;CACF","sourcesContent":["// Copyright (C) 2018 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {hex} from 'color-convert';\nimport m from 'mithril';\nimport {removeFalsyValues} from '../../base/array_utils';\nimport {canvasClip, canvasSave} from '../../base/canvas_utils';\nimport {findRef, toHTMLElement} from '../../base/dom_utils';\nimport {Size2D, VerticalBounds} from '../../base/geom';\nimport {assertExists} from '../../base/logging';\nimport {clamp} from '../../base/math_utils';\nimport {Time, TimeSpan} from '../../base/time';\nimport {TimeScale} from '../../base/time_scale';\nimport {AppImpl} from '../../core/app_impl';\nimport {featureFlags} from '../../core/feature_flags';\nimport {PageWithTraceImplAttrs} from '../../core/page_manager';\nimport {raf} from '../../core/raf_scheduler';\nimport {TraceImpl} from '../../core/trace_impl';\nimport {TrackNode} from '../../public/workspace';\nimport {TRACK_BORDER_COLOR, TRACK_SHELL_WIDTH} from '../css_constants';\nimport {renderFlows} from './flow_events_renderer';\nimport {generateTicks, getMaxMajorTicks, TickType} from './gridline_helper';\nimport {NotesPanel} from './notes_panel';\nimport {OverviewTimelinePanel} from './overview_timeline_panel';\nimport {PanAndZoomHandler} from './pan_and_zoom_handler';\nimport {\n  PanelContainer,\n  PanelOrGroup,\n  RenderedPanelInfo,\n} from './panel_container';\nimport {TabPanel} from './tab_panel';\nimport {TickmarkPanel} from './tickmark_panel';\nimport {TimeAxisPanel} from './time_axis_panel';\nimport {TimeSelectionPanel} from './time_selection_panel';\nimport {TrackPanel} from './track_panel';\nimport {drawVerticalLineAtTime} from './vertical_line_helper';\n\nconst OVERVIEW_PANEL_FLAG = featureFlags.register({\n  id: 'overviewVisible',\n  name: 'Overview Panel',\n  description: 'Show the panel providing an overview of the trace',\n  defaultValue: true,\n});\n\n// Checks if the mousePos is within 3px of the start or end of the\n// current selected time range.\nfunction onTimeRangeBoundary(\n  trace: TraceImpl,\n  timescale: TimeScale,\n  mousePos: number,\n): 'START' | 'END' | null {\n  const selection = trace.selection.selection;\n  if (selection.kind === 'area') {\n    // If frontend selectedArea exists then we are in the process of editing the\n    // time range and need to use that value instead.\n    const area = trace.timeline.selectedArea\n      ? trace.timeline.selectedArea\n      : selection;\n    const start = timescale.timeToPx(area.start);\n    const end = timescale.timeToPx(area.end);\n    const startDrag = mousePos - TRACK_SHELL_WIDTH;\n    const startDistance = Math.abs(start - startDrag);\n    const endDistance = Math.abs(end - startDrag);\n    const range = 3 * window.devicePixelRatio;\n    // We might be within 3px of both boundaries but we should choose\n    // the closest one.\n    if (startDistance < range && startDistance <= endDistance) return 'START';\n    if (endDistance < range && endDistance <= startDistance) return 'END';\n  }\n  return null;\n}\n\ninterface SelectedContainer {\n  readonly containerClass: string;\n  readonly dragStartAbsY: number;\n  readonly dragEndAbsY: number;\n}\n\n/**\n * Top-most level component for the viewer page. Holds tracks, brush timeline,\n * panels, and everything else that's part of the main trace viewer page.\n */\nexport class ViewerPage implements m.ClassComponent<PageWithTraceImplAttrs> {\n  private zoomContent?: PanAndZoomHandler;\n  // Used to prevent global deselection if a pan/drag select occurred.\n  private keepCurrentSelection = false;\n\n  private overviewTimelinePanel: OverviewTimelinePanel;\n  private timeAxisPanel: TimeAxisPanel;\n  private timeSelectionPanel: TimeSelectionPanel;\n  private notesPanel: NotesPanel;\n  private tickmarkPanel: TickmarkPanel;\n  private timelineWidthPx?: number;\n  private selectedContainer?: SelectedContainer;\n  private showPanningHint = false;\n\n  private readonly PAN_ZOOM_CONTENT_REF = 'pan-and-zoom-content';\n\n  constructor(vnode: m.CVnode<PageWithTraceImplAttrs>) {\n    this.notesPanel = new NotesPanel(vnode.attrs.trace);\n    this.timeAxisPanel = new TimeAxisPanel(vnode.attrs.trace);\n    this.timeSelectionPanel = new TimeSelectionPanel(vnode.attrs.trace);\n    this.tickmarkPanel = new TickmarkPanel(vnode.attrs.trace);\n    this.overviewTimelinePanel = new OverviewTimelinePanel(vnode.attrs.trace);\n    this.notesPanel = new NotesPanel(vnode.attrs.trace);\n    this.timeSelectionPanel = new TimeSelectionPanel(vnode.attrs.trace);\n  }\n\n  oncreate({dom, attrs}: m.CVnodeDOM<PageWithTraceImplAttrs>) {\n    const panZoomElRaw = findRef(dom, this.PAN_ZOOM_CONTENT_REF);\n    const panZoomEl = toHTMLElement(assertExists(panZoomElRaw));\n\n    const {top: panTop} = panZoomEl.getBoundingClientRect();\n    this.zoomContent = new PanAndZoomHandler({\n      element: panZoomEl,\n      onPanned: (pannedPx: number) => {\n        const timeline = attrs.trace.timeline;\n\n        if (this.timelineWidthPx === undefined) return;\n\n        this.keepCurrentSelection = true;\n        const timescale = new TimeScale(timeline.visibleWindow, {\n          left: 0,\n          right: this.timelineWidthPx,\n        });\n        const tDelta = timescale.pxToDuration(pannedPx);\n        timeline.panVisibleWindow(tDelta);\n      },\n      onZoomed: (zoomedPositionPx: number, zoomRatio: number) => {\n        const timeline = attrs.trace.timeline;\n        // TODO(hjd): Avoid hardcoding TRACK_SHELL_WIDTH.\n        // TODO(hjd): Improve support for zooming in overview timeline.\n        const zoomPx = zoomedPositionPx - TRACK_SHELL_WIDTH;\n        const rect = dom.getBoundingClientRect();\n        const centerPoint = zoomPx / (rect.width - TRACK_SHELL_WIDTH);\n        timeline.zoomVisibleWindow(1 - zoomRatio, centerPoint);\n        raf.scheduleCanvasRedraw();\n      },\n      editSelection: (currentPx: number) => {\n        if (this.timelineWidthPx === undefined) return false;\n        const timescale = new TimeScale(attrs.trace.timeline.visibleWindow, {\n          left: 0,\n          right: this.timelineWidthPx,\n        });\n        return onTimeRangeBoundary(attrs.trace, timescale, currentPx) !== null;\n      },\n      onSelection: (\n        dragStartX: number,\n        dragStartY: number,\n        prevX: number,\n        currentX: number,\n        currentY: number,\n        editing: boolean,\n      ) => {\n        const traceTime = attrs.trace.traceInfo;\n        const timeline = attrs.trace.timeline;\n\n        if (this.timelineWidthPx === undefined) return;\n\n        // TODO(stevegolton): Don't get the windowSpan from globals, get it from\n        // here!\n        const {visibleWindow} = timeline;\n        const timespan = visibleWindow.toTimeSpan();\n        this.keepCurrentSelection = true;\n\n        const timescale = new TimeScale(timeline.visibleWindow, {\n          left: 0,\n          right: this.timelineWidthPx,\n        });\n\n        if (editing) {\n          const selection = attrs.trace.selection.selection;\n          if (selection.kind === 'area') {\n            const area = attrs.trace.timeline.selectedArea\n              ? attrs.trace.timeline.selectedArea\n              : selection;\n            let newTime = timescale\n              .pxToHpTime(currentX - TRACK_SHELL_WIDTH)\n              .toTime();\n            // Have to check again for when one boundary crosses over the other.\n            const curBoundary = onTimeRangeBoundary(\n              attrs.trace,\n              timescale,\n              prevX,\n            );\n            if (curBoundary == null) return;\n            const keepTime = curBoundary === 'START' ? area.end : area.start;\n            // Don't drag selection outside of current screen.\n            if (newTime < keepTime) {\n              newTime = Time.max(newTime, timespan.start);\n            } else {\n              newTime = Time.min(newTime, timespan.end);\n            }\n            // When editing the time range we always use the saved tracks,\n            // since these will not change.\n            timeline.selectArea(\n              Time.max(Time.min(keepTime, newTime), traceTime.start),\n              Time.min(Time.max(keepTime, newTime), traceTime.end),\n              selection.trackUris,\n            );\n          }\n        } else {\n          let startPx = Math.min(dragStartX, currentX) - TRACK_SHELL_WIDTH;\n          let endPx = Math.max(dragStartX, currentX) - TRACK_SHELL_WIDTH;\n          if (startPx < 0 && endPx < 0) return;\n          startPx = clamp(startPx, 0, this.timelineWidthPx);\n          endPx = clamp(endPx, 0, this.timelineWidthPx);\n          timeline.selectArea(\n            timescale.pxToHpTime(startPx).toTime('floor'),\n            timescale.pxToHpTime(endPx).toTime('ceil'),\n          );\n\n          const absStartY = dragStartY + panTop;\n          const absCurrentY = currentY + panTop;\n          if (this.selectedContainer === undefined) {\n            for (const c of dom.querySelectorAll('.pf-panel-container')) {\n              const {top, bottom} = c.getBoundingClientRect();\n              if (top <= absStartY && absCurrentY <= bottom) {\n                const stack = assertExists(c.querySelector('.pf-panel-stack'));\n                const stackTop = stack.getBoundingClientRect().top;\n                this.selectedContainer = {\n                  containerClass: Array.from(c.classList).filter(\n                    (x) => x !== 'pf-panel-container',\n                  )[0],\n                  dragStartAbsY: -stackTop + absStartY,\n                  dragEndAbsY: -stackTop + absCurrentY,\n                };\n                break;\n              }\n            }\n          } else {\n            const c = assertExists(\n              dom.querySelector(`.${this.selectedContainer.containerClass}`),\n            );\n            const {top, bottom} = c.getBoundingClientRect();\n            const boundedCurrentY = Math.min(\n              Math.max(top, absCurrentY),\n              bottom,\n            );\n            const stack = assertExists(c.querySelector('.pf-panel-stack'));\n            const stackTop = stack.getBoundingClientRect().top;\n            this.selectedContainer = {\n              ...this.selectedContainer,\n              dragEndAbsY: -stackTop + boundedCurrentY,\n            };\n          }\n          this.showPanningHint = true;\n        }\n        raf.scheduleCanvasRedraw();\n      },\n      endSelection: (edit: boolean) => {\n        this.selectedContainer = undefined;\n        const area = attrs.trace.timeline.selectedArea;\n        // If we are editing we need to pass the current id through to ensure\n        // the marked area with that id is also updated.\n        if (edit) {\n          const selection = attrs.trace.selection.selection;\n          if (selection.kind === 'area' && area) {\n            attrs.trace.selection.selectArea({...area});\n          }\n        } else if (area) {\n          attrs.trace.selection.selectArea({...area});\n        }\n        // Now the selection has ended we stored the final selected area in the\n        // global state and can remove the in progress selection from the\n        // timeline.\n        attrs.trace.timeline.deselectArea();\n        // Full redraw to color track shell.\n        raf.scheduleFullRedraw();\n      },\n    });\n  }\n\n  onremove() {\n    if (this.zoomContent) this.zoomContent[Symbol.dispose]();\n  }\n\n  view({attrs}: m.CVnode<PageWithTraceImplAttrs>) {\n    const scrollingPanels = renderToplevelPanels(attrs.trace);\n\n    const result = m(\n      '.page.viewer-page',\n      m(\n        TabPanel,\n        {\n          trace: attrs.trace,\n        },\n        m(\n          '.pan-and-zoom-content',\n          {\n            ref: this.PAN_ZOOM_CONTENT_REF,\n            onclick: () => {\n              // We don't want to deselect when panning/drag selecting.\n              if (this.keepCurrentSelection) {\n                this.keepCurrentSelection = false;\n                return;\n              }\n              attrs.trace.selection.clear();\n            },\n          },\n          m(\n            '.pf-timeline-header',\n            m(PanelContainer, {\n              trace: attrs.trace,\n              className: 'header-panel-container',\n              panels: removeFalsyValues([\n                OVERVIEW_PANEL_FLAG.get() && this.overviewTimelinePanel,\n                this.timeAxisPanel,\n                this.timeSelectionPanel,\n                this.notesPanel,\n                this.tickmarkPanel,\n              ]),\n              selectedYRange: this.getYRange('header-panel-container'),\n            }),\n            m('.scrollbar-spacer-vertical'),\n          ),\n          m(PanelContainer, {\n            trace: attrs.trace,\n            className: 'pinned-panel-container',\n            panels: AppImpl.instance.isLoadingTrace\n              ? []\n              : attrs.trace.workspace.pinnedTracks.map((trackNode) => {\n                  if (trackNode.uri) {\n                    const tr = attrs.trace.tracks.getTrackRenderer(\n                      trackNode.uri,\n                    );\n                    return new TrackPanel({\n                      trace: attrs.trace,\n                      reorderable: true,\n                      node: trackNode,\n                      trackRenderer: tr,\n                      revealOnCreate: true,\n                      indentationLevel: 0,\n                      topOffsetPx: 0,\n                    });\n                  } else {\n                    return new TrackPanel({\n                      trace: attrs.trace,\n                      node: trackNode,\n                      revealOnCreate: true,\n                      indentationLevel: 0,\n                      topOffsetPx: 0,\n                    });\n                  }\n                }),\n            renderUnderlay: (ctx, size) =>\n              renderUnderlay(attrs.trace, ctx, size),\n            renderOverlay: (ctx, size, panels) =>\n              renderOverlay(\n                attrs.trace,\n                ctx,\n                size,\n                panels,\n                attrs.trace.workspace.pinnedTracksNode,\n              ),\n            selectedYRange: this.getYRange('pinned-panel-container'),\n          }),\n          m(PanelContainer, {\n            trace: attrs.trace,\n            className: 'scrolling-panel-container',\n            panels: AppImpl.instance.isLoadingTrace ? [] : scrollingPanels,\n            onPanelStackResize: (width) => {\n              const timelineWidth = width - TRACK_SHELL_WIDTH;\n              this.timelineWidthPx = timelineWidth;\n            },\n            renderUnderlay: (ctx, size) =>\n              renderUnderlay(attrs.trace, ctx, size),\n            renderOverlay: (ctx, size, panels) =>\n              renderOverlay(\n                attrs.trace,\n                ctx,\n                size,\n                panels,\n                attrs.trace.workspace.tracks,\n              ),\n            selectedYRange: this.getYRange('scrolling-panel-container'),\n          }),\n        ),\n      ),\n\n      this.showPanningHint && m(HelpPanningNotification),\n    );\n\n    attrs.trace.tracks.flushOldTracks();\n    return result;\n  }\n\n  private getYRange(cls: string): VerticalBounds | undefined {\n    if (this.selectedContainer?.containerClass !== cls) {\n      return undefined;\n    }\n    const {dragStartAbsY, dragEndAbsY} = this.selectedContainer;\n    return {\n      top: Math.min(dragStartAbsY, dragEndAbsY),\n      bottom: Math.max(dragStartAbsY, dragEndAbsY),\n    };\n  }\n}\n\nfunction renderUnderlay(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  canvasSize: Size2D,\n): void {\n  const size = {\n    width: canvasSize.width - TRACK_SHELL_WIDTH,\n    height: canvasSize.height,\n  };\n\n  using _ = canvasSave(ctx);\n  ctx.translate(TRACK_SHELL_WIDTH, 0);\n\n  const timewindow = trace.timeline.visibleWindow;\n  const timescale = new TimeScale(timewindow, {left: 0, right: size.width});\n\n  // Just render the gridlines - these should appear underneath all tracks\n  drawGridLines(trace, ctx, timewindow.toTimeSpan(), timescale, size);\n}\n\nfunction renderOverlay(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  canvasSize: Size2D,\n  panels: ReadonlyArray<RenderedPanelInfo>,\n  trackContainer: TrackNode,\n): void {\n  const size = {\n    width: canvasSize.width - TRACK_SHELL_WIDTH,\n    height: canvasSize.height,\n  };\n\n  using _ = canvasSave(ctx);\n  ctx.translate(TRACK_SHELL_WIDTH, 0);\n  canvasClip(ctx, 0, 0, size.width, size.height);\n\n  // TODO(primiano): plumb the TraceImpl obj throughout the viwer page.\n  renderFlows(trace, ctx, size, panels, trackContainer);\n\n  const timewindow = trace.timeline.visibleWindow;\n  const timescale = new TimeScale(timewindow, {left: 0, right: size.width});\n\n  renderHoveredNoteVertical(trace, ctx, timescale, size);\n  renderHoveredCursorVertical(trace, ctx, timescale, size);\n  renderWakeupVertical(trace, ctx, timescale, size);\n  renderNoteVerticals(trace, ctx, timescale, size);\n}\n\n// Render the toplevel \"scrolling\" tracks and track groups\nfunction renderToplevelPanels(trace: TraceImpl): PanelOrGroup[] {\n  return renderNodes(trace, trace.workspace.children, 0, 0);\n}\n\n// Given a list of tracks and a filter term, return a list pf panels filtered by\n// the filter term\nfunction renderNodes(\n  trace: TraceImpl,\n  nodes: ReadonlyArray<TrackNode>,\n  indent: number,\n  topOffsetPx: number,\n): PanelOrGroup[] {\n  return nodes.flatMap((node) => {\n    if (node.headless) {\n      // Render children as if this node doesn't exist\n      return renderNodes(trace, node.children, indent, topOffsetPx);\n    } else if (node.children.length === 0) {\n      return renderTrackPanel(trace, node, indent, topOffsetPx);\n    } else {\n      const headerPanel = renderTrackPanel(trace, node, indent, topOffsetPx);\n      const isSticky = node.isSummary;\n      const nextTopOffsetPx = isSticky\n        ? topOffsetPx + headerPanel.heightPx\n        : topOffsetPx;\n      return {\n        kind: 'group',\n        collapsed: node.collapsed,\n        header: headerPanel,\n        sticky: isSticky, // && node.collapsed??\n        topOffsetPx,\n        childPanels: node.collapsed\n          ? []\n          : renderNodes(trace, node.children, indent + 1, nextTopOffsetPx),\n      };\n    }\n  });\n}\n\nfunction renderTrackPanel(\n  trace: TraceImpl,\n  trackNode: TrackNode,\n  indent: number,\n  topOffsetPx: number,\n) {\n  let tr = undefined;\n  if (trackNode.uri) {\n    tr = trace.tracks.getTrackRenderer(trackNode.uri);\n  }\n  return new TrackPanel({\n    trace,\n    node: trackNode,\n    trackRenderer: tr,\n    indentationLevel: indent,\n    topOffsetPx,\n  });\n}\n\nexport function drawGridLines(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  timespan: TimeSpan,\n  timescale: TimeScale,\n  size: Size2D,\n): void {\n  ctx.strokeStyle = TRACK_BORDER_COLOR;\n  ctx.lineWidth = 1;\n\n  if (size.width > 0 && timespan.duration > 0n) {\n    const maxMajorTicks = getMaxMajorTicks(size.width);\n    const offset = trace.timeline.timestampOffset();\n    for (const {type, time} of generateTicks(timespan, maxMajorTicks, offset)) {\n      const px = Math.floor(timescale.timeToPx(time));\n      if (type === TickType.MAJOR) {\n        ctx.beginPath();\n        ctx.moveTo(px + 0.5, 0);\n        ctx.lineTo(px + 0.5, size.height);\n        ctx.stroke();\n      }\n    }\n  }\n}\n\nexport function renderHoveredCursorVertical(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  timescale: TimeScale,\n  size: Size2D,\n) {\n  if (trace.timeline.hoverCursorTimestamp !== undefined) {\n    drawVerticalLineAtTime(\n      ctx,\n      timescale,\n      trace.timeline.hoverCursorTimestamp,\n      size.height,\n      `#344596`,\n    );\n  }\n}\n\nexport function renderHoveredNoteVertical(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  timescale: TimeScale,\n  size: Size2D,\n) {\n  if (trace.timeline.hoveredNoteTimestamp !== undefined) {\n    drawVerticalLineAtTime(\n      ctx,\n      timescale,\n      trace.timeline.hoveredNoteTimestamp,\n      size.height,\n      `#aaa`,\n    );\n  }\n}\n\nexport function renderWakeupVertical(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  timescale: TimeScale,\n  size: Size2D,\n) {\n  const selection = trace.selection.selection;\n  if (selection.kind === 'track_event' && selection.wakeupTs) {\n    drawVerticalLineAtTime(\n      ctx,\n      timescale,\n      selection.wakeupTs,\n      size.height,\n      `black`,\n    );\n  }\n}\n\nexport function renderNoteVerticals(\n  trace: TraceImpl,\n  ctx: CanvasRenderingContext2D,\n  timescale: TimeScale,\n  size: Size2D,\n) {\n  // All marked areas should have semi-transparent vertical lines\n  // marking the start and end.\n  for (const note of trace.notes.notes.values()) {\n    if (note.noteType === 'SPAN') {\n      const transparentNoteColor =\n        'rgba(' + hex.rgb(note.color.substr(1)).toString() + ', 0.65)';\n      drawVerticalLineAtTime(\n        ctx,\n        timescale,\n        note.start,\n        size.height,\n        transparentNoteColor,\n        1,\n      );\n      drawVerticalLineAtTime(\n        ctx,\n        timescale,\n        note.end,\n        size.height,\n        transparentNoteColor,\n        1,\n      );\n    } else if (note.noteType === 'DEFAULT') {\n      drawVerticalLineAtTime(\n        ctx,\n        timescale,\n        note.timestamp,\n        size.height,\n        note.color,\n      );\n    }\n  }\n}\n\nclass HelpPanningNotification implements m.ClassComponent {\n  private readonly PANNING_HINT_KEY = 'dismissedPanningHint';\n  private dismissed = localStorage.getItem(this.PANNING_HINT_KEY) === 'true';\n\n  view() {\n    // Do not show the help notification in embedded mode because local storage\n    // does not persist for iFrames. The host is responsible for communicating\n    // to users that they can press '?' for help.\n    if (AppImpl.instance.embeddedMode || this.dismissed) {\n      return;\n    }\n    return m(\n      '.helpful-hint',\n      m(\n        '.hint-text',\n        'Are you trying to pan? Use the WASD keys or hold shift to click ' +\n          \"and drag. Press '?' for more help.\",\n      ),\n      m(\n        'button.hint-dismiss-button',\n        {\n          onclick: () => {\n            this.dismissed = true;\n            localStorage.setItem(this.PANNING_HINT_KEY, 'true');\n            raf.scheduleFullRedraw();\n          },\n        },\n        'Dismiss',\n      ),\n    );\n  }\n}\n"]}
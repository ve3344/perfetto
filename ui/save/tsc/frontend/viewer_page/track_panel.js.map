{"version":3,"file":"track_panel.js","sourceRoot":"","sources":["../../../../src/frontend/viewer_page/track_panel.ts"],"names":[],"mappings":";AAAA,qDAAqD;AACrD,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;;;AAEjC,8DAAwB;AACxB,0DAA+D;AAC/D,sDAAiD;AAEjD,8DAAgD;AAChD,sDAAgD;AAEhD,4DAAsD;AACtD,4DAA6C;AAI7C,sDAAiD;AACjD,iDAA4C;AAC5C,iDAA4C;AAC5C,+CAAyD;AACzD,6DAAuD;AACvD,6CAAkD;AAClD,oDAAyE;AAEzE,6CAAiD;AAEjD,MAAM,yBAAyB,GAAG,4BAAY,CAAC,QAAQ,CAAC;IACtD,EAAE,EAAE,wBAAwB;IAC5B,IAAI,EAAE,2BAA2B;IACjC,WAAW,EAAE,4CAA4C;IACzD,YAAY,EAAE,KAAK;CACpB,CAAC,CAAC;AAEH,wEAAwE;AACxE,2EAA2E;AAC9D,QAAA,uBAAuB,GAAG,EAAE,CAAC;AAY1C,MAAa,UAAU;IACZ,IAAI,GAAG,OAAO,CAAC;IACf,UAAU,GAAG,IAAI,CAAC;IAClB,SAAS,CAAa;IAEd,KAAK,CAAkB;IAExC,YAAY,KAAsB;QAChC,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC;IAC9B,CAAC;IAED,IAAI,QAAQ;QACV,MAAM,EAAC,aAAa,EAAE,IAAI,EAAC,GAAG,IAAI,CAAC,KAAK,CAAC;QAEzC,oEAAoE;QACpE,yBAAyB;QACzB,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,QAAQ;YAAE,OAAO,+BAAuB,CAAC;QAEpE,4DAA4D;QAC5D,OAAO,aAAa,EAAE,KAAK,CAAC,SAAS,EAAE,IAAI,+BAAuB,CAAC;IACrE,CAAC;IAED,MAAM;QACJ,MAAM,EACJ,IAAI,EACJ,gBAAgB,EAChB,aAAa,EACb,cAAc,EACd,WAAW,EACX,WAAW,GAAG,KAAK,GACpB,GAAG,IAAI,CAAC,KAAK,CAAC;QAEf,MAAM,KAAK,GAAG,aAAa,EAAE,QAAQ,EAAE,CAAC;QAExC,MAAM,OAAO,GAAG;YACd,yBAAyB,CAAC,GAAG,EAAE;gBAC7B,wBAAwB,CAAC,IAAI,EAAE,aAAa,EAAE,IAAI,CAAC;YACrD,aAAa,EAAE,KAAK,CAAC,oBAAoB,EAAE,EAAE;YAC7C,IAAI,CAAC,SAAS,IAAI,iBAAiB,CAAC,IAAI,CAAC;YACzC,gEAAgE;YAChE,sBAAsB;YACtB,CAAC,IAAI,CAAC,SAAS,IAAI,eAAe,CAAC,IAAI,CAAC;YACxC,IAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC;YACtC,KAAK,IAAI,iBAAiB,CAAC,KAAK,EAAE,aAAa,EAAE,IAAI,CAAC,QAAQ,CAAC;SAChE,CAAC;QAEF,IAAI,cAAc,GAAG,KAAK,CAAC;QAC3B,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC;QACvC,IAAI,MAAM,CAAC,mBAAmB,KAAK,IAAI,CAAC,EAAE,EAAE,CAAC;YAC3C,MAAM,CAAC,mBAAmB,GAAG,SAAS,CAAC;YACvC,cAAc,GAAG,IAAI,CAAC;QACxB,CAAC;QAED,OAAO,IAAA,iBAAC,EAAC,0BAAW,EAAE;YACpB,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC;YAC7B,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,KAAK,EAAE,OAAO,CAAC,aAAa,EAAE,QAAQ,EAAE,CAAC;YACzC,KAAK,EAAE,aAAa,EAAE,IAAI,CAAC,KAAK;YAChC,gBAAgB;YAChB,WAAW;YACX,OAAO;YACP,cAAc,EAAE,cAAc,IAAI,cAAc;YAChD,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,SAAS,EAAE,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC;YACnC,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,WAAW;YACX,iBAAiB,EAAE,GAAG,EAAE;gBACtB,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;YAC7C,CAAC;YACD,uBAAuB,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;gBACvC,MAAM,SAAS,GAAG,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;gBACrD,aAAa,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC;oBACjC,GAAG,GAAG;oBACN,SAAS;iBACV,CAAC,CAAC;gBACH,mBAAG,CAAC,oBAAoB,EAAE,CAAC;YAC7B,CAAC;YACD,sBAAsB,EAAE,GAAG,EAAE;gBAC3B,aAAa,EAAE,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC;gBACpC,mBAAG,CAAC,oBAAoB,EAAE,CAAC;YAC7B,CAAC;YACD,mBAAmB,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;gBACnC,MAAM,SAAS,GAAG,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;gBACrD,mBAAG,CAAC,oBAAoB,EAAE,CAAC;gBAC3B,OAAO,CACL,aAAa,EAAE,KAAK,CAAC,YAAY,EAAE,CAAC;oBAClC,GAAG,GAAG;oBACN,SAAS;iBACV,CAAC,IAAI,KAAK,CACZ,CAAC;YACJ,CAAC;YACD,QAAQ,EAAE,GAAG,EAAE;gBACb,aAAa,EAAE,KAAK,CAAC,YAAY,EAAE,EAAE,CAAC;YACxC,CAAC;YACD,YAAY,EAAE,CAAC,MAAc,EAAE,EAAE;gBAC/B,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,MAAM,CAAC,CAAC;gBACxD,IAAI,UAAU,KAAK,SAAS,EAAE,CAAC;oBAC7B,yCAAyC;oBACzC,UAAU,CAAC,MAAM,EAAE,cAAc,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;gBACtD,CAAC;YACH,CAAC;YACD,WAAW,EAAE,CAAC,MAAc,EAAE,EAAE;gBAC9B,MAAM,UAAU,GAAG,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,MAAM,CAAC,CAAC;gBACxD,IAAI,UAAU,KAAK,SAAS,EAAE,CAAC;oBAC7B,wCAAwC;oBACxC,UAAU,CAAC,MAAM,EAAE,aAAa,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;gBACrD,CAAC;YACH,CAAC;SACF,CAAC,CAAC;IACL,CAAC;IAED,YAAY,CAAC,GAA6B,EAAE,IAAY;;;YACtD,MAAM,EAAC,aAAa,EAAE,EAAE,EAAE,IAAI,EAAC,GAAG,IAAI,CAAC,KAAK,CAAC;YAE7C,yCAAyC;YACzC,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACpC,OAAO;YACT,CAAC;YAED,MAAM,SAAS,GAAG;gBAChB,KAAK,EAAE,IAAI,CAAC,KAAK,GAAG,iCAAiB;gBACrC,MAAM,EAAE,IAAI,CAAC,MAAM;aACpB,CAAC;YAEF,MAAM,CAAC,0CAAG,IAAA,yBAAU,EAAC,GAAG,CAAC,QAAA,CAAC;YAC1B,GAAG,CAAC,SAAS,CAAC,iCAAiB,EAAE,CAAC,CAAC,CAAC;YACpC,IAAA,yBAAU,EAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;YAEzD,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC;YAC9D,MAAM,SAAS,GAAG,IAAI,sBAAS,CAAC,aAAa,EAAE;gBAC7C,IAAI,EAAE,CAAC;gBACP,KAAK,EAAE,SAAS,CAAC,KAAK;aACvB,CAAC,CAAC;YAEH,IAAI,EAAE,EAAE,CAAC;gBACP,IAAI,CAAC,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC;oBACnB,MAAM,cAAc,GAAuB;wBACzC,QAAQ,EAAE,EAAE,CAAC,IAAI,CAAC,GAAG;wBACrB,aAAa;wBACb,IAAI,EAAE,SAAS;wBACf,UAAU,EAAE,IAAA,gCAAmB,EAAC,aAAa,EAAE,SAAS,CAAC,KAAK,CAAC;wBAC/D,GAAG;wBACH,SAAS;qBACV,CAAC;oBACF,EAAE,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;gBAC5B,CAAC;YACH,CAAC;YAED,IAAI,CAAC,+BAA+B,CAAC,GAAG,EAAE,SAAS,EAAE,IAAI,EAAE,SAAS,CAAC,CAAC;;;;;;;;;KACvE;IAED,sBAAsB,CAAC,KAAa;QAClC,IAAI,IAAI,CAAC,KAAK,CAAC,aAAa,KAAK,SAAS,EAAE,CAAC;YAC3C,OAAO,SAAS,CAAC;QACnB,CAAC;QACD,OAAO,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,sBAAsB,EAAE,CAAC,KAAK,CAAC,CAAC;IACxE,CAAC;IAEO,qBAAqB,CAAC,MAAgB;QAC5C,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC;QAC3D,OAAO,IAAI,sBAAS,CAAC,UAAU,EAAE;YAC/B,IAAI,EAAE,CAAC;YACP,KAAK,EAAE,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI;SAClC,CAAC,CAAC;IACL,CAAC;IAEO,aAAa,CAAC,IAAe;QACnC,4EAA4E;QAC5E,gCAAgC;QAChC,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC;QACxD,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,aAAa,CAAC;QAE5D,IAAI,WAAW,KAAK,CAAC,CAAC,IAAI,aAAa,KAAK,SAAS,EAAE,CAAC;YACtD,MAAM,GAAG,GAAG,aAAa,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;YACjD,6DAA6D;YAC7D,IACE,GAAG,KAAK,IAAI,CAAC,GAAG;gBAChB,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,EACjD,CAAC;gBACD,OAAO,IAAI,CAAC;YACd,CAAC;QACH,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;QAChD,IACE,YAAY,CAAC,SAAS,CAAC,IAAI,KAAK,OAAO;YACvC,YAAY,CAAC,SAAS,CAAC,QAAQ,KAAK,IAAI,CAAC,GAAG,EAC5C,CAAC;YACD,OAAO,IAAI,CAAC;QACd,CAAC;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAEO,+BAA+B,CACrC,GAA6B,EAC7B,SAAoB,EACpB,IAAe,EACf,IAAY;QAEZ,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,CAAC;QACvD,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;YAC9B,OAAO;QACT,CAAC;QAED,MAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAC3C,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,SAAS,CACuB,CAAC;QAEpD,IAAI,QAAQ,GAAG,KAAK,CAAC;QACrB,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnB,QAAQ,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CACvC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CACxC,CAAC;QACJ,CAAC;aAAM,CAAC;YACN,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC;gBACb,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpD,CAAC;QACH,CAAC;QAED,IAAI,QAAQ,EAAE,CAAC;YACb,MAAM,oBAAoB,GAAG,SAAS,CAAC,GAAG,GAAG,SAAS,CAAC,KAAK,CAAC;YAC7D,GAAG,CAAC,SAAS,GAAG,oCAAoB,CAAC;YACrC,GAAG,CAAC,QAAQ,CACV,SAAS,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,EACnC,CAAC,EACD,SAAS,CAAC,YAAY,CAAC,oBAAoB,CAAC,EAC5C,IAAI,CAAC,MAAM,CACZ,CAAC;QACJ,CAAC;IACH,CAAC;IAEO,2BAA2B,CAAC,IAAe;QACjD,MAAM,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC;QACpD,MAAM,SAAS,GAAG,gBAAgB,CAAC,SAAS,CAAC;QAC7C,IAAI,SAAS,CAAC,IAAI,KAAK,MAAM,EAAE,CAAC;YAC9B,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACnB,MAAM,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,CAC3C,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,SAAS,CACuB,CAAC;gBACpD,yCAAyC;gBACzC,MAAM,sBAAsB,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CACtD,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CACpC,CAAC;gBACF,IAAI,sBAAsB,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;oBAC3C,OAAO,IAAA,iBAAC,EAAC,eAAM,EAAE;wBACf,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;4BACzB,MAAM,IAAI,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;4BAC9C,gBAAgB,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;4BAChD,CAAC,CAAC,eAAe,EAAE,CAAC;wBACtB,CAAC;wBACD,OAAO,EAAE,IAAI;wBACb,IAAI,EAAE,sBAAK,CAAC,QAAQ;wBACpB,KAAK,EAAE,oCAAoC;qBAC5C,CAAC,CAAC;gBACL,CAAC;qBAAM,IAAI,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;oBACjD,OAAO,IAAA,iBAAC,EAAC,eAAM,EAAE;wBACf,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;4BACzB,MAAM,IAAI,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;4BAC9C,gBAAgB,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;4BAChD,CAAC,CAAC,eAAe,EAAE,CAAC;wBACtB,CAAC;wBACD,OAAO,EAAE,IAAI;wBACb,IAAI,EAAE,sBAAK,CAAC,qBAAqB;wBACjC,KAAK,EAAE,yCAAyC;qBACjD,CAAC,CAAC;gBACL,CAAC;qBAAM,CAAC;oBACN,OAAO,IAAA,iBAAC,EAAC,eAAM,EAAE;wBACf,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;4BACzB,MAAM,IAAI,GAAG,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;4BAC9C,gBAAgB,CAAC,wBAAwB,CAAC,IAAI,CAAC,CAAC;4BAChD,CAAC,CAAC,eAAe,EAAE,CAAC;wBACtB,CAAC;wBACD,OAAO,EAAE,IAAI;wBACb,IAAI,EAAE,sBAAK,CAAC,aAAa;wBACzB,KAAK,EAAE,+BAA+B;qBACvC,CAAC,CAAC;gBACL,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,MAAM,OAAO,GAAG,IAAI,CAAC,GAAG,CAAC;gBACzB,IAAI,OAAO,EAAE,CAAC;oBACZ,OAAO,CACL,SAAS,CAAC,IAAI,KAAK,MAAM;wBACzB,IAAA,iBAAC,EAAC,eAAM,EAAE;4BACR,OAAO,EAAE,CAAC,CAAa,EAAE,EAAE;gCACzB,gBAAgB,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC;gCACnD,CAAC,CAAC,eAAe,EAAE,CAAC;4BACtB,CAAC;4BACD,OAAO,EAAE,IAAI;4BACb,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC;gCACvC,CAAC,CAAC,EAAC,IAAI,EAAE,sBAAK,CAAC,QAAQ,EAAE,KAAK,EAAE,cAAc,EAAC;gCAC/C,CAAC,CAAC,EAAC,IAAI,EAAE,sBAAK,CAAC,aAAa,EAAE,KAAK,EAAE,wBAAwB,EAAC,CAAC;yBAClE,CAAC,CACH,CAAC;gBACJ,CAAC;YACH,CAAC;QACH,CAAC;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;CACF;AA/SD,gCA+SC;AAED,SAAS,iBAAiB,CAAC,KAAY,EAAE,QAAiB;IACxD,OAAO,IAAA,iBAAC,EACN,aAAK,EACL;QACE,OAAO,EAAE,IAAA,iBAAC,EAAC,eAAM,EAAE;YACjB,IAAI,EAAE,sBAAK,CAAC,OAAO;YACnB,OAAO,EAAE,IAAI;SACd,CAAC;KACH,EACD,IAAA,iBAAC,EACC,uBAAuB,EACvB,IAAA,iBAAC,EAAC,MAAM,EAAE,yBAAyB,CAAC,EACpC,QAAQ,IAAI,IAAA,iBAAC,EAAC,MAAM,EAAE,kBAAkB,QAAQ,EAAE,CAAC,EACnD,IAAA,iBAAC,EAAC,eAAM,EAAE;QACR,KAAK,EAAE,qBAAqB;QAC5B,MAAM,EAAE,eAAM,CAAC,OAAO;QACtB,SAAS,EAAE,aAAK,CAAC,yBAAyB;QAC1C,OAAO,EAAE,GAAG,EAAE;YACZ,MAAM,KAAK,CAAC;QACd,CAAC;KACF,CAAC,CAIH,CACF,CAAC;AACJ,CAAC;AAED,SAAS,iBAAiB,CAAC,IAAe;IACxC,OAAO,IAAA,iBAAC,EAAC,eAAM,EAAE;QACf,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE;YACb,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,CAAC,CAAC,eAAe,EAAE,CAAC;QACtB,CAAC;QACD,IAAI,EAAE,sBAAK,CAAC,KAAK;QACjB,KAAK,EAAE,aAAa;QACpB,OAAO,EAAE,IAAI;KACd,CAAC,CAAC;AACL,CAAC;AAED,SAAS,eAAe,CAAC,IAAe;IACtC,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;IAC/B,OAAO,IAAA,iBAAC,EAAC,eAAM,EAAE;QACf,SAAS,EAAE,IAAA,uBAAU,EAAC,CAAC,QAAQ,IAAI,qBAAqB,CAAC;QACzD,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE;YACb,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;YACrC,CAAC,CAAC,eAAe,EAAE,CAAC;QACtB,CAAC;QACD,IAAI,EAAE,sBAAK,CAAC,GAAG;QACf,UAAU,EAAE,QAAQ;QACpB,KAAK,EAAE,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,YAAY;QACxC,OAAO,EAAE,IAAI;KACd,CAAC,CAAC;AACL,CAAC;AAED,SAAS,wBAAwB,CAC/B,IAAe,EACf,EAAoB;IAEpB,IAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;IACzB,IAAI,QAAQ,GAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC1C,OAAO,MAAM,IAAI,MAAM,YAAY,qBAAS,EAAE,CAAC;QAC7C,QAAQ,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,UAAU,EAAE,GAAG,QAAQ,CAAC,CAAC;QACnD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;IACzB,CAAC;IACD,OAAO,IAAA,iBAAC,EACN,aAAK,EACL;QACE,OAAO,EAAE,IAAA,iBAAC,EAAC,eAAM,EAAE;YACjB,SAAS,EAAE,qBAAqB;YAChC,IAAI,EAAE,MAAM;YACZ,KAAK,EAAE,oBAAoB;YAC3B,OAAO,EAAE,IAAI;SACd,CAAC;QACF,QAAQ,EAAE,qBAAa,CAAC,MAAM;KAC/B,EACD,IAAA,iBAAC,EACC,4BAA4B,EAC5B,IAAA,iBAAC,EACC,WAAI,EACJ,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,eAAe,EAAE,KAAK,EAAE,IAAI,CAAC,EAAE,EAAC,CAAC,EACpD,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,SAAS,EAAE,EAAC,CAAC,EAC5D,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,CAAC,GAAG,EAAC,CAAC,EAC3C,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,kBAAkB,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,SAAS,EAAE,EAAC,CAAC,EACnE,IAAA,iBAAC,EAAC,eAAQ,EAAE;QACV,IAAI,EAAE,WAAW;QACjB,KAAK,EAAE,IAAI,CAAC,SAAS,IAAI,eAAe;KACzC,CAAC,EACF,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAC,CAAC,EAC5C,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAC,CAAC,EAC/C,IAAA,iBAAC,EAAC,eAAQ,EAAE;QACV,IAAI,EAAE,WAAW;QACjB,KAAK,EAAE,IAAI,CAAC,SAAS,EAAE,KAAK,IAAI,gBAAgB;KACjD,CAAC,EACF,EAAE,IAAI,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,EAAE,CAAC,QAAQ,EAAC,CAAC,EAC1D,EAAE;QACA,IAAA,iBAAC,EACC,eAAQ,EACR,EAAC,IAAI,EAAE,MAAM,EAAC,EACd,EAAE,CAAC,IAAI;YACL,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE;gBAC3C,OAAO,IAAA,iBAAC,EAAC,eAAQ,EAAE,EAAC,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,EAAC,CAAC,CAAC;YAC5D,CAAC,CAAC,CACL,CACJ,CACF,CACF,CAAC;AACJ,CAAC","sourcesContent":["// Copyright (C) 2018 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {canvasClip, canvasSave} from '../../base/canvas_utils';\nimport {classNames} from '../../base/classnames';\nimport {Bounds2D, Size2D, VerticalBounds} from '../../base/geom';\nimport {Icons} from '../../base/semantic_icons';\nimport {TimeScale} from '../../base/time_scale';\nimport {RequiredField} from '../../base/utils';\nimport {featureFlags} from '../../core/feature_flags';\nimport {raf} from '../../core/raf_scheduler';\nimport {TraceImpl} from '../../core/trace_impl';\nimport {TrackRenderer} from '../../core/track_manager';\nimport {TrackDescriptor, TrackRenderContext} from '../../public/track';\nimport {TrackNode} from '../../public/workspace';\nimport {Button} from '../../widgets/button';\nimport {Intent} from '../../widgets/common';\nimport {Popup, PopupPosition} from '../../widgets/popup';\nimport {TrackWidget} from '../../widgets/track_widget';\nimport {Tree, TreeNode} from '../../widgets/tree';\nimport {SELECTION_FILL_COLOR, TRACK_SHELL_WIDTH} from '../css_constants';\nimport {Panel} from './panel_container';\nimport {calculateResolution} from './resolution';\n\nconst SHOW_TRACK_DETAILS_BUTTON = featureFlags.register({\n  id: 'showTrackDetailsButton',\n  name: 'Show track details button',\n  description: 'Show track details button in track shells.',\n  defaultValue: false,\n});\n\n// Default height of a track element that has no track, or is collapsed.\n// Note: This is designed to roughly match the height of a cpu slice track.\nexport const DEFAULT_TRACK_HEIGHT_PX = 30;\n\ninterface TrackPanelAttrs {\n  readonly trace: TraceImpl;\n  readonly node: TrackNode;\n  readonly indentationLevel: number;\n  readonly trackRenderer?: TrackRenderer;\n  readonly revealOnCreate?: boolean;\n  readonly topOffsetPx: number;\n  readonly reorderable?: boolean;\n}\n\nexport class TrackPanel implements Panel {\n  readonly kind = 'panel';\n  readonly selectable = true;\n  readonly trackNode?: TrackNode;\n\n  private readonly attrs: TrackPanelAttrs;\n\n  constructor(attrs: TrackPanelAttrs) {\n    this.attrs = attrs;\n    this.trackNode = attrs.node;\n  }\n\n  get heightPx(): number {\n    const {trackRenderer, node} = this.attrs;\n\n    // If the node is a summary track and is expanded, shrink it to save\n    // vertical real estate).\n    if (node.isSummary && node.expanded) return DEFAULT_TRACK_HEIGHT_PX;\n\n    // Otherwise return the height of the track, if we have one.\n    return trackRenderer?.track.getHeight() ?? DEFAULT_TRACK_HEIGHT_PX;\n  }\n\n  render(): m.Children {\n    const {\n      node,\n      indentationLevel,\n      trackRenderer,\n      revealOnCreate,\n      topOffsetPx,\n      reorderable = false,\n    } = this.attrs;\n\n    const error = trackRenderer?.getError();\n\n    const buttons = [\n      SHOW_TRACK_DETAILS_BUTTON.get() &&\n        renderTrackDetailsButton(node, trackRenderer?.desc),\n      trackRenderer?.track.getTrackShellButtons?.(),\n      node.removable && renderCloseButton(node),\n      // We don't want summary tracks to be pinned as they rarely have\n      // useful information.\n      !node.isSummary && renderPinButton(node),\n      this.renderAreaSelectionCheckbox(node),\n      error && renderCrashButton(error, trackRenderer?.desc.pluginId),\n    ];\n\n    let scrollIntoView = false;\n    const tracks = this.attrs.trace.tracks;\n    if (tracks.scrollToTrackNodeId === node.id) {\n      tracks.scrollToTrackNodeId = undefined;\n      scrollIntoView = true;\n    }\n\n    return m(TrackWidget, {\n      id: node.id,\n      title: node.title,\n      path: node.fullPath.join('/'),\n      heightPx: this.heightPx,\n      error: Boolean(trackRenderer?.getError()),\n      chips: trackRenderer?.desc.chips,\n      indentationLevel,\n      topOffsetPx,\n      buttons,\n      revealOnCreate: revealOnCreate || scrollIntoView,\n      collapsible: node.hasChildren,\n      collapsed: node.collapsed,\n      highlight: this.isHighlighted(node),\n      isSummary: node.isSummary,\n      reorderable,\n      onToggleCollapsed: () => {\n        node.hasChildren && node.toggleCollapsed();\n      },\n      onTrackContentMouseMove: (pos, bounds) => {\n        const timescale = this.getTimescaleForBounds(bounds);\n        trackRenderer?.track.onMouseMove?.({\n          ...pos,\n          timescale,\n        });\n        raf.scheduleCanvasRedraw();\n      },\n      onTrackContentMouseOut: () => {\n        trackRenderer?.track.onMouseOut?.();\n        raf.scheduleCanvasRedraw();\n      },\n      onTrackContentClick: (pos, bounds) => {\n        const timescale = this.getTimescaleForBounds(bounds);\n        raf.scheduleCanvasRedraw();\n        return (\n          trackRenderer?.track.onMouseClick?.({\n            ...pos,\n            timescale,\n          }) ?? false\n        );\n      },\n      onupdate: () => {\n        trackRenderer?.track.onFullRedraw?.();\n      },\n      onMoveBefore: (nodeId: string) => {\n        const targetNode = node.workspace?.getTrackById(nodeId);\n        if (targetNode !== undefined) {\n          // Insert the target node before this one\n          targetNode.parent?.addChildBefore(targetNode, node);\n        }\n      },\n      onMoveAfter: (nodeId: string) => {\n        const targetNode = node.workspace?.getTrackById(nodeId);\n        if (targetNode !== undefined) {\n          // Insert the target node after this one\n          targetNode.parent?.addChildAfter(targetNode, node);\n        }\n      },\n    });\n  }\n\n  renderCanvas(ctx: CanvasRenderingContext2D, size: Size2D) {\n    const {trackRenderer: tr, node} = this.attrs;\n\n    // Don't render if expanded and isSummary\n    if (node.isSummary && node.expanded) {\n      return;\n    }\n\n    const trackSize = {\n      width: size.width - TRACK_SHELL_WIDTH,\n      height: size.height,\n    };\n\n    using _ = canvasSave(ctx);\n    ctx.translate(TRACK_SHELL_WIDTH, 0);\n    canvasClip(ctx, 0, 0, trackSize.width, trackSize.height);\n\n    const visibleWindow = this.attrs.trace.timeline.visibleWindow;\n    const timescale = new TimeScale(visibleWindow, {\n      left: 0,\n      right: trackSize.width,\n    });\n\n    if (tr) {\n      if (!tr.getError()) {\n        const trackRenderCtx: TrackRenderContext = {\n          trackUri: tr.desc.uri,\n          visibleWindow,\n          size: trackSize,\n          resolution: calculateResolution(visibleWindow, trackSize.width),\n          ctx,\n          timescale,\n        };\n        tr.render(trackRenderCtx);\n      }\n    }\n\n    this.highlightIfTrackInAreaSelection(ctx, timescale, node, trackSize);\n  }\n\n  getSliceVerticalBounds(depth: number): VerticalBounds | undefined {\n    if (this.attrs.trackRenderer === undefined) {\n      return undefined;\n    }\n    return this.attrs.trackRenderer.track.getSliceVerticalBounds?.(depth);\n  }\n\n  private getTimescaleForBounds(bounds: Bounds2D) {\n    const timeWindow = this.attrs.trace.timeline.visibleWindow;\n    return new TimeScale(timeWindow, {\n      left: 0,\n      right: bounds.right - bounds.left,\n    });\n  }\n\n  private isHighlighted(node: TrackNode) {\n    // The track should be highlighted if the current search result matches this\n    // track or one of its children.\n    const searchIndex = this.attrs.trace.search.resultIndex;\n    const searchResults = this.attrs.trace.search.searchResults;\n\n    if (searchIndex !== -1 && searchResults !== undefined) {\n      const uri = searchResults.trackUris[searchIndex];\n      // Highlight if this or any children match the search results\n      if (\n        uri === node.uri ||\n        node.flatTracksOrdered.find((t) => t.uri === uri)\n      ) {\n        return true;\n      }\n    }\n\n    const curSelection = this.attrs.trace.selection;\n    if (\n      curSelection.selection.kind === 'track' &&\n      curSelection.selection.trackUri === node.uri\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private highlightIfTrackInAreaSelection(\n    ctx: CanvasRenderingContext2D,\n    timescale: TimeScale,\n    node: TrackNode,\n    size: Size2D,\n  ) {\n    const selection = this.attrs.trace.selection.selection;\n    if (selection.kind !== 'area') {\n      return;\n    }\n\n    const tracksWithUris = node.flatTracks.filter(\n      (t) => t.uri !== undefined,\n    ) as ReadonlyArray<RequiredField<TrackNode, 'uri'>>;\n\n    let selected = false;\n    if (node.isSummary) {\n      selected = tracksWithUris.some((track) =>\n        selection.trackUris.includes(track.uri),\n      );\n    } else {\n      if (node.uri) {\n        selected = selection.trackUris.includes(node.uri);\n      }\n    }\n\n    if (selected) {\n      const selectedAreaDuration = selection.end - selection.start;\n      ctx.fillStyle = SELECTION_FILL_COLOR;\n      ctx.fillRect(\n        timescale.timeToPx(selection.start),\n        0,\n        timescale.durationToPx(selectedAreaDuration),\n        size.height,\n      );\n    }\n  }\n\n  private renderAreaSelectionCheckbox(node: TrackNode): m.Children {\n    const selectionManager = this.attrs.trace.selection;\n    const selection = selectionManager.selection;\n    if (selection.kind === 'area') {\n      if (node.isSummary) {\n        const tracksWithUris = node.flatTracks.filter(\n          (t) => t.uri !== undefined,\n        ) as ReadonlyArray<RequiredField<TrackNode, 'uri'>>;\n        // Check if any nodes within are selected\n        const childTracksInSelection = tracksWithUris.map((t) =>\n          selection.trackUris.includes(t.uri),\n        );\n        if (childTracksInSelection.every((b) => b)) {\n          return m(Button, {\n            onclick: (e: MouseEvent) => {\n              const uris = tracksWithUris.map((t) => t.uri);\n              selectionManager.toggleGroupAreaSelection(uris);\n              e.stopPropagation();\n            },\n            compact: true,\n            icon: Icons.Checkbox,\n            title: 'Remove child tracks from selection',\n          });\n        } else if (childTracksInSelection.some((b) => b)) {\n          return m(Button, {\n            onclick: (e: MouseEvent) => {\n              const uris = tracksWithUris.map((t) => t.uri);\n              selectionManager.toggleGroupAreaSelection(uris);\n              e.stopPropagation();\n            },\n            compact: true,\n            icon: Icons.IndeterminateCheckbox,\n            title: 'Add remaining child tracks to selection',\n          });\n        } else {\n          return m(Button, {\n            onclick: (e: MouseEvent) => {\n              const uris = tracksWithUris.map((t) => t.uri);\n              selectionManager.toggleGroupAreaSelection(uris);\n              e.stopPropagation();\n            },\n            compact: true,\n            icon: Icons.BlankCheckbox,\n            title: 'Add child tracks to selection',\n          });\n        }\n      } else {\n        const nodeUri = node.uri;\n        if (nodeUri) {\n          return (\n            selection.kind === 'area' &&\n            m(Button, {\n              onclick: (e: MouseEvent) => {\n                selectionManager.toggleTrackAreaSelection(nodeUri);\n                e.stopPropagation();\n              },\n              compact: true,\n              ...(selection.trackUris.includes(nodeUri)\n                ? {icon: Icons.Checkbox, title: 'Remove track'}\n                : {icon: Icons.BlankCheckbox, title: 'Add track to selection'}),\n            })\n          );\n        }\n      }\n    }\n    return undefined;\n  }\n}\n\nfunction renderCrashButton(error: Error, pluginId?: string) {\n  return m(\n    Popup,\n    {\n      trigger: m(Button, {\n        icon: Icons.Crashed,\n        compact: true,\n      }),\n    },\n    m(\n      '.pf-track-crash-popup',\n      m('span', 'This track has crashed.'),\n      pluginId && m('span', `Owning plugin: ${pluginId}`),\n      m(Button, {\n        label: 'View & Report Crash',\n        intent: Intent.Primary,\n        className: Popup.DISMISS_POPUP_GROUP_CLASS,\n        onclick: () => {\n          throw error;\n        },\n      }),\n      // TODO(stevegolton): In the future we should provide a quick way to\n      // disable the plugin, or provide a link to the plugin page, but this\n      // relies on the plugin page being fully functional.\n    ),\n  );\n}\n\nfunction renderCloseButton(node: TrackNode) {\n  return m(Button, {\n    onclick: (e) => {\n      node.remove();\n      e.stopPropagation();\n    },\n    icon: Icons.Close,\n    title: 'Close track',\n    compact: true,\n  });\n}\n\nfunction renderPinButton(node: TrackNode): m.Children {\n  const isPinned = node.isPinned;\n  return m(Button, {\n    className: classNames(!isPinned && 'pf-visible-on-hover'),\n    onclick: (e) => {\n      isPinned ? node.unpin() : node.pin();\n      e.stopPropagation();\n    },\n    icon: Icons.Pin,\n    iconFilled: isPinned,\n    title: isPinned ? 'Unpin' : 'Pin to top',\n    compact: true,\n  });\n}\n\nfunction renderTrackDetailsButton(\n  node: TrackNode,\n  td?: TrackDescriptor,\n): m.Children {\n  let parent = node.parent;\n  let fullPath: m.ChildArray = [node.title];\n  while (parent && parent instanceof TrackNode) {\n    fullPath = [parent.title, ' \\u2023 ', ...fullPath];\n    parent = parent.parent;\n  }\n  return m(\n    Popup,\n    {\n      trigger: m(Button, {\n        className: 'pf-visible-on-hover',\n        icon: 'info',\n        title: 'Show track details',\n        compact: true,\n      }),\n      position: PopupPosition.Bottom,\n    },\n    m(\n      '.pf-track-details-dropdown',\n      m(\n        Tree,\n        m(TreeNode, {left: 'Track Node ID', right: node.id}),\n        m(TreeNode, {left: 'Collapsed', right: `${node.collapsed}`}),\n        m(TreeNode, {left: 'URI', right: node.uri}),\n        m(TreeNode, {left: 'Is Summary Track', right: `${node.isSummary}`}),\n        m(TreeNode, {\n          left: 'SortOrder',\n          right: node.sortOrder ?? '0 (undefined)',\n        }),\n        m(TreeNode, {left: 'Path', right: fullPath}),\n        m(TreeNode, {left: 'Title', right: node.title}),\n        m(TreeNode, {\n          left: 'Workspace',\n          right: node.workspace?.title ?? '[no workspace]',\n        }),\n        td && m(TreeNode, {left: 'Plugin ID', right: td.pluginId}),\n        td &&\n          m(\n            TreeNode,\n            {left: 'Tags'},\n            td.tags &&\n              Object.entries(td.tags).map(([key, value]) => {\n                return m(TreeNode, {left: key, right: value?.toString()});\n              }),\n          ),\n      ),\n    ),\n  );\n}\n"]}
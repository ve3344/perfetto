{"version":3,"file":"time_selection_panel.js","sourceRoot":"","sources":["../../../../src/frontend/viewer_page/time_selection_panel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (C) 2019 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use size file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport m from 'mithril';\nimport {canvasClip} from '../../base/canvas_utils';\nimport {Size2D} from '../../base/geom';\nimport {assertUnreachable} from '../../base/logging';\nimport {time, Time} from '../../base/time';\nimport {TimeScale} from '../../base/time_scale';\nimport {formatDuration} from '../../components/time_utils';\nimport {timestampFormat} from '../../core/timestamp_format';\nimport {TraceImpl} from '../../core/trace_impl';\nimport {TimestampFormat} from '../../public/timeline';\nimport {\n  BACKGROUND_COLOR,\n  FOREGROUND_COLOR,\n  TRACK_SHELL_WIDTH,\n} from '../css_constants';\nimport {generateTicks, getMaxMajorTicks, TickType} from './gridline_helper';\nimport {Panel} from './panel_container';\n\nexport interface BBox {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n// Draws a vertical line with two horizontal tails at the left and right and\n// a label in the middle. It looks a bit like a stretched H:\n// |--- Label ---|\n// The |target| bounding box determines where to draw the H.\n// The |bounds| bounding box gives the visible region, this is used to adjust\n// the positioning of the label to ensure it is on screen.\nfunction drawHBar(\n  ctx: CanvasRenderingContext2D,\n  target: BBox,\n  bounds: BBox,\n  label: string,\n) {\n  ctx.fillStyle = FOREGROUND_COLOR;\n\n  const xLeft = Math.floor(target.x);\n  const xRight = Math.floor(target.x + target.width);\n  const yMid = Math.floor(target.height / 2 + target.y);\n  const xWidth = xRight - xLeft;\n\n  // Don't draw in the track shell.\n  ctx.beginPath();\n  ctx.rect(bounds.x, bounds.y, bounds.width, bounds.height);\n  ctx.clip();\n\n  // Draw horizontal bar of the H.\n  ctx.fillRect(xLeft, yMid, xWidth, 1);\n  // Draw left vertical bar of the H.\n  ctx.fillRect(xLeft, target.y, 1, target.height);\n  // Draw right vertical bar of the H.\n  ctx.fillRect(xRight, target.y, 1, target.height);\n\n  const labelWidth = ctx.measureText(label).width;\n\n  // Find a good position for the label:\n  // By default put the label in the middle of the H:\n  let labelXLeft = Math.floor(xWidth / 2 - labelWidth / 2 + xLeft);\n\n  if (\n    labelWidth > target.width ||\n    labelXLeft < bounds.x ||\n    labelXLeft + labelWidth > bounds.x + bounds.width\n  ) {\n    // It won't fit in the middle or would be at least partly out of bounds\n    // so put it either to the left or right:\n    if (xRight > bounds.x + bounds.width) {\n      // If the H extends off the right side of the screen the label\n      // goes on the left of the H.\n      labelXLeft = xLeft - labelWidth - 3;\n    } else {\n      // Otherwise the label goes on the right of the H.\n      labelXLeft = xRight + 3;\n    }\n  }\n\n  ctx.fillStyle = BACKGROUND_COLOR;\n  ctx.fillRect(labelXLeft - 1, 0, labelWidth + 1, target.height);\n\n  ctx.textBaseline = 'middle';\n  ctx.fillStyle = FOREGROUND_COLOR;\n  ctx.font = '10px Roboto Condensed';\n  ctx.fillText(label, labelXLeft, yMid);\n}\n\nfunction drawIBar(\n  ctx: CanvasRenderingContext2D,\n  xPos: number,\n  bounds: BBox,\n  label: string,\n) {\n  if (xPos < bounds.x) return;\n\n  ctx.fillStyle = FOREGROUND_COLOR;\n  ctx.fillRect(xPos, 0, 1, bounds.width);\n\n  const yMid = Math.floor(bounds.height / 2 + bounds.y);\n  const labelWidth = ctx.measureText(label).width;\n  const padding = 3;\n\n  let xPosLabel;\n  if (xPos + padding + labelWidth > bounds.width) {\n    xPosLabel = xPos - padding;\n    ctx.textAlign = 'right';\n  } else {\n    xPosLabel = xPos + padding;\n    ctx.textAlign = 'left';\n  }\n\n  ctx.fillStyle = BACKGROUND_COLOR;\n  ctx.fillRect(xPosLabel - 1, 0, labelWidth + 2, bounds.height);\n\n  ctx.textBaseline = 'middle';\n  ctx.fillStyle = FOREGROUND_COLOR;\n  ctx.font = '10px Roboto Condensed';\n  ctx.fillText(label, xPosLabel, yMid);\n}\n\nexport class TimeSelectionPanel implements Panel {\n  readonly kind = 'panel';\n  readonly selectable = false;\n\n  constructor(private readonly trace: TraceImpl) {}\n\n  render(): m.Children {\n    return m('.time-selection-panel');\n  }\n\n  renderCanvas(ctx: CanvasRenderingContext2D, size: Size2D) {\n    ctx.fillStyle = '#999';\n    ctx.fillRect(TRACK_SHELL_WIDTH - 2, 0, 2, size.height);\n\n    const trackSize = {...size, width: size.width - TRACK_SHELL_WIDTH};\n\n    ctx.save();\n    ctx.translate(TRACK_SHELL_WIDTH, 0);\n    canvasClip(ctx, 0, 0, trackSize.width, trackSize.height);\n    this.renderPanel(ctx, trackSize);\n    ctx.restore();\n  }\n\n  private renderPanel(ctx: CanvasRenderingContext2D, size: Size2D): void {\n    const visibleWindow = this.trace.timeline.visibleWindow;\n    const timescale = new TimeScale(visibleWindow, {\n      left: 0,\n      right: size.width,\n    });\n    const timespan = visibleWindow.toTimeSpan();\n\n    if (size.width > 0 && timespan.duration > 0n) {\n      const maxMajorTicks = getMaxMajorTicks(size.width);\n      const offset = this.trace.timeline.timestampOffset();\n      const tickGen = generateTicks(timespan, maxMajorTicks, offset);\n      for (const {type, time} of tickGen) {\n        const px = Math.floor(timescale.timeToPx(time));\n        if (type === TickType.MAJOR) {\n          ctx.fillRect(px, 0, 1, size.height);\n        }\n      }\n    }\n\n    const localArea = this.trace.timeline.selectedArea;\n    const selection = this.trace.selection.selection;\n    if (localArea !== undefined) {\n      const start = Time.min(localArea.start, localArea.end);\n      const end = Time.max(localArea.start, localArea.end);\n      this.renderSpan(ctx, timescale, size, start, end);\n    } else {\n      if (selection.kind === 'area') {\n        const start = Time.min(selection.start, selection.end);\n        const end = Time.max(selection.start, selection.end);\n        this.renderSpan(ctx, timescale, size, start, end);\n      } else if (selection.kind === 'track_event') {\n        const start = selection.ts;\n        const end = Time.add(selection.ts, selection.dur);\n        if (end > start) {\n          this.renderSpan(ctx, timescale, size, start, end);\n        }\n      }\n    }\n\n    if (this.trace.timeline.hoverCursorTimestamp !== undefined) {\n      this.renderHover(\n        ctx,\n        timescale,\n        size,\n        this.trace.timeline.hoverCursorTimestamp,\n      );\n    }\n\n    for (const note of this.trace.notes.notes.values()) {\n      const noteIsSelected =\n        selection.kind === 'note' && selection.id === note.id;\n      if (note.noteType === 'SPAN' && noteIsSelected) {\n        this.renderSpan(ctx, timescale, size, note.start, note.end);\n      }\n    }\n\n    ctx.restore();\n  }\n\n  renderHover(\n    ctx: CanvasRenderingContext2D,\n    timescale: TimeScale,\n    size: Size2D,\n    ts: time,\n  ) {\n    const xPos = Math.floor(timescale.timeToPx(ts));\n    const domainTime = this.trace.timeline.toDomainTime(ts);\n    const label = stringifyTimestamp(domainTime);\n    drawIBar(ctx, xPos, this.getBBoxFromSize(size), label);\n  }\n\n  renderSpan(\n    ctx: CanvasRenderingContext2D,\n    timescale: TimeScale,\n    trackSize: Size2D,\n    start: time,\n    end: time,\n  ) {\n    const xLeft = timescale.timeToPx(start);\n    const xRight = timescale.timeToPx(end);\n    const label = formatDuration(this.trace, end - start);\n    drawHBar(\n      ctx,\n      {\n        x: xLeft,\n        y: 0,\n        width: xRight - xLeft,\n        height: trackSize.height,\n      },\n      this.getBBoxFromSize(trackSize),\n      label,\n    );\n  }\n\n  private getBBoxFromSize(size: Size2D): BBox {\n    return {\n      x: 0,\n      y: 0,\n      width: size.width,\n      height: size.height,\n    };\n  }\n}\n\nfunction stringifyTimestamp(time: time): string {\n  const fmt = timestampFormat();\n  switch (fmt) {\n    case TimestampFormat.UTC:\n    case TimestampFormat.TraceTz:\n    case TimestampFormat.Timecode:\n      const THIN_SPACE = '\\u2009';\n      return Time.toTimecode(time).toString(THIN_SPACE);\n    case TimestampFormat.TraceNs:\n      return time.toString();\n    case TimestampFormat.TraceNsLocale:\n      return time.toLocaleString();\n    case TimestampFormat.Seconds:\n      return Time.formatSeconds(time);\n    case TimestampFormat.Milliseconds:\n      return Time.formatMilliseconds(time);\n    case TimestampFormat.Microseconds:\n      return Time.formatMicroseconds(time);\n    default:\n      assertUnreachable(fmt);\n  }\n}\n"]}
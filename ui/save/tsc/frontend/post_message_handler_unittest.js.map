{"version":3,"file":"post_message_handler_unittest.js","sourceRoot":"","sources":["../../../src/frontend/post_message_handler_unittest.ts"],"names":[],"mappings":";AAAA,qDAAqD;AACrD,EAAE;AACF,kEAAkE;AAClE,mEAAmE;AACnE,0CAA0C;AAC1C,EAAE;AACF,kDAAkD;AAClD,EAAE;AACF,sEAAsE;AACtE,oEAAoE;AACpE,2EAA2E;AAC3E,sEAAsE;AACtE,iCAAiC;;AAEjC,iEAAuD;AAEvD,QAAQ,CAAC,oBAAoB,EAAE,GAAG,EAAE;IAClC,IAAI,CAAC,sCAAsC,EAAE,GAAG,EAAE;QAChD,MAAM,CAAC,IAAA,sCAAe,EAAC,kCAAkC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACzE,MAAM,CAAC,IAAA,sCAAe,EAAC,4BAA4B,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACnE,MAAM,CACJ,IAAA,sCAAe,EAAC,sCAAsC,CAAC,CACxD,CAAC,UAAU,EAAE,CAAC;QACf,MAAM,CAAC,IAAA,sCAAe,EAAC,wBAAwB,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;IAChE,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,mDAAmD,EAAE,GAAG,EAAE;QAC7D,IAAI,CAAC;YACH,MAAM,CAAC,IAAA,sCAAe,EAAC,wBAAwB,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;YAC9D,MAAM,CAAC,YAAY,CAAC,gBAAgB,CAAC,GAAG,4BAA4B,CAAC;YACrE,MAAM,CAAC,IAAA,sCAAe,EAAC,wBAAwB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACjE,CAAC;gBAAS,CAAC;YACT,MAAM,CAAC,YAAY,CAAC,KAAK,EAAE,CAAC;QAC9B,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,IAAI,CAAC,iCAAiC,EAAE,GAAG,EAAE;QAC3C,MAAM,CAAC,IAAA,sCAAe,EAAC,oBAAoB,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;QAC1D,MAAM,CAAC,IAAA,sCAAe,EAAC,qCAAqC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC5E,MAAM,CAAC,IAAA,sCAAe,EAAC,oCAAoC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC3E,MAAM,CAAC,IAAA,sCAAe,EAAC,oCAAoC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC3E,MAAM,CAAC,IAAA,sCAAe,EAAC,mCAAmC,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC1E,MAAM,CAAC,IAAA,sCAAe,EAAC,oCAAoC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;QAC1E,MAAM,CAAC,IAAA,sCAAe,EAAC,mCAAmC,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC;QACzE,MAAM,CAAC,IAAA,sCAAe,EAAC,mBAAmB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC1D,MAAM,CAAC,IAAA,sCAAe,EAAC,kBAAkB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACzD,MAAM,CAAC,IAAA,sCAAe,EAAC,mBAAmB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QAC1D,MAAM,CAAC,IAAA,sCAAe,EAAC,kBAAkB,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACzD,iBAAiB;QACjB,MAAM,CAAC,IAAA,sCAAe,EAAC,eAAe,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;QACtD,MAAM,CAAC,IAAA,sCAAe,EAAC,cAAc,CAAC,CAAC,CAAC,UAAU,EAAE,CAAC;IACvD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright (C) 2024 The Android Open Source Project\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {isTrustedOrigin} from './post_message_handler';\n\ndescribe('postMessageHandler', () => {\n  test('baked-in trusted origins are trusted', () => {\n    expect(isTrustedOrigin('https://chrometto.googleplex.com')).toBeTruthy();\n    expect(isTrustedOrigin('https://uma.googleplex.com')).toBeTruthy();\n    expect(\n      isTrustedOrigin('https://android-build.googleplex.com'),\n    ).toBeTruthy();\n    expect(isTrustedOrigin('https://html5zombo.com')).toBeFalsy();\n  });\n\n  test('user trusted origins in local storage are trusted', () => {\n    try {\n      expect(isTrustedOrigin('https://html5zombo.com')).toBeFalsy();\n      window.localStorage['trustedOrigins'] = '[\"https://html5zombo.com\"]';\n      expect(isTrustedOrigin('https://html5zombo.com')).toBeTruthy();\n    } finally {\n      window.localStorage.clear();\n    }\n  });\n\n  test('developer hostnames are trusted', () => {\n    expect(isTrustedOrigin('https://google.com')).toBeFalsy();\n    expect(isTrustedOrigin('https://broccoliman.corp.google.com')).toBeTruthy();\n    expect(isTrustedOrigin('http://broccoliman.corp.google.com')).toBeTruthy();\n    expect(isTrustedOrigin('https://broccoliman.c.googlers.com')).toBeTruthy();\n    expect(isTrustedOrigin('http://broccoliman.c.googlers.com')).toBeTruthy();\n    expect(isTrustedOrigin('https://broccolimancorp.google.com')).toBeFalsy();\n    expect(isTrustedOrigin('https://broccolimanc.googlers.com')).toBeFalsy();\n    expect(isTrustedOrigin('https://localhost')).toBeTruthy();\n    expect(isTrustedOrigin('http://localhost')).toBeTruthy();\n    expect(isTrustedOrigin('https://127.0.0.1')).toBeTruthy();\n    expect(isTrustedOrigin('http://127.0.0.1')).toBeTruthy();\n    // IPv6 localhost\n    expect(isTrustedOrigin('https://[::1]')).toBeTruthy();\n    expect(isTrustedOrigin('http://[::1]')).toBeTruthy();\n  });\n});\n"]}